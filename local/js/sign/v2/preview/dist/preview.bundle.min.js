this.BX=this.BX||{};this.BX.Sign=this.BX.Sign||{};(function(e,s,a){"use strict";let l=e=>e,i,t,r,o,b,n,d,c,v,p,h;const P=.25;var L=babelHelpers.classPrivateFieldLooseKey("placeholder");var F=babelHelpers.classPrivateFieldLooseKey("page");var H=babelHelpers.classPrivateFieldLooseKey("pageNumber");var u=babelHelpers.classPrivateFieldLooseKey("scale");var B=babelHelpers.classPrivateFieldLooseKey("controls");var g=babelHelpers.classPrivateFieldLooseKey("blocksContainer");var m=babelHelpers.classPrivateFieldLooseKey("blocks");var f=babelHelpers.classPrivateFieldLooseKey("urls");var y=babelHelpers.classPrivateFieldLooseKey("loader");var w=babelHelpers.classPrivateFieldLooseKey("createBlockStyles");var _=babelHelpers.classPrivateFieldLooseKey("createBlocks");var j=babelHelpers.classPrivateFieldLooseKey("getBlockContent");var C=babelHelpers.classPrivateFieldLooseKey("getImageLayout");var O=babelHelpers.classPrivateFieldLooseKey("getTextLayout");var $=babelHelpers.classPrivateFieldLooseKey("createContent");var D=babelHelpers.classPrivateFieldLooseKey("createControls");var k=babelHelpers.classPrivateFieldLooseKey("render");var K=babelHelpers.classPrivateFieldLooseKey("renderContent");var T=babelHelpers.classPrivateFieldLooseKey("renderBlocks");var x=babelHelpers.classPrivateFieldLooseKey("renderControls");var E=babelHelpers.classPrivateFieldLooseKey("renderPagination");var S=babelHelpers.classPrivateFieldLooseKey("renderZoom");class X{constructor(){Object.defineProperty(this,S,{value:Q});Object.defineProperty(this,E,{value:J});Object.defineProperty(this,x,{value:q});Object.defineProperty(this,T,{value:Z});Object.defineProperty(this,K,{value:W});Object.defineProperty(this,k,{value:R});Object.defineProperty(this,D,{value:N});Object.defineProperty(this,$,{value:G});Object.defineProperty(this,O,{value:A});Object.defineProperty(this,C,{value:V});Object.defineProperty(this,j,{value:I});Object.defineProperty(this,_,{value:M});Object.defineProperty(this,w,{value:z});Object.defineProperty(this,L,{writable:true,value:void 0});Object.defineProperty(this,F,{writable:true,value:void 0});Object.defineProperty(this,H,{writable:true,value:void 0});Object.defineProperty(this,u,{writable:true,value:void 0});Object.defineProperty(this,B,{writable:true,value:void 0});Object.defineProperty(this,g,{writable:true,value:void 0});Object.defineProperty(this,m,{writable:true,value:void 0});Object.defineProperty(this,f,{writable:true,value:void 0});Object.defineProperty(this,y,{writable:true,value:void 0});babelHelpers.classPrivateFieldLooseBase(this,L)[L]=s.Tag.render(i||(i=l`
			<video
				poster="/bitrix/js/sign/preview/images/sign-preview-document-demo.jpg"
				loop="true"
				muted="true"
				playsinline="true"
				class="sign-preview__placeholder"
			>
				<source type="video/mp4" src="/bitrix/js/sign/preview/images/sign-preview-document-demo.mp4" />
				<source type="video/webm" src="/bitrix/js/sign/preview/images/sign-preview-document-demo.webm" />
			</video>
		`));babelHelpers.classPrivateFieldLooseBase(this,F)[F]=s.Tag.render(t||(t=l`<img class="sign-preview__page" />`));babelHelpers.classPrivateFieldLooseBase(this,g)[g]=s.Tag.render(r||(r=l`<div class="sign-preview__blocks"></div>`));babelHelpers.classPrivateFieldLooseBase(this,m)[m]=new Map;babelHelpers.classPrivateFieldLooseBase(this,B)[B]=babelHelpers.classPrivateFieldLooseBase(this,D)[D]();babelHelpers.classPrivateFieldLooseBase(this,f)[f]=[];babelHelpers.classPrivateFieldLooseBase(this,H)[H]=0;babelHelpers.classPrivateFieldLooseBase(this,u)[u]=1;babelHelpers.classPrivateFieldLooseBase(this,y)[y]=new a.Loader}getLayout(){const e=s.Tag.render(o||(o=l`
			<div class="sign-preview">
				${0}
				${0}
			</div>
		`),babelHelpers.classPrivateFieldLooseBase(this,$)[$](),babelHelpers.classPrivateFieldLooseBase(this,B)[B]);babelHelpers.classPrivateFieldLooseBase(this,k)[k]();return e}set urls(e){babelHelpers.classPrivateFieldLooseBase(this,f)[f]=e;babelHelpers.classPrivateFieldLooseBase(this,K)[K]();babelHelpers.classPrivateFieldLooseBase(this,x)[x]()}set ready(e){if(e){babelHelpers.classPrivateFieldLooseBase(this,y)[y].hide();return}babelHelpers.classPrivateFieldLooseBase(this,y)[y].show()}async setBlocks(e){s.Dom.clean(babelHelpers.classPrivateFieldLooseBase(this,g)[g]);if(!(e!=null&&e.length)){return}babelHelpers.classPrivateFieldLooseBase(this,m)[m]=await babelHelpers.classPrivateFieldLooseBase(this,_)[_](e);babelHelpers.classPrivateFieldLooseBase(this,T)[T]()}}function z(e){const{style:s,position:a,type:l}=e;const{top:i,left:t,width:r,height:o,widthPx:b,heightPx:n}=a;const d={...s,top:`${a.top}%`,left:`${a.left}%`,width:`${r}%`,height:`${o}%`};if(l==="image"){return d}const{width:c,height:v}=babelHelpers.classPrivateFieldLooseBase(this,F)[F].getBoundingClientRect();const p=b/(r/100*c);const h=n/(o/100*v);const P=(parseFloat(s["fontSize"])||14)/p;const L=`${5/h}px ${8/p}px`;Object.assign(d,{padding:L,fontSize:`${P}px`});return d}async function M(e){const a=babelHelpers.classPrivateFieldLooseBase(this,F)[F].complete&&babelHelpers.classPrivateFieldLooseBase(this,F)[F].naturalHeight!==0;if(!a){await new Promise((e=>s.Event.bindOnce(babelHelpers.classPrivateFieldLooseBase(this,F)[F],"load",e)))}const{blocksTemplate:i,blocks:t}=e.reduce(((e,a)=>{var i;const t=s.Tag.render(b||(b=l`
				<div class="sign-preview__block"></div>
			`));const r=babelHelpers.classPrivateFieldLooseBase(this,j)[j](a);if(r){s.Dom.append(r,t);s.Dom.addClass(t,"--filled")}const o=babelHelpers.classPrivateFieldLooseBase(this,w)[w](a);Object.keys(o).forEach((e=>{t.style[e]=o[e]}));const{blocks:n,blocksTemplate:d}=e;const{page:c}=a.position;n.set(c,[...(i=n.get(c))!=null?i:[],t]);s.Dom.append(t,d);return e}),{blocks:new Map,blocksTemplate:new DocumentFragment});s.Dom.append(i,babelHelpers.classPrivateFieldLooseBase(this,g)[g]);return t}function I(e){if(e.type==="image"){return babelHelpers.classPrivateFieldLooseBase(this,C)[C](e)}return babelHelpers.classPrivateFieldLooseBase(this,O)[O](e)}function V(e){var a;const i=(a=e.data.__view)==null?void 0:a.base64;if(!i){return null}const t=s.Tag.render(n||(n=l`<img src="data:image;base64,${0}" />`),i);return t}function A(e){let a=e.data.text;if(!a){return null}a=s.Text.encode(a);const i=s.Tag.render(d||(d=l`<span>${0}</span>`),a);i.innerHTML=a.replaceAll("[br]","<br />");return i}function G(){const e=s.Tag.render(c||(c=l`
			<div class="sign-preview__content">
				${0}
				${0}
				${0}
			</div>
		`),babelHelpers.classPrivateFieldLooseBase(this,L)[L],babelHelpers.classPrivateFieldLooseBase(this,F)[F],babelHelpers.classPrivateFieldLooseBase(this,g)[g]);babelHelpers.classPrivateFieldLooseBase(this,y)[y].setOptions({target:e,size:80});return e}function N(){const e=s.Tag.render(v||(v=l`
			<div class="sign-preview__pagination">
				<span
					class="sign-preview__btn sign-preview__pagination_btn --prev"
					onclick="${0}"
				>
				</span>
				<span class="sign-preview__pagination_page-num"></span>
				<span
					class="sign-preview__btn sign-preview__pagination_btn --next"
					onclick="${0}"
				>
				</span>
			</div>
		`),(()=>{babelHelpers.classPrivateFieldLooseBase(this,H)[H]-=1;babelHelpers.classPrivateFieldLooseBase(this,k)[k]()}),(()=>{babelHelpers.classPrivateFieldLooseBase(this,H)[H]+=1;babelHelpers.classPrivateFieldLooseBase(this,k)[k]()}));const a=s.Tag.render(p||(p=l`
			<div class="sign-preview__zoom">
				<span
					class="sign-preview__btn sign-preview__zoom_btn --plus"
					onclick="${0}"
				>
				</span>
				<span class="sign-preview__zoom_value">100%</span>
				<span
					class="sign-preview__btn sign-preview__zoom_btn --minus"
					onclick="${0}"
				></span>
			</div>
		`),(()=>{babelHelpers.classPrivateFieldLooseBase(this,u)[u]-=P;babelHelpers.classPrivateFieldLooseBase(this,K)[K]();babelHelpers.classPrivateFieldLooseBase(this,S)[S]()}),(()=>{babelHelpers.classPrivateFieldLooseBase(this,u)[u]+=P;babelHelpers.classPrivateFieldLooseBase(this,K)[K]();babelHelpers.classPrivateFieldLooseBase(this,S)[S]()}));return s.Tag.render(h||(h=l`
			<div class="sign-preview__controls">
				${0}
				${0}
			</div>
		`),e,a)}function R(){babelHelpers.classPrivateFieldLooseBase(this,K)[K]();babelHelpers.classPrivateFieldLooseBase(this,T)[T]();babelHelpers.classPrivateFieldLooseBase(this,x)[x]()}function W(){s.Dom.removeClass(babelHelpers.classPrivateFieldLooseBase(this,L)[L],"--hidden");s.Dom.removeClass(babelHelpers.classPrivateFieldLooseBase(this,F)[F],"--hidden");if(!babelHelpers.classPrivateFieldLooseBase(this,f)[f].length){s.Dom.addClass(babelHelpers.classPrivateFieldLooseBase(this,F)[F],"--hidden");babelHelpers.classPrivateFieldLooseBase(this,F)[F].src="";babelHelpers.classPrivateFieldLooseBase(this,F)[F].style.transform="";babelHelpers.classPrivateFieldLooseBase(this,L)[L].play();return}s.Dom.addClass(babelHelpers.classPrivateFieldLooseBase(this,L)[L],"--hidden");const e=babelHelpers.classPrivateFieldLooseBase(this,f)[f][babelHelpers.classPrivateFieldLooseBase(this,H)[H]];babelHelpers.classPrivateFieldLooseBase(this,F)[F].src=e;babelHelpers.classPrivateFieldLooseBase(this,F)[F].style.transform=`scale(${babelHelpers.classPrivateFieldLooseBase(this,u)[u]})`}function Z(){var e;const a=(e=babelHelpers.classPrivateFieldLooseBase(this,m)[m].get(babelHelpers.classPrivateFieldLooseBase(this,H)[H]+1))!=null?e:[];const l=[...babelHelpers.classPrivateFieldLooseBase(this,m)[m].values()].flat();l.forEach((e=>{if(a.includes(e)){s.Dom.removeClass(e,"--hidden");return}s.Dom.addClass(e,"--hidden")}))}function q(){if(!babelHelpers.classPrivateFieldLooseBase(this,f)[f].length){s.Dom.addClass(babelHelpers.classPrivateFieldLooseBase(this,B)[B],"--locked");babelHelpers.classPrivateFieldLooseBase(this,H)[H]=0;babelHelpers.classPrivateFieldLooseBase(this,u)[u]=1;return}s.Dom.removeClass(babelHelpers.classPrivateFieldLooseBase(this,B)[B],"--locked");babelHelpers.classPrivateFieldLooseBase(this,E)[E]();babelHelpers.classPrivateFieldLooseBase(this,S)[S]()}function J(){const[e]=babelHelpers.classPrivateFieldLooseBase(this,B)[B].children;const[a,l,i]=e.children;const t=s.Loc.getMessage("SIGN_PREVIEW_PAGE");const r=babelHelpers.classPrivateFieldLooseBase(this,f)[f].length;s.Dom.removeClass(a,"--disabled");s.Dom.removeClass(i,"--disabled");l.textContent=`${t} ${babelHelpers.classPrivateFieldLooseBase(this,H)[H]+1}/${r}`;if(babelHelpers.classPrivateFieldLooseBase(this,H)[H]===0){s.Dom.addClass(a,"--disabled")}if(babelHelpers.classPrivateFieldLooseBase(this,H)[H]===r-1){s.Dom.addClass(i,"--disabled")}}function Q(){const[,e]=babelHelpers.classPrivateFieldLooseBase(this,B)[B].children;const[a,l,i]=e.children;l.textContent=`${babelHelpers.classPrivateFieldLooseBase(this,u)[u]*100}%`;if(babelHelpers.classPrivateFieldLooseBase(this,u)[u]!==1){s.Dom.addClass(babelHelpers.classPrivateFieldLooseBase(this,F)[F].parentElement,"--overflowed");s.Dom.removeClass(a,"--disabled");if(babelHelpers.classPrivateFieldLooseBase(this,u)[u]===2){s.Dom.addClass(i,"--disabled")}}else{s.Dom.addClass(a,"--disabled");s.Dom.removeClass(i,"--disabled");s.Dom.removeClass(babelHelpers.classPrivateFieldLooseBase(this,F)[F].parentElement,"--overflowed")}}e.Preview=X})(this.BX.Sign.V2=this.BX.Sign.V2||{},BX,BX);
//# sourceMappingURL=preview.bundle.map.js