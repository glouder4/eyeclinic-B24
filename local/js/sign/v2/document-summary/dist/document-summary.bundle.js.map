{"version":3,"file":"document-summary.bundle.js","sources":["../src/index.js"],"sourcesContent":["import { Tag, Dom, Loc, Reflection, Text } from 'main.core';\nimport { EventEmitter } from 'main.core.events';\nimport { MenuManager } from 'main.popup';\nimport { Api } from 'sign.v2.api';\nimport './style.css';\n\nconst buttonClassList = [\n\t'ui-btn',\n\t'ui-btn-sm',\n\t'ui-btn-light-border',\n\t'ui-btn-round',\n];\nconst menuPrefix = 'sign-member-communication';\n\nexport class DocumentSummary extends EventEmitter\n{\n\t#editDocumentBtn: HTMLElement;\n\t#api: Api;\n\t#blocks: HTMLElement;\n\t#filledBlocks: HTMLElement;\n\t#menus: Array<Menu>;\n\tdocumentData;\n\tentityData;\n\tcommunications;\n\n\tconstructor()\n\t{\n\t\tsuper();\n\t\tthis.setEventNamespace('BX.Sign.V2.DocumentSummary');\n\t\tthis.#editDocumentBtn = Tag.render`\n\t\t\t<span\n\t\t\t\tclass=\"${buttonClassList.join(' ')}\"\n\t\t\t\tonclick=\"${() => this.emit('showEditor')}\"\n\t\t\t>\n\t\t\t\t${Loc.getMessage('SIGN_DOCUMENT_INFO_EDIT')}\n\t\t\t</span>\n\t\t`;\n\t\tthis.#api = new Api();\n\t\tthis.#blocks = Tag.render`\n\t\t\t<p class=\"sign-document-info__details_structure\"></p>\n\t\t`;\n\t\tthis.#filledBlocks = Tag.render`\n\t\t\t<p class=\"sign-document-info__details_structure\"></p>\n\t\t`;\n\t\tthis.#menus = [];\n\t\tthis.documentData = {};\n\t\tthis.entityData = {};\n\t\tthis.communications = {};\n\t}\n\n\tgetLayout(): HTMLElement\n\t{\n\t\treturn Tag.render`\n\t\t\t<div class=\"sign-document-info\">\n\t\t\t\t<p class=\"sign-document-info__title\">\n\t\t\t\t\t${Loc.getMessage('SIGN_DOCUMENT_INFO_SEND')}\n\t\t\t\t</p>\n\t\t\t\t<div class=\"sign-document-info__summary\">\n\t\t\t\t\t${this.#createDocumentDetails()}\n\t\t\t\t\t${this.#editDocumentBtn}\n\t\t\t\t</div>\n\t\t\t\t${this.#createParties()}\n\t\t\t</div>\n\t\t`;\n\t}\n\n\t#createDocumentDetails(): HTMLElement\n\t{\n\t\tthis.renderDocumentDetails();\n\n\t\treturn Tag.render`\n\t\t\t<div class=\"sign-document-info__details\">\n\t\t\t\t<div class=\"sign-document-info__details_title\">\n\t\t\t\t\t<span>${Text.encode(this.documentData.title ?? '')}</span>\n\t\t\t\t\t<span\n\t\t\t\t\t\tclass=\"sign-document-info__details_edit-title-btn\"\n\t\t\t\t\t\tonclick=\"${({ target: button }) => {\n\t\t\t\t\t\t\tthis.#toggleTitleEditor(button, true);\n\t\t\t\t\t\t}}\"\n\t\t\t\t\t>\n\t\t\t\t\t</span>\n\t\t\t\t</div>\n\t\t\t\t${this.#blocks}\n\t\t\t\t${this.#filledBlocks}\n\t\t\t</div>\n\t\t`;\n\t}\n\n\t#createTitleEditor(): HTMLElement\n\t{\n\t\tconst okButtonClassName = [\n\t\t\t...buttonClassList.slice(0, 2),\n\t\t\t'ui-btn-primary',\n\t\t\t'sign-document-info__title-editor_ok-btn',\n\t\t].join(' ');\n\t\tconst discardButtonClassName = [\n\t\t\t...buttonClassList.slice(0, 3),\n\t\t\t'sign-document-info__title-editor_discard-btn',\n\t\t].join(' ');\n\t\tconst input = Tag.render`<input type=\"text\" class=\"ui-ctl-element\" />`;\n\t\tinput.value = this.documentData.title ?? '';\n\t\tthis.#focusInput(input);\n\n\t\treturn Tag.render`\n\t\t\t<div class=\"sign-document-info__title-editor\">\n\t\t\t\t<div class=\"sign-document-info__title-editor_controls\">\n\t\t\t\t\t<span class=\"ui-ctl ui-ctl-textbox ui-ctl-w100\">\n\t\t\t\t\t\t${input}\n\t\t\t\t\t</span>\n\t\t\t\t\t<span\n\t\t\t\t\t\tclass=\"${okButtonClassName}\"\n\t\t\t\t\t\tonclick=\"${async ({ target }) => {\n\t\t\t\t\t\t\tDom.addClass(target, 'ui-btn-wait');\n\t\t\t\t\t\t\tawait this.#modifyDocumentTitle(input.value);\n\t\t\t\t\t\t\tDom.removeClass(target, 'ui-btn-wait');\n\t\t\t\t\t\t\tthis.#toggleTitleEditor(target, false);\n\t\t\t\t\t\t}}\"\n\t\t\t\t\t>\n\t\t\t\t\t</span>\n\t\t\t\t\t<span\n\t\t\t\t\t\tclass=\"${discardButtonClassName}\"\n\t\t\t\t\t\tonclick=\"${({ target }) => {\n\t\t\t\t\t\t\tthis.#toggleTitleEditor(target, false);\n\t\t\t\t\t\t}}\"\n\t\t\t\t\t>\n\t\t\t\t\t</span>\n\t\t\t\t</div>\n\t\t\t\t<p class=\"sign-document-info__title-editor_help\">\n\t\t\t\t\t${Loc.getMessage('SIGN_DOCUMENT_INFO_TITLE_EDITOR_HELP')}\n\t\t\t\t</p>\n\t\t\t</div>\n\t\t`;\n\t}\n\n\t#toggleTitleEditor(button: HTMLElement, shouldShow: boolean)\n\t{\n\t\tconst summaryNode = button.closest('.sign-document-info__summary');\n\t\tif (shouldShow)\n\t\t{\n\t\t\tDom.clean(summaryNode);\n\t\t\tDom.append(this.#createTitleEditor(), summaryNode);\n\n\t\t\treturn;\n\t\t}\n\n\t\tDom.replace(summaryNode.firstElementChild, this.#createDocumentDetails());\n\t\tDom.append(this.#editDocumentBtn, summaryNode);\n\t}\n\n\t#focusInput(input: HTMLElement)\n\t{\n\t\tconst observer = new MutationObserver(() => {\n\t\t\tif (input.isConnected)\n\t\t\t{\n\t\t\t\tinput.focus();\n\t\t\t\tobserver.disconnect();\n\t\t\t}\n\t\t});\n\t\tobserver.observe(document.body, { childList: true, subtree: true });\n\t}\n\n\tasync #modifyDocumentTitle(newValue: string)\n\t{\n\t\tconst { title = '', uid = '' } = this.documentData;\n\t\tif (title === newValue)\n\t\t{\n\t\t\treturn;\n\t\t}\n\n\t\ttry\n\t\t{\n\t\t\tawait this.#api.modifyTitle(uid, newValue);\n\t\t\tthis.documentData = {\n\t\t\t\t...this.documentData,\n\t\t\t\ttitle: newValue,\n\t\t\t};\n\t\t\tthis.emit('changeTitle', { newValue });\n\t\t}\n\t\tcatch (ex)\n\t\t{\n\t\t\tconsole.error(ex);\n\t\t}\n\t}\n\n\t#attachMenu(idMeans: HTMLElement, entityData): Menu\n\t{\n\t\tlet menuItems = [];\n\t\tconst menuId = `${menuPrefix}-${entityData.entityTypeId}-${entityData.id}`;\n\t\tif (this.#menus[menuId])\n\t\t{\n\t\t\tlet items = this.#menus[menuId].getMenuItems();\n\t\t\tconst swap = (array, from, to) => {\n\t\t\t\tconst tmp = array[to];\n\t\t\t\t// eslint-disable-next-line no-param-reassign\n\t\t\t\tarray[to] = array[from];\n\t\t\t\t// eslint-disable-next-line no-param-reassign\n\t\t\t\tarray[from] = tmp;\n\t\t\t};\n\n\t\t\twhile (items.length > 1)\n\t\t\t{\n\t\t\t\tif (items[0].id === 'show-member')\n\t\t\t\t{\n\t\t\t\t\tswap(items, 0, 1);\n\t\t\t\t\tcontinue;\n\t\t\t\t}\n\t\t\t\tthis.#menus[menuId].removeMenuItem(items[0].id);\n\t\t\t\titems = this.#menus[menuId].getMenuItems();\n\t\t\t}\n\t\t}\n\n\t\tthis.#api.loadCommunications(entityData.uid).then(async (multiFields) => {\n\t\t\tlet selectedCommunication = {};\n\t\t\tconst restrictions = await this.#api.loadRestrictions();\n\t\t\tconst mapper = (communication) => {\n\t\t\t\tconst text = communication.VALUE;\n\n\t\t\t\tif ((communication?.TYPE === 'PHONE' && restrictions.smsAllowed)\n\t\t\t\t\t|| (communication?.TYPE === 'EMAIL' && Object.keys(selectedCommunication).length === 0))\n\t\t\t\t{\n\t\t\t\t\tselectedCommunication = communication;\n\t\t\t\t}\n\n\t\t\t\treturn {\n\t\t\t\t\ttext,\n\t\t\t\t\tonclick: ({ target }) => {\n\t\t\t\t\t\tthis.#updateCommunications(entityData, communication);\n\t\t\t\t\t\t// eslint-disable-next-line no-param-reassign\n\t\t\t\t\t\tidMeans.firstElementChild.textContent = text;\n\t\t\t\t\t\tthis.#menus[menuId].close();\n\t\t\t\t\t},\n\t\t\t\t};\n\t\t\t};\n\n\t\t\tmenuItems = [\n\t\t\t\t// eslint-disable-next-line no-unsafe-optional-chaining\n\t\t\t\t...(multiFields?.EMAIL ? multiFields?.EMAIL.map((element) => mapper(element)) : []),\n\t\t\t\t// eslint-disable-next-line no-unsafe-optional-chaining\n\t\t\t\t...(multiFields?.PHONE ? multiFields?.PHONE.map((element) => mapper(element)) : []),\n\t\t\t];\n\t\t\tmenuItems.map((item) => this.#menus[menuId].addMenuItem(item, null));\n\t\t\tthis.#updateCommunications(entityData, selectedCommunication);\n\t\t\tidMeans.firstElementChild.textContent = selectedCommunication?.VALUE;\n\t\t}).catch(() => {});\n\n\t\tmenuItems.push({\n\t\t\tid: 'show-member',\n\t\t\ttext: Loc.getMessage('SIGN_DOCUMENT_INFO_OPEN_VIEW'),\n\t\t\tonclick: () => {\n\t\t\t\tthis.#showMemberInfo(idMeans, entityData);\n\t\t\t\tthis.#menus[menuId].close();\n\t\t\t},\n\t\t});\n\n\t\tif (!this.#menus[menuId])\n\t\t{\n\t\t\tthis.#menus[menuId] = MenuManager.create({\n\t\t\t\tid: menuId,\n\t\t\t\titems: menuItems,\n\t\t\t});\n\t\t\tconst popup = this.#menus[menuId].getPopupWindow();\n\t\t\tpopup.setBindElement(idMeans);\n\t\t}\n\n\t\t// eslint-disable-next-line no-param-reassign\n\t\tidMeans.firstElementChild.textContent = menuItems[0].text;\n\t\treturn this.#menus[menuId];\n\t}\n\n\t#showMemberInfo(idMeans: HTMLElement, entityData: Object)\n\t{\n\t\tconst { Instance: slider } = Reflection.getClass('BX.SidePanel');\n\t\tslider.open(entityData.url, {\n\t\t\tcacheable: false,\n\t\t\tallowChangeHistory: false,\n\t\t\tevents: {\n\t\t\t\tonClose: () => {\n\t\t\t\t\tthis.#attachMenu(idMeans, entityData);\n\t\t\t\t},\n\t\t\t},\n\t\t});\n\t}\n\n\t#createParties(): Array<HTMLElement>\n\t{\n\t\tconst parties = [\n\t\t\t{\n\t\t\t\tpartyTitle: Loc.getMessage('SIGN_DOCUMENT_INFO_FIRST_PARTY'),\n\t\t\t\tentityData: this.entityData.company,\n\t\t\t},\n\t\t\t{\n\t\t\t\tpartyTitle: Loc.getMessage('SIGN_DOCUMENT_INFO_PARTNER'),\n\t\t\t\tentityData: this.entityData.contact,\n\t\t\t},\n\t\t];\n\t\tObject.keys(MenuManager.Data).forEach((menuId) => {\n\t\t\tif (menuId.includes(menuPrefix))\n\t\t\t{\n\t\t\t\tMenuManager.destroy(menuId);\n\t\t\t}\n\t\t});\n\n\t\tthis.#menus = [];\n\n\t\treturn parties.map((party) => {\n\t\t\tconst { partyTitle, entityData } = party;\n\t\t\tconst { title } = entityData;\n\t\t\tconst idMeans = Tag.render`\n\t\t\t\t<span\n\t\t\t\t\tclass=\"sign-document-info__party_id-means\"\n\t\t\t\t\tonclick=\"${() => menu.show()}\"\n\t\t\t\t>\n\t\t\t\t\t<span></span>\n\t\t\t\t</span>\n\t\t\t`;\n\t\t\tconst menu = this.#attachMenu(idMeans, entityData);\n\n\t\t\treturn Tag.render`\n\t\t\t\t<div class=\"sign-document-info__party\">\n\t\t\t\t\t<div class=\"sign-document-info__party_summary\">\n\t\t\t\t\t\t<p class=\"sign-document-info__party_title\">${partyTitle}</p>\n\t\t\t\t\t\t<span class=\"sign-document-info__party_member-name\">\n\t\t\t\t\t\t\t${Text.encode(title)}\n\t\t\t\t\t\t</span>\n\t\t\t\t\t\t<span class=\"sign-document-info__party_status\">\n\t\t\t\t\t\t\t${Loc.getMessage('SIGN_DOCUMENT_INFO_NOT_SIGNED')}\n\t\t\t\t\t\t</span>\n\t\t\t\t\t</div>\n\t\t\t\t\t<div class=\"sign-document-info__party_id\">\n\t\t\t\t\t\t<p class=\"sign-document-info__party_title\">\n\t\t\t\t\t\t\t${Loc.getMessage('SIGN_DOCUMENT_INFO_ID')}\n\t\t\t\t\t\t</p>\n\t\t\t\t\t\t${idMeans}\n\t\t\t\t\t</div>\n\t\t\t\t</div>\n\t\t\t`;\n\t\t});\n\t}\n\n\t#updateCommunications(entityData, communication)\n\t{\n\t\t// eslint-disable-next-line @bitrix24/bitrix24-rules/no-typeof\n\t\tif (typeof communication === 'undefined')\n\t\t{\n\t\t\treturn;\n\t\t}\n\n\t\tconst { TYPE: type, VALUE: value } = communication;\n\t\tthis.communications = {\n\t\t\t...this.communications,\n\t\t\t[entityData.type]: { type, value },\n\t\t};\n\t}\n\n\trenderDocumentDetails()\n\t{\n\t\tconst blocks = this.documentData.blocks ?? [];\n\t\tconst addedBlocks = blocks.filter((block): boolean => block.party === 1).length;\n\t\tconst addedFilledBlocks = blocks.filter((block): boolean => block.party >= 2).length;\n\t\tconst addedBlocksTitle = Loc.getMessage('SIGN_DOCUMENT_INFO_ADDED_BLOCKS', {\n\t\t\t'#CNT#': addedBlocks,\n\t\t});\n\t\tconst filledBlocksTitle = Loc.getMessage('SIGN_DOCUMENT_INFO_ADDED_FILLED_FIELDS', {\n\t\t\t'#CNT#': addedFilledBlocks,\n\t\t});\n\t\tthis.#blocks.textContent = addedBlocksTitle;\n\t\tthis.#filledBlocks.textContent = filledBlocksTitle;\n\t}\n}\n"],"names":["buttonClassList","menuPrefix","DocumentSummary","EventEmitter","constructor","setEventNamespace","Tag","render","join","emit","Loc","getMessage","Api","documentData","entityData","communications","getLayout","renderDocumentDetails","blocks","addedBlocks","filter","block","party","length","addedFilledBlocks","addedBlocksTitle","filledBlocksTitle","textContent","Text","encode","title","target","button","okButtonClassName","slice","discardButtonClassName","input","value","Dom","addClass","removeClass","shouldShow","summaryNode","closest","clean","append","replace","firstElementChild","observer","MutationObserver","isConnected","focus","disconnect","observe","document","body","childList","subtree","newValue","uid","modifyTitle","ex","console","error","idMeans","menuItems","menuId","entityTypeId","id","items","getMenuItems","swap","array","from","to","tmp","removeMenuItem","loadCommunications","then","multiFields","selectedCommunication","restrictions","loadRestrictions","mapper","communication","text","VALUE","TYPE","smsAllowed","Object","keys","onclick","close","EMAIL","map","element","PHONE","item","addMenuItem","catch","push","MenuManager","create","popup","getPopupWindow","setBindElement","Instance","slider","Reflection","getClass","open","url","cacheable","allowChangeHistory","events","onClose","parties","partyTitle","company","contact","Data","forEach","includes","destroy","menu","show","type"],"mappings":"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"}