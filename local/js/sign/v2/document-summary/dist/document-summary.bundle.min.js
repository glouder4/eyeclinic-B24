this.BX=this.BX||{};this.BX.Sign=this.BX.Sign||{};(function(e,s,t,i,a){"use strict";let l=e=>e,o,n,r,c,d,b,u,p,v;const m=["ui-btn","ui-btn-sm","ui-btn-light-border","ui-btn-round"];const h="sign-member-communication";var _=babelHelpers.classPrivateFieldLooseKey("editDocumentBtn");var P=babelHelpers.classPrivateFieldLooseKey("api");var g=babelHelpers.classPrivateFieldLooseKey("blocks");var L=babelHelpers.classPrivateFieldLooseKey("filledBlocks");var f=babelHelpers.classPrivateFieldLooseKey("menus");var y=babelHelpers.classPrivateFieldLooseKey("createDocumentDetails");var F=babelHelpers.classPrivateFieldLooseKey("createTitleEditor");var H=babelHelpers.classPrivateFieldLooseKey("toggleTitleEditor");var B=babelHelpers.classPrivateFieldLooseKey("focusInput");var D=babelHelpers.classPrivateFieldLooseKey("modifyDocumentTitle");var E=babelHelpers.classPrivateFieldLooseKey("attachMenu");var O=babelHelpers.classPrivateFieldLooseKey("showMemberInfo");var T=babelHelpers.classPrivateFieldLooseKey("createParties");var N=babelHelpers.classPrivateFieldLooseKey("updateCommunications");class I extends t.EventEmitter{constructor(){super();Object.defineProperty(this,N,{value:k});Object.defineProperty(this,T,{value:x});Object.defineProperty(this,O,{value:K});Object.defineProperty(this,E,{value:j});Object.defineProperty(this,D,{value:w});Object.defineProperty(this,B,{value:S});Object.defineProperty(this,H,{value:$});Object.defineProperty(this,F,{value:C});Object.defineProperty(this,y,{value:M});Object.defineProperty(this,_,{writable:true,value:void 0});Object.defineProperty(this,P,{writable:true,value:void 0});Object.defineProperty(this,g,{writable:true,value:void 0});Object.defineProperty(this,L,{writable:true,value:void 0});Object.defineProperty(this,f,{writable:true,value:void 0});this.setEventNamespace("BX.Sign.V2.DocumentSummary");babelHelpers.classPrivateFieldLooseBase(this,_)[_]=s.Tag.render(o||(o=l`
			<span
				class="${0}"
				onclick="${0}"
			>
				${0}
			</span>
		`),m.join(" "),(()=>this.emit("showEditor")),s.Loc.getMessage("SIGN_DOCUMENT_INFO_EDIT"));babelHelpers.classPrivateFieldLooseBase(this,P)[P]=new a.Api;babelHelpers.classPrivateFieldLooseBase(this,g)[g]=s.Tag.render(n||(n=l`
			<p class="sign-document-info__details_structure"></p>
		`));babelHelpers.classPrivateFieldLooseBase(this,L)[L]=s.Tag.render(r||(r=l`
			<p class="sign-document-info__details_structure"></p>
		`));babelHelpers.classPrivateFieldLooseBase(this,f)[f]=[];this.documentData={};this.entityData={};this.communications={}}getLayout(){return s.Tag.render(c||(c=l`
			<div class="sign-document-info">
				<p class="sign-document-info__title">
					${0}
				</p>
				<div class="sign-document-info__summary">
					${0}
					${0}
				</div>
				${0}
			</div>
		`),s.Loc.getMessage("SIGN_DOCUMENT_INFO_SEND"),babelHelpers.classPrivateFieldLooseBase(this,y)[y](),babelHelpers.classPrivateFieldLooseBase(this,_)[_],babelHelpers.classPrivateFieldLooseBase(this,T)[T]())}renderDocumentDetails(){var e;const t=(e=this.documentData.blocks)!=null?e:[];const i=t.filter((e=>e.party===1)).length;const a=t.filter((e=>e.party>=2)).length;const l=s.Loc.getMessage("SIGN_DOCUMENT_INFO_ADDED_BLOCKS",{"#CNT#":i});const o=s.Loc.getMessage("SIGN_DOCUMENT_INFO_ADDED_FILLED_FIELDS",{"#CNT#":a});babelHelpers.classPrivateFieldLooseBase(this,g)[g].textContent=l;babelHelpers.classPrivateFieldLooseBase(this,L)[L].textContent=o}}function M(){var e;this.renderDocumentDetails();return s.Tag.render(d||(d=l`
			<div class="sign-document-info__details">
				<div class="sign-document-info__details_title">
					<span>${0}</span>
					<span
						class="sign-document-info__details_edit-title-btn"
						onclick="${0}"
					>
					</span>
				</div>
				${0}
				${0}
			</div>
		`),s.Text.encode((e=this.documentData.title)!=null?e:""),(({target:e})=>{babelHelpers.classPrivateFieldLooseBase(this,H)[H](e,true)}),babelHelpers.classPrivateFieldLooseBase(this,g)[g],babelHelpers.classPrivateFieldLooseBase(this,L)[L])}function C(){var e;const t=[...m.slice(0,2),"ui-btn-primary","sign-document-info__title-editor_ok-btn"].join(" ");const i=[...m.slice(0,3),"sign-document-info__title-editor_discard-btn"].join(" ");const a=s.Tag.render(b||(b=l`<input type="text" class="ui-ctl-element" />`));a.value=(e=this.documentData.title)!=null?e:"";babelHelpers.classPrivateFieldLooseBase(this,B)[B](a);return s.Tag.render(u||(u=l`
			<div class="sign-document-info__title-editor">
				<div class="sign-document-info__title-editor_controls">
					<span class="ui-ctl ui-ctl-textbox ui-ctl-w100">
						${0}
					</span>
					<span
						class="${0}"
						onclick="${0}"
					>
					</span>
					<span
						class="${0}"
						onclick="${0}"
					>
					</span>
				</div>
				<p class="sign-document-info__title-editor_help">
					${0}
				</p>
			</div>
		`),a,t,(async({target:e})=>{s.Dom.addClass(e,"ui-btn-wait");await babelHelpers.classPrivateFieldLooseBase(this,D)[D](a.value);s.Dom.removeClass(e,"ui-btn-wait");babelHelpers.classPrivateFieldLooseBase(this,H)[H](e,false)}),i,(({target:e})=>{babelHelpers.classPrivateFieldLooseBase(this,H)[H](e,false)}),s.Loc.getMessage("SIGN_DOCUMENT_INFO_TITLE_EDITOR_HELP"))}function $(e,t){const i=e.closest(".sign-document-info__summary");if(t){s.Dom.clean(i);s.Dom.append(babelHelpers.classPrivateFieldLooseBase(this,F)[F](),i);return}s.Dom.replace(i.firstElementChild,babelHelpers.classPrivateFieldLooseBase(this,y)[y]());s.Dom.append(babelHelpers.classPrivateFieldLooseBase(this,_)[_],i)}function S(e){const s=new MutationObserver((()=>{if(e.isConnected){e.focus();s.disconnect()}}));s.observe(document.body,{childList:true,subtree:true})}async function w(e){const{title:s="",uid:t=""}=this.documentData;if(s===e){return}try{await babelHelpers.classPrivateFieldLooseBase(this,P)[P].modifyTitle(t,e);this.documentData={...this.documentData,title:e};this.emit("changeTitle",{newValue:e})}catch(e){console.error(e)}}function j(e,t){let a=[];const l=`${h}-${t.entityTypeId}-${t.id}`;if(babelHelpers.classPrivateFieldLooseBase(this,f)[f][l]){let e=babelHelpers.classPrivateFieldLooseBase(this,f)[f][l].getMenuItems();const s=(e,s,t)=>{const i=e[t];e[t]=e[s];e[s]=i};while(e.length>1){if(e[0].id==="show-member"){s(e,0,1);continue}babelHelpers.classPrivateFieldLooseBase(this,f)[f][l].removeMenuItem(e[0].id);e=babelHelpers.classPrivateFieldLooseBase(this,f)[f][l].getMenuItems()}}babelHelpers.classPrivateFieldLooseBase(this,P)[P].loadCommunications(t.uid).then((async s=>{var i;let o={};const n=await babelHelpers.classPrivateFieldLooseBase(this,P)[P].loadRestrictions();const r=s=>{const i=s.VALUE;if((s==null?void 0:s.TYPE)==="PHONE"&&n.smsAllowed||(s==null?void 0:s.TYPE)==="EMAIL"&&Object.keys(o).length===0){o=s}return{text:i,onclick:({target:a})=>{babelHelpers.classPrivateFieldLooseBase(this,N)[N](t,s);e.firstElementChild.textContent=i;babelHelpers.classPrivateFieldLooseBase(this,f)[f][l].close()}}};a=[...s!=null&&s.EMAIL?s==null?void 0:s.EMAIL.map((e=>r(e))):[],...s!=null&&s.PHONE?s==null?void 0:s.PHONE.map((e=>r(e))):[]];a.map((e=>babelHelpers.classPrivateFieldLooseBase(this,f)[f][l].addMenuItem(e,null)));babelHelpers.classPrivateFieldLooseBase(this,N)[N](t,o);e.firstElementChild.textContent=(i=o)==null?void 0:i.VALUE})).catch((()=>{}));a.push({id:"show-member",text:s.Loc.getMessage("SIGN_DOCUMENT_INFO_OPEN_VIEW"),onclick:()=>{babelHelpers.classPrivateFieldLooseBase(this,O)[O](e,t);babelHelpers.classPrivateFieldLooseBase(this,f)[f][l].close()}});if(!babelHelpers.classPrivateFieldLooseBase(this,f)[f][l]){babelHelpers.classPrivateFieldLooseBase(this,f)[f][l]=i.MenuManager.create({id:l,items:a});const s=babelHelpers.classPrivateFieldLooseBase(this,f)[f][l].getPopupWindow();s.setBindElement(e)}e.firstElementChild.textContent=a[0].text;return babelHelpers.classPrivateFieldLooseBase(this,f)[f][l]}function K(e,t){const{Instance:i}=s.Reflection.getClass("BX.SidePanel");i.open(t.url,{cacheable:false,allowChangeHistory:false,events:{onClose:()=>{babelHelpers.classPrivateFieldLooseBase(this,E)[E](e,t)}}})}function x(){const e=[{partyTitle:s.Loc.getMessage("SIGN_DOCUMENT_INFO_FIRST_PARTY"),entityData:this.entityData.company},{partyTitle:s.Loc.getMessage("SIGN_DOCUMENT_INFO_PARTNER"),entityData:this.entityData.contact}];Object.keys(i.MenuManager.Data).forEach((e=>{if(e.includes(h)){i.MenuManager.destroy(e)}}));babelHelpers.classPrivateFieldLooseBase(this,f)[f]=[];return e.map((e=>{const{partyTitle:t,entityData:i}=e;const{title:a}=i;const o=s.Tag.render(p||(p=l`
				<span
					class="sign-document-info__party_id-means"
					onclick="${0}"
				>
					<span></span>
				</span>
			`),(()=>n.show()));const n=babelHelpers.classPrivateFieldLooseBase(this,E)[E](o,i);return s.Tag.render(v||(v=l`
				<div class="sign-document-info__party">
					<div class="sign-document-info__party_summary">
						<p class="sign-document-info__party_title">${0}</p>
						<span class="sign-document-info__party_member-name">
							${0}
						</span>
						<span class="sign-document-info__party_status">
							${0}
						</span>
					</div>
					<div class="sign-document-info__party_id">
						<p class="sign-document-info__party_title">
							${0}
						</p>
						${0}
					</div>
				</div>
			`),t,s.Text.encode(a),s.Loc.getMessage("SIGN_DOCUMENT_INFO_NOT_SIGNED"),s.Loc.getMessage("SIGN_DOCUMENT_INFO_ID"),o)}))}function k(e,s){if(typeof s==="undefined"){return}const{TYPE:t,VALUE:i}=s;this.communications={...this.communications,[e.type]:{type:t,value:i}}}e.DocumentSummary=I})(this.BX.Sign.V2=this.BX.Sign.V2||{},BX,BX.Event,BX.Main,BX.Sign.V2);
//# sourceMappingURL=document-summary.bundle.map.js