this.BX=this.BX||{};this.BX.Sign=this.BX.Sign||{};(function(e,s,t,l,a,i,o,r){"use strict";let n=e=>e,c,d;class b{constructor(e){this.props=e}createListItem(e={}){const{events:s={},children:t=[]}=e;const{title:l,description:a="",modifier:i}=this.props;const r=o.Tag.render(c||(c=n`
			<span
				class="sign-blank-selector__list_item-title"
				title="${0}"
			>
				${0}
			</span>
		`),o.Text.encode(l),o.Text.encode(l));const b=o.Tag.render(d||(d=n`
			<span class="sign-blank-selector__list_item-info">
				${0}
			</span>
		`),o.Text.encode(a).replaceAll("[br]","<br />"));return o.Dom.create("div",{attrs:{className:`sign-blank-selector__list_item --${i}`},events:s,children:[...t,r,b]})}getLayout(){if(!this.layout){this.layout=this.createListItem()}return this.layout}}let p=e=>e,v;var h=babelHelpers.classPrivateFieldLooseKey("statusNode");var L=babelHelpers.classPrivateFieldLooseKey("loader");class g extends b{constructor(e){super({...e,modifier:"blank"});Object.defineProperty(this,h,{writable:true,value:void 0});Object.defineProperty(this,L,{writable:true,value:void 0});babelHelpers.classPrivateFieldLooseBase(this,h)[h]=o.Tag.render(v||(v=p`
			<div class="sign-blank-selector__list_item-status"></div>
		`));babelHelpers.classPrivateFieldLooseBase(this,L)[L]=new r.Loader({size:30,target:babelHelpers.classPrivateFieldLooseBase(this,h)[h]})}createListItem(){return super.createListItem({children:[babelHelpers.classPrivateFieldLooseBase(this,h)[h]]})}focus(){this.getLayout().focus()}select(){o.Dom.addClass(this.layout,"--active")}deselect(e){o.Dom.removeClass(this.layout,"--active")}remove(){o.Dom.remove(this.getLayout())}set id(e){this.getLayout().dataset.id=e}set ready(e){if(!e){babelHelpers.classPrivateFieldLooseBase(this,L)[L].show();return}const s=this.getLayout();s.tabIndex="0";babelHelpers.classPrivateFieldLooseBase(this,L)[L].hide();o.Dom.addClass(s,"--loaded")}}let u=e=>e,F,P,B,H,m,f;const y={controller:"sign.upload.blankUploadController",acceptedFileTypes:[".jpg",".jpeg",".png",".pdf",".doc",".docx",".rtf",".odt"],multiple:true,autoUpload:false,maxFileSize:50*1024*1024,imageMaxFileSize:10*1024*1024,maxTotalFileSize:50*1024*1024};const _={id:"qwerty",padding:20,offsetLeft:40,offsetTop:-12,angle:true,darkMode:true,width:300,autoHide:true,cacheable:false,bindOptions:{position:"bottom"}};var E=babelHelpers.classPrivateFieldLooseKey("tileWidget");var k=babelHelpers.classPrivateFieldLooseKey("tileWidgetContainer");var T=babelHelpers.classPrivateFieldLooseKey("uploadButtonsContainer");var O=babelHelpers.classPrivateFieldLooseKey("relatedTarget");var S=babelHelpers.classPrivateFieldLooseKey("blanksContainer");var C=babelHelpers.classPrivateFieldLooseKey("page");var w=babelHelpers.classPrivateFieldLooseKey("loadMoreButton");var I=babelHelpers.classPrivateFieldLooseKey("api");var D=babelHelpers.classPrivateFieldLooseKey("config");var A=babelHelpers.classPrivateFieldLooseKey("checkForFilesValid");var K=babelHelpers.classPrivateFieldLooseKey("onFileBeforeAdd");var U=babelHelpers.classPrivateFieldLooseKey("getImagesLimit");var N=babelHelpers.classPrivateFieldLooseKey("onFileAdd");var j=babelHelpers.classPrivateFieldLooseKey("onFileRemove");var R=babelHelpers.classPrivateFieldLooseKey("onUploadStart");var M=babelHelpers.classPrivateFieldLooseKey("toggleTileVisibility");var $=babelHelpers.classPrivateFieldLooseKey("createUploadButtons");var X=babelHelpers.classPrivateFieldLooseKey("resumeUploading");var x=babelHelpers.classPrivateFieldLooseKey("loadBlanks");var G=babelHelpers.classPrivateFieldLooseKey("setupBlank");class V extends i.EventEmitter{constructor(e){super();Object.defineProperty(this,G,{value:le});Object.defineProperty(this,x,{value:te});Object.defineProperty(this,X,{value:se});Object.defineProperty(this,$,{value:ee});Object.defineProperty(this,M,{value:Z});Object.defineProperty(this,R,{value:Y});Object.defineProperty(this,j,{value:Q});Object.defineProperty(this,N,{value:J});Object.defineProperty(this,U,{value:q});Object.defineProperty(this,K,{value:z});Object.defineProperty(this,A,{value:W});Object.defineProperty(this,E,{writable:true,value:void 0});Object.defineProperty(this,k,{writable:true,value:void 0});Object.defineProperty(this,T,{writable:true,value:void 0});Object.defineProperty(this,O,{writable:true,value:void 0});Object.defineProperty(this,S,{writable:true,value:void 0});Object.defineProperty(this,C,{writable:true,value:void 0});Object.defineProperty(this,w,{writable:true,value:void 0});Object.defineProperty(this,I,{writable:true,value:void 0});Object.defineProperty(this,D,{writable:true,value:void 0});this.setEventNamespace("BX.Sign.V2.BlankSelector");this.subscribeFromOptions(e==null?void 0:e.events);babelHelpers.classPrivateFieldLooseBase(this,D)[D]=e;this.selectedBlankId=0;this.blanks=new Map;babelHelpers.classPrivateFieldLooseBase(this,C)[C]=0;const s=babelHelpers.classPrivateFieldLooseBase(this,$)[$]();const i=o.Tag.render(F||(F=u`
			<label class="sign-blank-selector__list_drag-area-label">
				${0}
			</label>
		`),o.Loc.getMessage("SIGN_BLANK_SELECTOR_DRAG_AREA"));const r={slots:{afterDropArea:{computed:{title:()=>o.Loc.getMessage("SIGN_BLANK_SELECTOR_CLEAR_ALL")},methods:{clear:()=>{this.clearFiles({removeFromServer:false})}},template:`\n\t\t\t\t\t\t<span\n\t\t\t\t\t\t\tclass="sign-blank-selector__tile-widget_clear-btn"\n\t\t\t\t\t\t\t:title="title"\n\t\t\t\t\t\t\t@click="clear()"\n\t\t\t\t\t\t>\n\t\t\t\t\t\t</span>\n\t\t\t\t\t`}}};babelHelpers.classPrivateFieldLooseBase(this,T)[T]=o.Tag.render(P||(P=u`
			<div class="sign-blank-selector__list --with-buttons">
				${0}
				${0}
			</div>
		`),s,i);babelHelpers.classPrivateFieldLooseBase(this,E)[E]=new t.TileWidget({...y,...e.uploaderOptions,dropElement:babelHelpers.classPrivateFieldLooseBase(this,T)[T],browseElement:[...s,i],events:{[l.UploaderEvent.BEFORE_FILES_ADD]:e=>babelHelpers.classPrivateFieldLooseBase(this,K)[K](e),[l.UploaderEvent.FILE_ADD]:e=>babelHelpers.classPrivateFieldLooseBase(this,N)[N](e),[l.UploaderEvent.FILE_REMOVE]:e=>babelHelpers.classPrivateFieldLooseBase(this,j)[j](e),[l.UploaderEvent.UPLOAD_START]:e=>babelHelpers.classPrivateFieldLooseBase(this,R)[R](e)}},r);babelHelpers.classPrivateFieldLooseBase(this,O)[O]=null;o.Event.bind(document,"mousedown",(e=>{babelHelpers.classPrivateFieldLooseBase(this,O)[O]=e.target}));babelHelpers.classPrivateFieldLooseBase(this,S)[S]=o.Tag.render(B||(B=u`
			<div
				class="sign-blank-selector__list"
				onfocusin="${0}"
				onfocusout="${0}"
			></div>
		`),(({target:e})=>{this.selectBlank(+e.dataset.id)}),(({target:e})=>{this.resetSelectedBlank(+e.dataset.id,babelHelpers.classPrivateFieldLooseBase(this,O)[O])}));babelHelpers.classPrivateFieldLooseBase(this,k)[k]=o.Tag.render(H||(H=u`
			<div class="sign-blank-selector__tile-widget"></div>
		`));babelHelpers.classPrivateFieldLooseBase(this,w)[w]=o.Tag.render(m||(m=u`
			<button
				class="ui-btn ui-btn-light-border sign-blank-selector__load-more-btn --hidden"
				onclick="${0}"
			>
				${0}
			</button>
		`),(()=>babelHelpers.classPrivateFieldLooseBase(this,x)[x](babelHelpers.classPrivateFieldLooseBase(this,C)[C]+1)),o.Loc.getMessage("SIGN_BLANK_SELECTOR_LOAD_MORE"));babelHelpers.classPrivateFieldLooseBase(this,I)[I]=new a.Api}async createBlank(){const e=babelHelpers.classPrivateFieldLooseBase(this,E)[E].getUploader();const s=e.getFiles();const[t]=s;await babelHelpers.classPrivateFieldLooseBase(this,X)[X]();const l=t.getCustomData(t.getId());try{const e=s.map((e=>e.getServerFileId()));const t=await babelHelpers.classPrivateFieldLooseBase(this,I)[I].createBlank(e);const a=t.id;babelHelpers.classPrivateFieldLooseBase(this,G)[G](a,l);return a}catch(e){l.remove();throw e}}resetSelectedBlank(e,s){const t=this.blanks.get(this.selectedBlankId);this.selectedBlankId=0;t==null?void 0:t.deselect();this.emit("toggleSelection",{blankId:e,relatedTarget:s,selected:false})}selectBlank(e){if(e!==this.selectedBlankId){this.resetSelectedBlank()}this.selectedBlankId=e;babelHelpers.classPrivateFieldLooseBase(this,M)[M](false);const s=this.blanks.get(e);s.select();this.emit("toggleSelection",{selected:true})}deleteBlank(e){const s=this.blanks.get(e);if(s){this.blanks.delete(e);s.remove()}}clearFiles(e){const s=babelHelpers.classPrivateFieldLooseBase(this,E)[E].getUploader();s.removeFiles(e)}isFilesReadyForUpload(){if(babelHelpers.classPrivateFieldLooseBase(this,E)[E].getUploader().getFiles().length===0){return false}return babelHelpers.classPrivateFieldLooseBase(this,E)[E].getUploader().getFiles().every((e=>e.getErrors().length<=0))}getLayout(){babelHelpers.classPrivateFieldLooseBase(this,E)[E].renderTo(babelHelpers.classPrivateFieldLooseBase(this,k)[k]);babelHelpers.classPrivateFieldLooseBase(this,M)[M](false);const e=o.Tag.render(f||(f=u`
			<div class="sign-blank-selector">
				<p class="sign-blank-selector__add-title">
					${0}
				</p>
				${0}
				${0}
				<p class="sign-blank-selector__templates_title">
					${0}
				</p>
				${0}
				${0}
			</div>`),o.Loc.getMessage("SIGN_BLANK_SELECTOR_ADD_TITLE"),babelHelpers.classPrivateFieldLooseBase(this,k)[k],babelHelpers.classPrivateFieldLooseBase(this,T)[T],o.Loc.getMessage("SIGN_BLANK_SELECTOR_RECENT_TEMPLATES_TITLE"),babelHelpers.classPrivateFieldLooseBase(this,S)[S],babelHelpers.classPrivateFieldLooseBase(this,w)[w]);if(babelHelpers.classPrivateFieldLooseBase(this,C)[C]===0){babelHelpers.classPrivateFieldLooseBase(this,x)[x](1)}return e}}function W(e){const s=e=>e.getType().includes("image/");const t=e.every((e=>s(e)));const l=e.every((e=>y.acceptedFileTypes.includes(`.${e.getExtension()}`)));if(!l||e.length>1&&!t){return false}const a=babelHelpers.classPrivateFieldLooseBase(this,E)[E].getUploader();const i=a.getFiles();const o=i.length;const r=babelHelpers.classPrivateFieldLooseBase(this,U)[U]();if(o===0&&e.length===1){return true}const n=i.every((e=>s(e)));const c=t&&n&&r-o>=e.length;return c}function z(e){const{files:t}=e.getData();const l=babelHelpers.classPrivateFieldLooseBase(this,A)[A](t);if(l){return}let a=babelHelpers.classPrivateFieldLooseBase(this,T)[T].firstElementChild;if(o.Dom.hasClass(babelHelpers.classPrivateFieldLooseBase(this,T)[T],"--hidden")){const{$refs:{container:e}}=babelHelpers.classPrivateFieldLooseBase(this,E)[E].getRootComponent();a=e.firstElementChild}const i=new s.Popup({..._,bindElement:a,content:o.Loc.getMessage("SIGN_BLANK_SELECTOR_UPLOAD_HINT",{"%imageCountLimit%":babelHelpers.classPrivateFieldLooseBase(this,U)[U]()})});i.show();e.preventDefault()}function q(){var e,s;return o.Type.isInteger(parseInt((e=babelHelpers.classPrivateFieldLooseBase(this,D)[D])==null?void 0:e.imagesCountLimitForBlankUpload,10))?(s=babelHelpers.classPrivateFieldLooseBase(this,D)[D])==null?void 0:s.imagesCountLimitForBlankUpload:20}function J(){babelHelpers.classPrivateFieldLooseBase(this,M)[M](true);this.emit("addFile")}function Q(e){this.emit("removeFile");const{file:s}=e.getData();const t=babelHelpers.classPrivateFieldLooseBase(this,E)[E].getUploader();const l=t.getFiles();if(l.length===0){babelHelpers.classPrivateFieldLooseBase(this,M)[M](false);this.emit("clearFiles")}}function Y(){const e=babelHelpers.classPrivateFieldLooseBase(this,E)[E].getUploader();const[s]=e.getFiles();const t=s.getName();const l=s.getId();const a=new g({title:t});a.ready=false;o.Dom.prepend(a.getLayout(),babelHelpers.classPrivateFieldLooseBase(this,S)[S]);s.setCustomData(l,a)}function Z(e){const s="--hidden";if(e){o.Dom.removeClass(babelHelpers.classPrivateFieldLooseBase(this,k)[k],s);o.Dom.addClass(babelHelpers.classPrivateFieldLooseBase(this,T)[T],s);return}o.Dom.addClass(babelHelpers.classPrivateFieldLooseBase(this,k)[k],s);o.Dom.removeClass(babelHelpers.classPrivateFieldLooseBase(this,T)[T],s)}function ee(){const e={img:{title:o.Loc.getMessage("SIGN_BLANK_SELECTOR_CREATE_NEW_PIC"),description:`jpeg, png`},pdf:{title:o.Loc.getMessage("SIGN_BLANK_SELECTOR_NEW_PDF"),description:`Adobe Acrobat`},doc:{title:o.Loc.getMessage("SIGN_BLANK_SELECTOR_CREATE_NEW_DOC"),description:`Microsoft Word`}};const s=Object.entries(e);return s.map((([e,{title:s,description:t}])=>new b({title:s,description:t,modifier:e}).getLayout()))}async function se(){const e=babelHelpers.classPrivateFieldLooseBase(this,E)[E].getUploader();const s=e.getFiles();e.setMaxParallelUploads(s.length);const t=new Promise((s=>{e.subscribeOnce("onUploadComplete",s)}));e.start();await t}async function te(e){const s=new r.Loader({target:babelHelpers.classPrivateFieldLooseBase(this,S)[S],size:80,mode:"custom"});s.show();try{const s=await babelHelpers.classPrivateFieldLooseBase(this,I)[I].loadBlanks(e);const t=10;if(s.length<t){o.Dom.addClass(babelHelpers.classPrivateFieldLooseBase(this,w)[w],"--hidden")}else{o.Dom.removeClass(babelHelpers.classPrivateFieldLooseBase(this,w)[w],"--hidden")}if(s.length>0){s.forEach((({title:e,id:s})=>{const t=new g({title:e});babelHelpers.classPrivateFieldLooseBase(this,G)[G](s,t);o.Dom.append(t.getLayout(),babelHelpers.classPrivateFieldLooseBase(this,S)[S])}));babelHelpers.classPrivateFieldLooseBase(this,C)[C]=e}}catch(e){o.Dom.removeClass(babelHelpers.classPrivateFieldLooseBase(this,w)[w],"--hidden")}s.destroy()}function le(e,s){s.id=e;s.ready=true;this.blanks.set(e,s)}e.BlankSelector=V})(this.BX.Sign.V2=this.BX.Sign.V2||{},BX.Main,BX.UI.Uploader,BX.UI.Uploader,BX.Sign.V2,BX.Event,BX,BX);
//# sourceMappingURL=blank-selector.bundle.map.js