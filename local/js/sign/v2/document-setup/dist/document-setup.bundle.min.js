this.BX=this.BX||{};this.BX.Sign=this.BX.Sign||{};(function(e,s,t,a,l){"use strict";let i=e=>e,r;var o=babelHelpers.classPrivateFieldLooseKey("layout");var n=babelHelpers.classPrivateFieldLooseKey("api");var c=babelHelpers.classPrivateFieldLooseKey("lastBlankId");var b=babelHelpers.classPrivateFieldLooseKey("uids");var d=babelHelpers.classPrivateFieldLooseKey("register");var u=babelHelpers.classPrivateFieldLooseKey("change");var v=babelHelpers.classPrivateFieldLooseKey("getPages");var h=babelHelpers.classPrivateFieldLooseKey("convertToBase64");var p=babelHelpers.classPrivateFieldLooseKey("waitForConnect");class B extends t.EventEmitter{constructor(e){super();Object.defineProperty(this,p,{value:y});Object.defineProperty(this,h,{value:H});Object.defineProperty(this,v,{value:L});Object.defineProperty(this,u,{value:F});Object.defineProperty(this,d,{value:P});Object.defineProperty(this,o,{writable:true,value:void 0});Object.defineProperty(this,n,{writable:true,value:void 0});Object.defineProperty(this,c,{writable:true,value:void 0});Object.defineProperty(this,b,{writable:true,value:void 0});this.setEventNamespace("BX.Sign.V2.DocumentSetup");this.blankSelector=new a.BlankSelector({...e,events:{toggleSelection:({data:e})=>{this.emit("toggleSelection",e)},addFile:()=>this.emit("addFile"),removeFile:()=>this.emit("removeFile"),clearFiles:()=>this.emit("clearFiles")}});babelHelpers.classPrivateFieldLooseBase(this,o)[o]=s.Tag.render(r||(r=i`
			<div class="sign-document-setup">
				${0}
			</div>
		`),this.blankSelector.getLayout());babelHelpers.classPrivateFieldLooseBase(this,n)[n]=new l.Api;babelHelpers.classPrivateFieldLooseBase(this,c)[c]=0;babelHelpers.classPrivateFieldLooseBase(this,b)[b]=new Map;this.setupData=null}finishSetup(e,s=0){this.setupData=e;babelHelpers.classPrivateFieldLooseBase(this,c)[c]=s;this.blankSelector.clearFiles({removeFromServer:false})}rollbackBlank(e){this.blankSelector.deleteBlank(e)}async setup(){const{selectedBlankId:e}=this.blankSelector;if(babelHelpers.classPrivateFieldLooseBase(this,c)[c]>0&&babelHelpers.classPrivateFieldLooseBase(this,c)[c]===e){this.setupData={...this.setupData,isTemplate:true};return this.setupData}let t=0;try{s.Dom.addClass(babelHelpers.classPrivateFieldLooseBase(this,o)[o],"--pending");t=e||await this.blankSelector.createBlank();const a=babelHelpers.classPrivateFieldLooseBase(this,b)[b].has(t);const l=a?await babelHelpers.classPrivateFieldLooseBase(this,u)[u](babelHelpers.classPrivateFieldLooseBase(this,b)[b].get(t),t):await babelHelpers.classPrivateFieldLooseBase(this,d)[d](t);babelHelpers.classPrivateFieldLooseBase(this,b)[b].set(t,l);await babelHelpers.classPrivateFieldLooseBase(this,n)[n].upload(l);const[i,r]=await Promise.all([babelHelpers.classPrivateFieldLooseBase(this,n)[n].loadDocument(l),this.loadBlocks(l)]);const c=!!e;this.finishSetup({...i,blocks:r,isTemplate:c},t)}catch{this.finishSetup(null,t);if(t){this.rollbackBlank(t)}}s.Dom.removeClass(babelHelpers.classPrivateFieldLooseBase(this,o)[o],"--pending");return this.setupData}loadBlocks(e){return babelHelpers.classPrivateFieldLooseBase(this,n)[n].loadBlocksByDocument(e)}getLayout(){babelHelpers.classPrivateFieldLooseBase(this,p)[p]();return babelHelpers.classPrivateFieldLooseBase(this,o)[o]}async waitForPagesList(e,s){var t;this.blankSelector.resetSelectedBlank();const a=this.setupData.uid;let l=null;let i=null;let r=false;const o=new Promise((s=>{l=s;i=setInterval((async()=>{if(r){return}const e=await babelHelpers.classPrivateFieldLooseBase(this,v)[v](a);if(e.length>0){s(e)}}),e)}));(t=BX.PULL)==null?void 0:t.subscribe({moduleId:"sign",command:"blankIsReady",callback:async e=>{if(r){return}const s=await babelHelpers.classPrivateFieldLooseBase(this,h)[h](e==null?void 0:e.pages);if(s.length>0){l(s)}}});const n=await o;clearInterval(i);r=true;s(n);this.blankSelector.selectBlank(babelHelpers.classPrivateFieldLooseBase(this,c)[c])}}async function P(e){var s;const t=await babelHelpers.classPrivateFieldLooseBase(this,n)[n].register(e);return(s=t==null?void 0:t.uid)!=null?s:""}async function F(e,s){var t;const a=await babelHelpers.classPrivateFieldLooseBase(this,n)[n].changeDocument(e,s);return(t=a==null?void 0:a.uid)!=null?t:""}async function L(e){const s=await babelHelpers.classPrivateFieldLooseBase(this,n)[n].getPages(e);return babelHelpers.classPrivateFieldLooseBase(this,h)[h](s==null?void 0:s.pages)}async function H(e){if(!e){return[]}const t=e.map((async e=>{const t=await fetch(e.url);const a=await t.blob();const l=new FileReader;await new Promise((e=>{s.Event.bindOnce(l,"loadend",e);l.readAsDataURL(a)}));return l.result}));return Promise.all(t)}function y(){const e=new MutationObserver((()=>{if(!babelHelpers.classPrivateFieldLooseBase(this,o)[o].isConnected){return}const{blanks:s,selectedBlankId:t}=this.blankSelector;const a=s.get(t);a==null?void 0:a.focus();e.disconnect()}));e.observe(document.body,{childList:true,subtree:true})}e.DocumentSetup=B})(this.BX.Sign.V2=this.BX.Sign.V2||{},BX,BX.Event,BX.Sign.V2,BX.Sign.V2);
//# sourceMappingURL=document-setup.bundle.map.js