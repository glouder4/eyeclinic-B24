this.BX=this.BX||{};this.BX.Sign=this.BX.Sign||{};(function(e,s,t,a,i,l,o,r,n,c,d,b,p,v,u,h,g,P,L){"use strict";let m=e=>e,f;class y extends L.EventEmitter{constructor(e){super();this.data={};this.events={onChange:"onChange",onColorStyleChange:"onColorStyleChange"};this.setEventNamespace("BX.Sign.V2.Editor.Blocks.Dummy");this.block=e}isSingleton(){return false}isStyleAllowed(){return true}setData(e){this.data=e?e:{}}setText(e){this.setData({text:e})}getInitDimension(){return{width:250,height:28}}getData(){return this.data}getActionButton(){return null}getBlockCaption(){return null}getViewContent(){return p.Tag.render(f||(f=m`
			<div>
				${0}
			</div>
		`),p.Text.encode(this.data.text||"").toString().replaceAll("[br]","<br>"))}onStartChangePosition(){}onPlaced(){}onSave(){}onRemove(){}onClickOut(){this.block.forceSave()}onChange(){this.emit(this.events.onChange)}getStyles(){return{}}changeStyleColor(e){}}y.defaultTextBlockPaddingStyles={padding:"5px 8px"};let B=e=>e,_;var H=babelHelpers.classPrivateFieldLooseKey("calendar");var F=babelHelpers.classPrivateFieldLooseKey("calendarOpened");var S=babelHelpers.classPrivateFieldLooseKey("date");var C=babelHelpers.classPrivateFieldLooseKey("closeCalendar");class T extends y{constructor(...e){super(...e);Object.defineProperty(this,C,{value:k});Object.defineProperty(this,H,{writable:true,value:void 0});Object.defineProperty(this,F,{writable:true,value:false});Object.defineProperty(this,S,{writable:true,value:void 0})}getInitDimension(){return{width:105,height:28}}setData(e){this.data=e?e:{};babelHelpers.classPrivateFieldLooseBase(this,S)[S]=this.data.text}onActionClick(){babelHelpers.classPrivateFieldLooseBase(this,H)[H]=BX.calendar({node:this.block.getLayout(),field:this.getViewContent(),value:babelHelpers.classPrivateFieldLooseBase(this,S)[S],bTime:false,callback_after:e=>{this.setText(BX.date.format(BX.date.convertBitrixFormat(BX.message("FORMAT_DATE")),e,null));this.block.renderView()}});babelHelpers.classPrivateFieldLooseBase(this,F)[F]=true;const e=document.querySelector(".sign-editor__content");const{popup:s}=babelHelpers.classPrivateFieldLooseBase(this,H)[H];s.targetContainer=e;if(s.popupContainer.parentElement!==e){p.Dom.append(s.popupContainer,e);s.adjustPosition()}}getActionButton(){return p.Tag.render(_||(_=B`
			<div class="sign-document__block-style-btn --funnel">
				<button onclick="${0}" data-role="action">
					${0}
				</button>
			</div>
		`),this.onActionClick.bind(this),p.Loc.getMessage("SIGN_JS_DOCUMENT_DATE_ACTION_BUTTON"))}onStartChangePosition(){babelHelpers.classPrivateFieldLooseBase(this,C)[C]()}onSave(){babelHelpers.classPrivateFieldLooseBase(this,C)[C]()}onRemove(){babelHelpers.classPrivateFieldLooseBase(this,C)[C]()}onClickOut(){if(!babelHelpers.classPrivateFieldLooseBase(this,F)[F]){this.block.forceSave()}babelHelpers.classPrivateFieldLooseBase(this,F)[F]=false}getStyles(){return{...super.getStyles(),...T.defaultTextBlockPaddingStyles}}}function k(){if(babelHelpers.classPrivateFieldLooseBase(this,H)[H]){babelHelpers.classPrivateFieldLooseBase(this,H)[H].Close();babelHelpers.classPrivateFieldLooseBase(this,F)[F]=false}}let w=e=>e,O;var E=babelHelpers.classPrivateFieldLooseKey("onActionClick");class D extends y{constructor(...e){super(...e);Object.defineProperty(this,E,{value:M})}isSingleton(){return true}getInitDimension(){return{width:250,height:220}}getActionButton(){return p.Tag.render(O||(O=w`
			<div class="sign-document__block-style-btn --funnel">
				<button onclick="${0}" data-role="action" data-id="action-${0}">
					${0}
				</button>
			</div>
		`),babelHelpers.classPrivateFieldLooseBase(this,E)[E].bind(this),this.block.getCode(),p.Loc.getMessage("SIGN_JS_DOCUMENT_REQUISITES_ACTION_BUTTON"))}getStyles(){return{...super.getStyles(),...D.defaultTextBlockPaddingStyles}}}function M(e){const s=this.block.blocksManager;const t=s.getConfig();e.stopPropagation();const a=s.getMemberByPart(1);const{cid:i,entityTypeId:l,presetId:o}=a;new n.FieldsetViewer({entityTypeId:l,entityId:i,events:{onClose:()=>{this.block.assign()}},fieldListEditorOptions:{fieldsPanelOptions:{filter:{"+categories":["COMPANY"],"+fields":["list","string","date","typed_string","text","datetime","enumeration","address","url","money","boolean","double","integer"]},presetId:o,controllerOptions:{hideVirtual:1,hideRequisites:0,hideSmartDocument:1,presetId:o}}}}).show()}let I=e=>e,N,R,A,x,K,j,z,U,G;const $=p.Reflection.getClass("BX.ColorPicker");class X{static setRect(e,s){Object.keys(s).map((e=>{s[e]=parseInt(s[e])+"px"}));p.Dom.style(e,s)}static getBlockLayout(e){return p.Tag.render(N||(N=I`
			<div class="sign-document__block-wrapper">
				<div class="sign-document__block-panel--wrapper" data-role="sign-block__actions">
				</div>
				<div class="sign-document__block-content">
				</div>
				<div class="sign-document__block-actions">
					<div class="sign-document__block-actions--wrapper">
						<button class="sign-document__block-actions-btn --remove sign-block-action-remove" data-role="removeAction" onclick="${0}"></button>
						<button class="sign-document__block-actions-btn --save sign-block-action-save" data-role="saveAction" onclick="${0}"></button>
					</div>
				</div>
			</div>
		`),e.onRemove,e.onSave)}static getMemberSelector(e,s,t){const a={};let i=p.Loc.getMessage("SIGN_JS_DOCUMENT_MEMBER_NAME_NOT_SET");e.map((e=>{e.name=e.name||p.Loc.getMessage("SIGN_JS_DOCUMENT_MEMBER_NAME_NOT_SET");a[e.part]=e.name;if(e.part===s){i=e.name}}));const l=e.length>1?p.Tag.render(R||(R=I`<span>${0}</span>`),p.Text.encode(i)):p.Tag.render(A||(A=I`<i>${0}</i>`),p.Text.encode(i));if(e.length>1){c.UI.bindSimpleMenu({bindElement:l,items:a,actionHandler:e=>{l.innerHTML=a[e];t(parseInt(e))}})}return p.Tag.render(x||(x=I`
			<div class="sign-document-block-member-wrapper">
				${0}
			</div>
		`),l)}static getResizeArea(){return p.Tag.render(K||(K=I`
			<div class="sign-document__resize-area">
				<div class="sign-area-resizable-controls">
					<span class="sign-document__move-control"></span>
					<div class="sign-document__resize-control --middle-top"></div>
					<div class="sign-document__resize-control --right-top"></div>
					<div class="sign-document__resize-control --middle-right"></div>
					<div class="sign-document__resize-control --right-bottom"></div>
					<div class="sign-document__resize-control --middle-bottom"></div>
					<div class="sign-document__resize-control --left-bottom"></div>
					<div class="sign-document__resize-control --middle-left"></div>
				</div>
			</div>
		`))}static getStylePanel(e,s){var t;const a={'"Times New Roman", Times':"<span style=\"font-family: 'Times New Roman', Times\">Times New Roman</span>",'"Courier New"':"<span style=\"font-family: 'Courier New'\">Courier New</span>","Arial, Helvetica":'<span style="font-family: Arial, Helvetica">Arial / Helvetica</span>','"Arial Black", Gadget':"<span style=\"font-family: 'Arial Black', Gadget\">Arial Black</span>","Tahoma, Geneva":'<span style="font-family: Tahoma, Geneva">Tahoma / Geneva</span>',Verdana:'<span style="font-family: Verdana">Verdana</span>',"Georgia, serif":'<span style="font-family: Georgia, serif">Georgia</span>',monospace:'<span style="font-family: monospace">monospace</span>'};const i=p.Tag.render(j||(j=I`<div class="sign-document__block-style-btn --btn-font-family">${0}</div>`),a[s["font-family"]]||"Font");c.UI.bindSimpleMenu({bindElement:i,items:a,actionHandler:s=>{i.innerHTML=a[s];e("family",s)}});let l=parseInt(s["font-size"]);let o=14;if(l){o=l}const r=p.Tag.render(z||(z=I`<div class="sign-document__block-style-btn --btn-fontsize">${0}</div>`),o+"px"||"<i></i>");c.UI.bindSimpleMenu({bindElement:r,items:["6px","7px","8px","9px","10px","11px","12px","13px","14px","15px","16px","18px","20px","22px","24px","26px","28px","36px","48px","72px"],actionHandler:s=>{r.innerHTML=parseInt(s)+"px";e("size",s)},currentValue:o});const{layout:n}=X.getColorSelectorBtn((t=s.color)!=null?t:"#000",(s=>e("color",s)));return p.Tag.render(U||(U=I`
			<div class="sign-document__block-style--panel">
<!--				<div class="sign-document__block-style&#45;&#45;move-control"></div>-->
				${0}
				${0}
				${0}
				<div class="sign-document__block-style--separator"></div>
				<div class="sign-document__block-style-btn --btn-bold" data-action="bold"><i></i></div>
				<div class="sign-document__block-style-btn --btn-italic" data-action="italic"><i></i></div>
				<div class="sign-document__block-style-btn --btn-underline" data-action="underline"><i></i></div>
				<div class="sign-document__block-style-btn --btn-strike" data-action="through"><i></i></div>
				<div class="sign-document__block-style-btn --btn-align-left" data-action="left"><i></i></div>
				<div class="sign-document__block-style-btn --btn-align-center" data-action="center"><i></i></div>
				<div class="sign-document__block-style-btn --btn-align-right" data-action="right"><i></i></div>
				<div class="sign-document__block-style-btn --btn-align-justify" data-action="justify"><i></i></div>
			</div>
		`),i,r,n)}static getColorSelectorBtn(e,s,t={}){const a=p.Tag.render(G||(G=I`<div class="sign-document__block-style-btn --btn-color">
				<span class="sign-document__block-style-btn--color-block"></span> 
				<span>${0}</span>
			</div>`),p.Loc.getMessage("SIGN_JS_DOCUMENT_STYLE_COLOR"));X.updateColorSelectorBtnColor(a,e);const i={...t,bindElement:a,onColorSelected:e=>{s(e);X.updateColorSelectorBtnColor(a,e)}};const l=new $(i);p.Event.bind(a,"click",(()=>{l.open()}));return{layout:a,colorPicker:l}}static updateColorSelectorBtnColor(e,s){const t=e.querySelector(".sign-document__block-style-btn--color-block");if(p.Type.isNil(t)){return}p.Dom.style(t,"background-color",s)}}let V=e=>e,q,J,Y;var Q=babelHelpers.classPrivateFieldLooseKey("cache");var W=babelHelpers.classPrivateFieldLooseKey("defaultSignatureColor");var Z=babelHelpers.classPrivateFieldLooseKey("availableSignatureColors");var ee=babelHelpers.classPrivateFieldLooseKey("selectedSignatureColor");var se=babelHelpers.classPrivateFieldLooseKey("getSignatureColor");var te=babelHelpers.classPrivateFieldLooseKey("closeColorPickerPopup");var ae=babelHelpers.classPrivateFieldLooseKey("getColorSelectorBtn");class ie extends y{constructor(...e){super(...e);Object.defineProperty(this,ae,{value:re});Object.defineProperty(this,te,{value:oe});Object.defineProperty(this,se,{value:le});Object.defineProperty(this,Q,{writable:true,value:new p.Cache.MemoryCache});Object.defineProperty(this,W,{writable:true,value:"#0047ab"});Object.defineProperty(this,Z,{writable:true,value:["#000",babelHelpers.classPrivateFieldLooseBase(this,W)[W],"#8b00ff"]});Object.defineProperty(this,ee,{writable:true,value:null})}isSingleton(){return true}isStyleAllowed(){return false}getInitDimension(){return{width:200,height:70}}getViewContent(){const{width:e,height:s}=this.block.getPosition();let t=null;if(this.dataSrc){t=this.dataSrc}else if(this.data.base64){t="data:image;base64,"+this.data.base64}if(t){return p.Tag.render(q||(q=V`
				<img src="${0}" alt="">
			`),t)}else{return p.Tag.render(J||(J=V`
				<div class="sign-document__block-content_member-nodata">
					${0}
				</div>
			`),p.Text.encode(this.data.text||this.getPlaceholderLabel()))}}getPlaceholderLabel(){return p.Loc.getMessage("SIGN_JS_DOCUMENT_MEMBER_NO_DATA_MY_SIGN")}onClickOut(){super.onClickOut();babelHelpers.classPrivateFieldLooseBase(this,te)[te]()}onSave(){super.onSave();babelHelpers.classPrivateFieldLooseBase(this,te)[te]()}getStyles(){return{backgroundPosition:"center !important",color:babelHelpers.classPrivateFieldLooseBase(this,se)[se]()}}changeStyleColor(e,s=true){super.changeStyleColor(e);babelHelpers.classPrivateFieldLooseBase(this,ee)[ee]=e;const{layout:t,colorPicker:a}=babelHelpers.classPrivateFieldLooseBase(this,ae)[ae]();X.updateColorSelectorBtnColor(t,e);a.setSelectedColor(e);if(s){this.emit(this.events.onColorStyleChange)}}getBlockCaption(){const{layout:e}=babelHelpers.classPrivateFieldLooseBase(this,ae)[ae]();return p.Tag.render(Y||(Y=V`
			<div style="display: flex; flex-direction: row;">
			${0}
			<div class="sign-document__block-style--separator"></div>
			<div class="sign-document-block-member-wrapper">
				<i>${0}</i>
			</div>
			</div>
		`),e,p.Loc.getMessage("SIGN_JS_DOCUMENT_SIGN_ACTION_BUTTON"))}}function le(){var e;return(e=babelHelpers.classPrivateFieldLooseBase(this,ee)[ee])!=null?e:babelHelpers.classPrivateFieldLooseBase(this,W)[W]}function oe(){const{colorPicker:e}=babelHelpers.classPrivateFieldLooseBase(this,ae)[ae]();e.close()}function re(){return babelHelpers.classPrivateFieldLooseBase(this,Q)[Q].remember("colorSelectorBtn",(()=>{var e,s;return X.getColorSelectorBtn((e=babelHelpers.classPrivateFieldLooseBase(this,ee)[ee])!=null?e:babelHelpers.classPrivateFieldLooseBase(this,W)[W],(e=>this.changeStyleColor(e)),{colors:[babelHelpers.classPrivateFieldLooseBase(this,Z)[Z]],allowCustomColor:false,selectedColor:(s=babelHelpers.classPrivateFieldLooseBase(this,ee)[ee])!=null?s:babelHelpers.classPrivateFieldLooseBase(this,W)[W],colorPreview:false})}))}let ne=e=>e,ce,de,be;var pe=babelHelpers.classPrivateFieldLooseKey("uploader");var ve=babelHelpers.classPrivateFieldLooseKey("api");var ue=babelHelpers.classPrivateFieldLooseKey("onActionClick");var he=babelHelpers.classPrivateFieldLooseKey("saveStamp");class ge extends y{constructor(e){super(e);Object.defineProperty(this,he,{value:Le});Object.defineProperty(this,ue,{value:Pe});Object.defineProperty(this,pe,{writable:true,value:void 0});Object.defineProperty(this,ve,{writable:true,value:void 0});babelHelpers.classPrivateFieldLooseBase(this,pe)[pe]=new l.Uploader({controller:{upload:"sign.upload.stampUploadController"},contact:{id:0,label:"Admin"}});babelHelpers.classPrivateFieldLooseBase(this,pe)[pe].subscribe("onSaveAsync",(async e=>{var s;ge.currentBlock.await(true);const t=e.getData();if(!(t!=null&&(s=t.file)!=null&&s.serverId)){return}this.dataSrc=t.file.serverPreviewUrl;babelHelpers.classPrivateFieldLooseBase(this,he)[he](ge.currentBlock,t.file.serverId)}));babelHelpers.classPrivateFieldLooseBase(this,ve)[ve]=new o.Api}isSingleton(){return true}isStyleAllowed(){return false}getInitDimension(){return{width:151,height:151}}getActionButton(){return p.Tag.render(ce||(ce=ne`
			<div class="sign-document__block-style-btn --funnel">
				<button onclick="${0}" data-role="action">
					${0}
				</button>
			</div>
		`),babelHelpers.classPrivateFieldLooseBase(this,ue)[ue].bind(this),p.Loc.getMessage("SIGN_JS_DOCUMENT_STAMP_ACTION_BUTTON"))}getViewContent(){var e;let s=null;if((e=this.data.__view)!=null&&e.base64){s="data:image;base64,"+this.data.__view.base64}if(s){return p.Tag.render(de||(de=ne`
				<div class="sign-document__block-content_stamp" style="background-image: url(${0})"></div>
			`),s)}else{return p.Tag.render(be||(be=ne`
				<div class="sign-document__block-content_member-nodata --stamp"></div>
			`))}}}function Pe(e){ge.currentBlock=this.block;babelHelpers.classPrivateFieldLooseBase(this,pe)[pe].show()}async function Le(e,s){const t=e.getMemberPart();const a=e.blocksManager.getMemberByPart(t);await babelHelpers.classPrivateFieldLooseBase(this,ve)[ve].saveStamp(a.uid,s);e.assign()}let me=e=>e,fe,ye;var Be=babelHelpers.classPrivateFieldLooseKey("onActionClick");class _e extends y{constructor(...e){super(...e);Object.defineProperty(this,Be,{value:He})}isSingleton(){return true}getInitDimension(){return{width:100,height:28}}getActionButton(){return p.Tag.render(fe||(fe=me`
			<div class="sign-document__block-style-btn --funnel">
				<button onclick="${0}" data-role="action">
					${0}
				</button>
			</div>
		`),babelHelpers.classPrivateFieldLooseBase(this,Be)[Be].bind(this),p.Loc.getMessage("SIGN_JS_DOCUMENT_NUMBER_ACTION_EDIT"))}getViewContent(){return p.Tag.render(ye||(ye=me`
			<div class="sign-document__block-number">
				${0}
			</div>
		`),p.Text.encode(this.data.text||"").toString())}getStyles(){return{...super.getStyles(),..._e.defaultTextBlockPaddingStyles}}}function He(e){e.stopPropagation();if(!_e.sliderOnMessageBind){_e.sliderOnMessageBind=true;BX.addCustomEvent(window,"SidePanel.Slider:onMessage",(async e=>{var s;const t=((s=e.slider)==null?void 0:s.url)==="editor";if(t&&e.getEventId()==="numerator-saved-event"){var a,i,l,r;const s=e.getData();const t=(a=e==null?void 0:(i=e.sender)==null?void 0:(l=i.options)==null?void 0:(r=l.data)==null?void 0:r.block)!=null?a:this.block;if(s.type==="CRM_SMART_DOCUMENT"){t.await(true);const e=new o.Api;const s=t.blocksManager.getDocumentUid();await e.refreshEntityNumber(s);t.assign()}}}))}const{crmNumeratorUrl:s}=this.data.__view;BX.SidePanel.Instance.open(s,{width:480,cacheable:false,data:{block:this.block}})}_e.sliderOnMessageBind=false;let Fe=e=>e,Se,Ce,Te;var ke=babelHelpers.classPrivateFieldLooseKey("cache");var we=babelHelpers.classPrivateFieldLooseKey("field");var Oe=babelHelpers.classPrivateFieldLooseKey("actionButton");var Ee=babelHelpers.classPrivateFieldLooseKey("onActionClick");var De=babelHelpers.classPrivateFieldLooseKey("setActionButtonLabel");var Me=babelHelpers.classPrivateFieldLooseKey("getCrmFieldSelectorPanel");class Ie extends y{constructor(...e){super(...e);Object.defineProperty(this,Me,{value:Ae});Object.defineProperty(this,De,{value:Re});Object.defineProperty(this,Ee,{value:Ne});Object.defineProperty(this,ke,{writable:true,value:new p.Cache.MemoryCache});Object.defineProperty(this,we,{writable:true,value:void 0});Object.defineProperty(this,Oe,{writable:true,value:void 0})}setData(e){var s;this.data=e?e:{};babelHelpers.classPrivateFieldLooseBase(this,we)[we]=(s=this.data.field)!=null?s:""}onPlaced(){babelHelpers.classPrivateFieldLooseBase(this,Ee)[Ee]()}getActionButton(){if(p.Type.isUndefined(r.Selector)){return null}babelHelpers.classPrivateFieldLooseBase(this,Oe)[Oe]=p.Tag.render(Se||(Se=Fe`
			<div class="sign-document__block-style-btn --funnel">
				<button onclick="${0}" data-role="action">
				</button>
			</div>
		`),babelHelpers.classPrivateFieldLooseBase(this,Ee)[Ee].bind(this));babelHelpers.classPrivateFieldLooseBase(this,De)[De]();return babelHelpers.classPrivateFieldLooseBase(this,Oe)[Oe]}getViewContent(){babelHelpers.classPrivateFieldLooseBase(this,De)[De]();const{width:e,height:s}=this.block.getPosition();if(this.data.src){return p.Tag.render(Ce||(Ce=Fe`
				<div style="width: ${0}px; height: ${0}px; background: url(${0}) no-repeat top; background-size: cover;">
				</div>
			`),e-14,s-14,this.data.src)}else{const e=!this.data.text?"sign-document__block-content_member-nodata":"";return p.Tag.render(Te||(Te=Fe`
				<div class="${0}">
					${0}
				</div>
			`),e,p.Text.encode(this.data.text||p.Loc.getMessage("SIGN_JS_DOCUMENT_MEMBER_NO_DATA")))}}getStyles(){return{...super.getStyles(),...Ie.defaultTextBlockPaddingStyles}}}function Ne(){babelHelpers.classPrivateFieldLooseBase(this,Me)[Me]().show().then((e=>{if(e.length===0){return}p.Dom.removeClass(this.block.getLayout(),"--invalid");babelHelpers.classPrivateFieldLooseBase(this,we)[we]=e[0];this.setData({field:babelHelpers.classPrivateFieldLooseBase(this,we)[we]});setTimeout((()=>{this.block.assign()}),0)}))}function Re(){var e,s,t,a,i;if(!babelHelpers.classPrivateFieldLooseBase(this,Oe)[Oe]){return}const l=babelHelpers.classPrivateFieldLooseBase(this,Oe)[Oe].querySelector("button");const o=p.Loc.getMessage("SIGN_JS_DOCUMENT_REFERENCE_ACTION_BUTTON");if(!babelHelpers.classPrivateFieldLooseBase(this,we)[we]){l.textContent=o;return}const r=(e=babelHelpers.classPrivateFieldLooseBase(this,ke)[ke].get("fieldSelector"))!=null?e:babelHelpers.classPrivateFieldLooseBase(this,Me)[Me]();const n=r.getFieldsList();const c=[...(s=n==null?void 0:(t=n.CONTACT)==null?void 0:t.FIELDS)!=null?s:[],...(a=n==null?void 0:(i=n.SMART_DOCUMENT)==null?void 0:i.FIELDS)!=null?a:[]];const d=c.find((e=>e.name===babelHelpers.classPrivateFieldLooseBase(this,we)[we]));const b=d?d.caption:o;l.textContent=b}function Ae(){const e=this.block.blocksManager;const s=e.getMemberByPart(this.block.getMemberPart());const{presetId:t}=s;return babelHelpers.classPrivateFieldLooseBase(this,ke)[ke].remember("fieldSelector",(()=>new r.Selector({multiple:false,controllerOptions:{hideVirtual:1,hideRequisites:1,hideSmartDocument:1,presetId:t},presetId:t,filter:{"+categories":["CONTACT","SMART_DOCUMENT"],"+fields":["list","string","date","typed_string","text","datetime","enumeration","address","url","money","boolean","double","integer"]}})))}let xe=e=>e,Ke,je,ze;var Ue=babelHelpers.classPrivateFieldLooseKey("field");var Ge=babelHelpers.classPrivateFieldLooseKey("actionButton");var $e=babelHelpers.classPrivateFieldLooseKey("cache");var Xe=babelHelpers.classPrivateFieldLooseKey("onActionClick");var Ve=babelHelpers.classPrivateFieldLooseKey("setActionButtonLabel");var qe=babelHelpers.classPrivateFieldLooseKey("getCrmFieldSelectorPanel");var Je=babelHelpers.classPrivateFieldLooseKey("getFieldNegativeFilter");var Ye=babelHelpers.classPrivateFieldLooseKey("getFieldsNameBlackList");class Qe extends y{constructor(...e){super(...e);Object.defineProperty(this,Ye,{value:ts});Object.defineProperty(this,Je,{value:ss});Object.defineProperty(this,qe,{value:es});Object.defineProperty(this,Ve,{value:Ze});Object.defineProperty(this,Xe,{value:We});Object.defineProperty(this,Ue,{writable:true,value:void 0});Object.defineProperty(this,Ge,{writable:true,value:void 0});Object.defineProperty(this,$e,{writable:true,value:new p.Cache.MemoryCache})}setData(e){var s;this.data=e?e:{};babelHelpers.classPrivateFieldLooseBase(this,Ue)[Ue]=(s=this.data.field)!=null?s:""}onPlaced(){babelHelpers.classPrivateFieldLooseBase(this,Xe)[Xe]()}getActionButton(){if(p.Type.isUndefined(r.Selector)){return null}babelHelpers.classPrivateFieldLooseBase(this,Ge)[Ge]=p.Tag.render(Ke||(Ke=xe`
			<div class="sign-document__block-style-btn --funnel">
				<button onclick="${0}" data-role="action">
				</button>
			</div>
		`),babelHelpers.classPrivateFieldLooseBase(this,Xe)[Xe].bind(this));babelHelpers.classPrivateFieldLooseBase(this,Ve)[Ve]();return babelHelpers.classPrivateFieldLooseBase(this,Ge)[Ge]}getViewContent(){babelHelpers.classPrivateFieldLooseBase(this,Ve)[Ve]();const{width:e,height:s}=this.block.getPosition();if(this.data.src){return p.Tag.render(je||(je=xe`
				<div style="width: ${0}px; height: ${0}px; background: url(${0}) no-repeat top; background-size: cover;">
				</div>
			`),e-14,s-14,this.data.src)}else{const e=!this.data.text?"sign-document__block-content_member-nodata":"";return p.Tag.render(ze||(ze=xe`
				<div class="${0}">
					${0}
				</div>
			`),e,p.Text.encode(this.data.text||p.Loc.getMessage("SIGN_JS_DOCUMENT_MEMBER_NO_DATA_MY_BLOCKS")))}}getStyles(){return{...super.getStyles(),...Qe.defaultTextBlockPaddingStyles}}}function We(){babelHelpers.classPrivateFieldLooseBase(this,qe)[qe]().show().then((e=>{if(e.length===0){return}p.Dom.removeClass(this.block.getLayout(),"--invalid");babelHelpers.classPrivateFieldLooseBase(this,Ue)[Ue]=e[0];this.setData({field:babelHelpers.classPrivateFieldLooseBase(this,Ue)[Ue]});setTimeout((()=>{this.block.assign()}),0)}))}function Ze(){var e,s,t,a,i;if(!babelHelpers.classPrivateFieldLooseBase(this,Ge)[Ge]){return}const l=babelHelpers.classPrivateFieldLooseBase(this,Ge)[Ge].querySelector("button");const o=p.Loc.getMessage("SIGN_JS_DOCUMENT_REFERENCE_ACTION_BUTTON");if(!babelHelpers.classPrivateFieldLooseBase(this,Ue)[Ue]){l.textContent=o;return}const r=(e=babelHelpers.classPrivateFieldLooseBase(this,$e)[$e].get("fieldSelector"))!=null?e:babelHelpers.classPrivateFieldLooseBase(this,qe)[qe]();const n=r.getFieldsList();const c=[...(s=n==null?void 0:(t=n.COMPANY)==null?void 0:t.FIELDS)!=null?s:[],...(a=n==null?void 0:(i=n.SMART_DOCUMENT)==null?void 0:i.FIELDS)!=null?a:[]];const d=c.find((e=>e.name===babelHelpers.classPrivateFieldLooseBase(this,Ue)[Ue]));const b=d?d.caption:o;l.textContent=b}function es(){const e=this.block.blocksManager;const s=e.getMemberByPart(this.block.getMemberPart());const{presetId:t}=s;return babelHelpers.classPrivateFieldLooseBase(this,$e)[$e].remember("fieldSelector",(()=>new r.Selector({multiple:false,controllerOptions:{hideVirtual:1,hideRequisites:1,hideSmartDocument:1,presetId:t},presetId:t,filter:{"+categories":["COMPANY","SMART_DOCUMENT"],"+fields":["list","string","date","typed_string","text","datetime","enumeration","address","url","money","boolean","double","integer"],"-fields":[babelHelpers.classPrivateFieldLooseBase(this,Je)[Je]()]}})))}function ss(){const e=babelHelpers.classPrivateFieldLooseBase(this,Ye)[Ye]();return s=>e.some((e=>s.name===e))}function ts(){return["COMPANY_LINK","COMPANY_REG_ADDRESS","COMPANY_ORIGIN_VERSION"]}let as=e=>e,is,ls;var os=babelHelpers.classPrivateFieldLooseKey("onActionClick");class rs extends y{constructor(...e){super(...e);Object.defineProperty(this,os,{value:ns})}isSingleton(){return true}getInitDimension(){return{width:250,height:220}}getActionButton(){return p.Tag.render(is||(is=as`
			<div class="sign-document__block-style-btn --funnel">
				<button onclick="${0}" data-role="action" data-id="action-${0}">
					${0}
				</button>
			</div>
		`),babelHelpers.classPrivateFieldLooseBase(this,os)[os].bind(this),this.block.getCode(),p.Loc.getMessage("SIGN_JS_DOCUMENT_REQUISITES_ACTION_BUTTON"))}getViewContent(){const e=this.data.text||p.Loc.getMessage("SIGN_JS_DOCUMENT_MEMBER_NO_DATA_REQUISITES");const s=this.data.text?"":' class="sign-document__block-content_member-nodata"';return p.Tag.render(ls||(ls=as`
			<div${0}>
				${0}
			</div>
		`),s,p.Text.encode(e).toString().replaceAll("[br]","<br>"))}getStyles(){return{...super.getStyles(),...rs.defaultTextBlockPaddingStyles}}}function ns(e){const s=this.block.blocksManager;const t=s.getConfig();const a=s.getMemberByPart(this.block.getMemberPart());e.stopPropagation();if(!a){return}const{cid:i,entityTypeId:l,presetId:o}=a;new n.FieldsetViewer({entityTypeId:l,entityId:i,events:{onClose:()=>{this.block.assign()}},fieldListEditorOptions:{fieldsPanelOptions:{filter:{"+categories":["CONTACT"],"+fields":["list","string","date","typed_string","text","datetime","enumeration","address","url","money","boolean","double","integer"]},presetId:o,controllerOptions:{hideVirtual:1,hideRequisites:0,hideSmartDocument:1,presetId:o}}}}).show()}let cs=e=>e,ds,bs;class ps extends y{isStyleAllowed(){return false}getInitDimension(){return{width:151,height:151}}getPlaceholderLabel(){return p.Loc.getMessage("SIGN_JS_DOCUMENT_MEMBER_NO_DATA_STAMP")}getViewContent(){const{width:e,height:s}=this.block.getPosition();if(this.data.base64){return p.Tag.render(ds||(ds=cs`
				<div class="sign-document__block-content_stamp" style="background-image: url(${0})"></div>
			`),src)}else{return p.Tag.render(bs||(bs=cs`
				<div class="sign-document__block-content_member-nodata">
					
				</div>
			`))}}}let vs=e=>e,us,hs;var gs=babelHelpers.classPrivateFieldLooseKey("cache");var Ps=babelHelpers.classPrivateFieldLooseKey("defaultSignatureColor");var Ls=babelHelpers.classPrivateFieldLooseKey("availableSignatureColors");var ms=babelHelpers.classPrivateFieldLooseKey("selectedSignatureColor");var fs=babelHelpers.classPrivateFieldLooseKey("getColorSelectorBtn");var ys=babelHelpers.classPrivateFieldLooseKey("getSignatureColor");var Bs=babelHelpers.classPrivateFieldLooseKey("closeColorPickerPopup");class _s extends ps{constructor(...e){super(...e);Object.defineProperty(this,Bs,{value:Ss});Object.defineProperty(this,ys,{value:Fs});Object.defineProperty(this,fs,{value:Hs});Object.defineProperty(this,gs,{writable:true,value:new p.Cache.MemoryCache});Object.defineProperty(this,Ps,{writable:true,value:"#0047ab"});Object.defineProperty(this,Ls,{writable:true,value:["#000",babelHelpers.classPrivateFieldLooseBase(this,Ps)[Ps],"#8b00ff"]});Object.defineProperty(this,ms,{writable:true,value:null})}getPlaceholderLabel(){return p.Loc.getMessage("SIGN_JS_DOCUMENT_MEMBER_NO_DATA_SIGN")}getInitDimension(){return{width:200,height:70}}getBlockCaption(){const{layout:e}=babelHelpers.classPrivateFieldLooseBase(this,fs)[fs]();return p.Tag.render(us||(us=vs`
			<div style="display: flex; flex-direction: row;">
			${0}
			<div class="sign-document__block-style--separator"></div>
			</div>
		`),e)}getViewContent(){return p.Tag.render(hs||(hs=vs`
			<div class="sign-document__block-content_member-nodata">
				${0}
			</div>
		`),p.Text.encode(this.getPlaceholderLabel()))}getStyles(){return{backgroundPosition:"center !important",color:babelHelpers.classPrivateFieldLooseBase(this,ys)[ys]()}}updateColor(e){super.updateColor(e);const{layout:s,colorPicker:t}=babelHelpers.classPrivateFieldLooseBase(this,fs)[fs]();babelHelpers.classPrivateFieldLooseBase(this,ms)[ms]=e;X.updateColorSelectorBtnColor(s,e);t.setSelectedColor(e)}changeStyleColor(e,s=true){super.changeStyleColor(e);babelHelpers.classPrivateFieldLooseBase(this,ms)[ms]=e;const{layout:t,colorPicker:a}=babelHelpers.classPrivateFieldLooseBase(this,fs)[fs]();X.updateColorSelectorBtnColor(t,e);a.setSelectedColor(e);if(s){this.emit(this.events.onColorStyleChange)}}onSave(){super.onSave();babelHelpers.classPrivateFieldLooseBase(this,Bs)[Bs]()}onClickOut(){super.onClickOut();babelHelpers.classPrivateFieldLooseBase(this,Bs)[Bs]()}}function Hs(){return babelHelpers.classPrivateFieldLooseBase(this,gs)[gs].remember("colorSelectorBtn",(()=>{var e,s;return X.getColorSelectorBtn((e=babelHelpers.classPrivateFieldLooseBase(this,ms)[ms])!=null?e:babelHelpers.classPrivateFieldLooseBase(this,Ps)[Ps],(e=>this.changeStyleColor(e)),{colors:[babelHelpers.classPrivateFieldLooseBase(this,Ls)[Ls]],allowCustomColor:false,selectedColor:(s=babelHelpers.classPrivateFieldLooseBase(this,ms)[ms])!=null?s:babelHelpers.classPrivateFieldLooseBase(this,Ps)[Ps],colorPreview:false})}))}function Fs(){var e;return(e=babelHelpers.classPrivateFieldLooseBase(this,ms)[ms])!=null?e:babelHelpers.classPrivateFieldLooseBase(this,Ps)[Ps]}function Ss(){const{colorPicker:e}=babelHelpers.classPrivateFieldLooseBase(this,fs)[fs]();e.close()}let Cs=e=>e,Ts;var ks=babelHelpers.classPrivateFieldLooseKey("textContainer");var ws=babelHelpers.classPrivateFieldLooseKey("onKeyUp");var Os=babelHelpers.classPrivateFieldLooseKey("onPaste");class Es extends y{constructor(e){super(e);Object.defineProperty(this,Os,{value:Ms});Object.defineProperty(this,ws,{value:Ds});Object.defineProperty(this,ks,{writable:true,value:void 0});this.setEventNamespace("BX.Sign.V2.Blocks.Text")}onActionClick(){babelHelpers.classPrivateFieldLooseBase(this,ks)[ks].contentEditable=true;babelHelpers.classPrivateFieldLooseBase(this,ks)[ks].focus()}getText(){return this.data.text}getContainer(){return babelHelpers.classPrivateFieldLooseBase(this,ks)[ks]}getViewContent(){const e=this.data.text===p.Loc.getMessage("SIGN_JS_DOCUMENT_TEXT_PLACEHOLDER")?"":this.data.text;babelHelpers.classPrivateFieldLooseBase(this,ks)[ks]=p.Tag.render(Ts||(Ts=Cs`
			<div class="sign-document-block-text" placeholder="${0}">
				${0}
			</div>
		`),p.Loc.getMessage("SIGN_JS_DOCUMENT_TEXT_PLACEHOLDER"),p.Text.encode(e).replaceAll("[br]","<br>"));p.Event.bind(babelHelpers.classPrivateFieldLooseBase(this,ks)[ks],"keyup",babelHelpers.classPrivateFieldLooseBase(this,ws)[ws].bind(this));p.Event.bind(babelHelpers.classPrivateFieldLooseBase(this,ks)[ks],"paste",(e=>setTimeout(babelHelpers.classPrivateFieldLooseBase(this,Os)[Os].bind(this,e))));return babelHelpers.classPrivateFieldLooseBase(this,ks)[ks]}getStyles(){return{...super.getStyles(),...Es.defaultTextBlockPaddingStyles}}}function Ds(e){this.setText(babelHelpers.classPrivateFieldLooseBase(this,ks)[ks].innerText.replaceAll("\n","[br]"));this.onChange()}function Ms(e){babelHelpers.classPrivateFieldLooseBase(this,ks)[ks].innerHTML=babelHelpers.classPrivateFieldLooseBase(this,ks)[ks].innerText.replaceAll("\n","<br>");const s=document.createRange();s.selectNodeContents(babelHelpers.classPrivateFieldLooseBase(this,ks)[ks]);s.collapse(false);const t=document.getSelection();t.removeAllRanges();t.addRange(s);this.setText(babelHelpers.classPrivateFieldLooseBase(this,ks)[ks].innerHTML.replaceAll("<br>","[br]"));this.onChange()}let Is=e=>e,Ns,Rs,As,xs,Ks,js,zs,Us,Gs;const $s=p.Reflection.getClass("BX.ColorPicker");class Xs{static setRect(e,s){Object.keys(s).map((e=>{s[e]=parseInt(s[e])+"px"}));p.Dom.style(e,s)}static getBlockLayout(e){return p.Tag.render(Ns||(Ns=Is`
			<div class="sign-document__block-wrapper">
				<div class="sign-document__block-panel--wrapper" data-role="sign-block__actions">
				</div>
				<div class="sign-document__block-content">
				</div>
				<div class="sign-document__block-actions">
					<div class="sign-document__block-actions--wrapper">
						<button class="sign-document__block-actions-btn --remove sign-block-action-remove" data-role="removeAction" onclick="${0}"></button>
						<button class="sign-document__block-actions-btn --save sign-block-action-save" data-role="saveAction" onclick="${0}"></button>
					</div>
				</div>
			</div>
		`),e.onRemove,e.onSave)}static getMemberSelector(e,s,t){const a={};let i=p.Loc.getMessage("SIGN_JS_DOCUMENT_MEMBER_NAME_NOT_SET");e.map((e=>{e.name=e.name||p.Loc.getMessage("SIGN_JS_DOCUMENT_MEMBER_NAME_NOT_SET");a[e.part]=e.name;if(e.part===s){i=e.name}}));const l=e.length>1?p.Tag.render(Rs||(Rs=Is`<span>${0}</span>`),p.Text.encode(i)):p.Tag.render(As||(As=Is`<i>${0}</i>`),p.Text.encode(i));if(e.length>1){c.UI.bindSimpleMenu({bindElement:l,items:a,actionHandler:e=>{l.innerHTML=a[e];t(parseInt(e))}})}return p.Tag.render(xs||(xs=Is`
			<div class="sign-document-block-member-wrapper">
				${0}
			</div>
		`),l)}static getResizeArea(){return p.Tag.render(Ks||(Ks=Is`
			<div class="sign-document__resize-area">
				<div class="sign-area-resizable-controls">
					<span class="sign-document__move-control"></span>
					<div class="sign-document__resize-control --middle-top"></div>
					<div class="sign-document__resize-control --right-top"></div>
					<div class="sign-document__resize-control --middle-right"></div>
					<div class="sign-document__resize-control --right-bottom"></div>
					<div class="sign-document__resize-control --middle-bottom"></div>
					<div class="sign-document__resize-control --left-bottom"></div>
					<div class="sign-document__resize-control --middle-left"></div>
				</div>
			</div>
		`))}static getStylePanel(e,s){var t;const a={'"Times New Roman", Times':"<span style=\"font-family: 'Times New Roman', Times\">Times New Roman</span>",'"Courier New"':"<span style=\"font-family: 'Courier New'\">Courier New</span>","Arial, Helvetica":'<span style="font-family: Arial, Helvetica">Arial / Helvetica</span>','"Arial Black", Gadget':"<span style=\"font-family: 'Arial Black', Gadget\">Arial Black</span>","Tahoma, Geneva":'<span style="font-family: Tahoma, Geneva">Tahoma / Geneva</span>',Verdana:'<span style="font-family: Verdana">Verdana</span>',"Georgia, serif":'<span style="font-family: Georgia, serif">Georgia</span>',monospace:'<span style="font-family: monospace">monospace</span>'};const i=p.Tag.render(js||(js=Is`<div class="sign-document__block-style-btn --btn-font-family">${0}</div>`),a[s["fontFamily"]]||"Font");c.UI.bindSimpleMenu({bindElement:i,items:a,actionHandler:s=>{i.innerHTML=a[s];e("family",s)}});let l=parseInt(s["fontSize"]);let o=14;if(l){o=l}const r=p.Tag.render(zs||(zs=Is`<div class="sign-document__block-style-btn --btn-fontsize">${0}</div>`),o+"px"||"<i></i>");c.UI.bindSimpleMenu({bindElement:r,items:["6px","7px","8px","9px","10px","11px","12px","13px","14px","15px","16px","18px","20px","22px","24px","26px","28px","36px","48px","72px"],actionHandler:s=>{r.innerHTML=parseInt(s)+"px";e("size",s)},currentValue:o});const{layout:n}=Xs.getColorSelectorBtn((t=s.color)!=null?t:"#000",(s=>e("color",s)));return p.Tag.render(Us||(Us=Is`
			<div class="sign-document__block-style--panel">
<!--				<div class="sign-document__block-style&#45;&#45;move-control"></div>-->
				${0}
				${0}
				${0}
				<div class="sign-document__block-style--separator"></div>
				<div class="sign-document__block-style-btn --btn-bold" data-action="bold"><i></i></div>
				<div class="sign-document__block-style-btn --btn-italic" data-action="italic"><i></i></div>
				<div class="sign-document__block-style-btn --btn-underline" data-action="underline"><i></i></div>
				<div class="sign-document__block-style-btn --btn-strike" data-action="through"><i></i></div>
				<div class="sign-document__block-style-btn --btn-align-left" data-action="left"><i></i></div>
				<div class="sign-document__block-style-btn --btn-align-center" data-action="center"><i></i></div>
				<div class="sign-document__block-style-btn --btn-align-right" data-action="right"><i></i></div>
				<div class="sign-document__block-style-btn --btn-align-justify" data-action="justify"><i></i></div>
			</div>
		`),i,r,n)}static getColorSelectorBtn(e,s,t={}){const a=p.Tag.render(Gs||(Gs=Is`<div class="sign-document__block-style-btn --btn-color">
				<span class="sign-document__block-style-btn--color-block"></span> 
				<span>${0}</span>
			</div>`),p.Loc.getMessage("SIGN_JS_DOCUMENT_STYLE_COLOR"));Xs.updateColorSelectorBtnColor(a,e);const i={...t,bindElement:a,onColorSelected:e=>{s(e);Xs.updateColorSelectorBtnColor(a,e)}};const l=new $s(i);p.Event.bind(a,"click",(()=>{l.open()}));return{layout:a,colorPicker:l}}static updateColorSelectorBtnColor(e,s){const t=e.querySelector(".sign-document__block-style-btn--color-block");if(p.Type.isNil(t)){return}p.Dom.style(t,"background-color",s)}}var Vs=babelHelpers.classPrivateFieldLooseKey("block");var qs=babelHelpers.classPrivateFieldLooseKey("buttons");var Js=babelHelpers.classPrivateFieldLooseKey("style");var Ys=babelHelpers.classPrivateFieldLooseKey("onPressButton");var Qs=babelHelpers.classPrivateFieldLooseKey("applyData");class Ws{constructor(e){Object.defineProperty(this,Qs,{value:et});Object.defineProperty(this,Ys,{value:Zs});Object.defineProperty(this,Vs,{writable:true,value:void 0});Object.defineProperty(this,qs,{writable:true,value:{family:{property:"fontFamily",value:null},size:{property:"fontSize",value:14},color:{property:"color",value:null},bold:{button:null,property:"fontWeight",value:"bold",state:false},italic:{button:null,property:"fontStyle",value:"italic",state:false},underline:{button:null,property:"textDecoration",value:"underline",state:false},through:{button:null,property:"textDecoration",value:"line-through",state:false},left:{button:null,property:"textAlign",value:"left",state:false,group:"align"},center:{button:null,property:"textAlign",value:"center",state:false,group:"align"},right:{button:null,property:"textAlign",value:"right",state:false,group:"align"},justify:{button:null,property:"textAlign",value:"justify",state:false,group:"align"}}});Object.defineProperty(this,Js,{writable:true,value:{buttonPressed:"sign-document__block-style--button-pressed"}});babelHelpers.classPrivateFieldLooseBase(this,Vs)[Vs]=e.block;if(e.data){babelHelpers.classPrivateFieldLooseBase(this,Qs)[Qs](e.data)}}applyStyles(e){e.removeAttribute("style");p.Dom.style(e,this.collectStyles())}updateFontSize(e){if(e){babelHelpers.classPrivateFieldLooseBase(this,qs)[qs].size["property"]="fontSize";babelHelpers.classPrivateFieldLooseBase(this,qs)[qs].size["value"]=e}}collectStyles(){const e={};[...Object.keys(babelHelpers.classPrivateFieldLooseBase(this,qs)[qs])].map((s=>{if(babelHelpers.classPrivateFieldLooseBase(this,qs)[qs][s]["state"]||typeof babelHelpers.classPrivateFieldLooseBase(this,qs)[qs][s]["state"]==="undefined"){const t=babelHelpers.classPrivateFieldLooseBase(this,qs)[qs][s]["property"];const a=babelHelpers.classPrivateFieldLooseBase(this,qs)[qs][s]["value"];if(a===null){return}if(babelHelpers.classPrivateFieldLooseBase(this,qs)[qs][s]["group"]){e[t]=a}else{e[t]=(e[t]?e[t]+" ":"")+a}}}));return e}getLayout(){const e=Xs.getStylePanel(((e,s)=>{babelHelpers.classPrivateFieldLooseBase(this,qs)[qs][e]["value"]=s;babelHelpers.classPrivateFieldLooseBase(this,Vs)[Vs].renderStyle()}),this.collectStyles());[...e.querySelectorAll("[data-action]")].map((e=>{const s=e.getAttribute("data-action");if(babelHelpers.classPrivateFieldLooseBase(this,qs)[qs][s]){p.Event.bind(e,"click",(()=>babelHelpers.classPrivateFieldLooseBase(this,Ys)[Ys](s)));babelHelpers.classPrivateFieldLooseBase(this,qs)[qs][s]["button"]=e;if(babelHelpers.classPrivateFieldLooseBase(this,qs)[qs][s]["state"]){p.Dom.addClass(babelHelpers.classPrivateFieldLooseBase(this,qs)[qs][s]["button"],babelHelpers.classPrivateFieldLooseBase(this,Js)[Js].buttonPressed)}}}));return e}updateColor(e){babelHelpers.classPrivateFieldLooseBase(this,qs)[qs].color.value=e}}function Zs(e){babelHelpers.classPrivateFieldLooseBase(this,qs)[qs][e]["state"]=!babelHelpers.classPrivateFieldLooseBase(this,qs)[qs][e]["state"];if(babelHelpers.classPrivateFieldLooseBase(this,qs)[qs][e]["state"]){p.Dom.addClass(babelHelpers.classPrivateFieldLooseBase(this,qs)[qs][e]["button"],babelHelpers.classPrivateFieldLooseBase(this,Js)[Js].buttonPressed);if(babelHelpers.classPrivateFieldLooseBase(this,qs)[qs][e]["group"]){const s=babelHelpers.classPrivateFieldLooseBase(this,qs)[qs][e]["group"];[...Object.keys(babelHelpers.classPrivateFieldLooseBase(this,qs)[qs])].map((t=>{if(t!==e&&babelHelpers.classPrivateFieldLooseBase(this,qs)[qs][t]["group"]===s){babelHelpers.classPrivateFieldLooseBase(this,qs)[qs][t]["state"]=false;p.Dom.removeClass(babelHelpers.classPrivateFieldLooseBase(this,qs)[qs][t]["button"],babelHelpers.classPrivateFieldLooseBase(this,Js)[Js].buttonPressed)}}))}}else{p.Dom.removeClass(babelHelpers.classPrivateFieldLooseBase(this,qs)[qs][e]["button"],babelHelpers.classPrivateFieldLooseBase(this,Js)[Js].buttonPressed)}babelHelpers.classPrivateFieldLooseBase(this,Vs)[Vs].renderStyle()}function et(e){[...Object.keys(babelHelpers.classPrivateFieldLooseBase(this,qs)[qs])].map((s=>{const t=babelHelpers.classPrivateFieldLooseBase(this,qs)[qs][s]["property"];if(e[t]){if(typeof babelHelpers.classPrivateFieldLooseBase(this,qs)[qs][s]["state"]!=="undefined"){if(e[t].indexOf(babelHelpers.classPrivateFieldLooseBase(this,qs)[qs][s]["value"])!==-1){babelHelpers.classPrivateFieldLooseBase(this,qs)[qs][s]["state"]=true}}else{babelHelpers.classPrivateFieldLooseBase(this,qs)[qs][s]["value"]=e[t]}}}))}var st=babelHelpers.classPrivateFieldLooseKey("id");var tt=babelHelpers.classPrivateFieldLooseKey("code");var at=babelHelpers.classPrivateFieldLooseKey("layout");var it=babelHelpers.classPrivateFieldLooseKey("stylePanel");var lt=babelHelpers.classPrivateFieldLooseKey("content");var ot=babelHelpers.classPrivateFieldLooseKey("memberPart");var rt=babelHelpers.classPrivateFieldLooseKey("panelCreated");var nt=babelHelpers.classPrivateFieldLooseKey("allowMembers");var ct=babelHelpers.classPrivateFieldLooseKey("onClickCallback");var dt=babelHelpers.classPrivateFieldLooseKey("onRemoveCallback");var bt=babelHelpers.classPrivateFieldLooseKey("contentProviders");var pt=babelHelpers.classPrivateFieldLooseKey("currentFontSize");var vt=babelHelpers.classPrivateFieldLooseKey("style");var ut=babelHelpers.classPrivateFieldLooseKey("firstRenderReady");var ht=babelHelpers.classPrivateFieldLooseKey("api");var gt=babelHelpers.classPrivateFieldLooseKey("onClick");var Pt=babelHelpers.classPrivateFieldLooseKey("createLayout");var Lt=babelHelpers.classPrivateFieldLooseKey("onContentChange");var mt=babelHelpers.classPrivateFieldLooseKey("onContentColorStyleChange");class ft extends L.EventEmitter{constructor(e){var s,t;super();Object.defineProperty(this,mt,{value:Ht});Object.defineProperty(this,Lt,{value:_t});Object.defineProperty(this,Pt,{value:Bt});Object.defineProperty(this,gt,{value:yt});this.events={onColorStyleChange:"onColorStyleChange"};Object.defineProperty(this,st,{writable:true,value:void 0});Object.defineProperty(this,tt,{writable:true,value:void 0});Object.defineProperty(this,at,{writable:true,value:void 0});Object.defineProperty(this,it,{writable:true,value:void 0});Object.defineProperty(this,lt,{writable:true,value:null});Object.defineProperty(this,ot,{writable:true,value:2});Object.defineProperty(this,rt,{writable:true,value:false});Object.defineProperty(this,nt,{writable:true,value:false});Object.defineProperty(this,ct,{writable:true,value:void 0});Object.defineProperty(this,dt,{writable:true,value:void 0});Object.defineProperty(this,bt,{writable:true,value:{date:T,myrequisites:D,mysign:ie,mystamp:ge,number:_e,reference:Ie,myreference:Qe,requisites:rs,sign:_s,stamp:ps,text:Es}});Object.defineProperty(this,pt,{writable:true,value:void 0});Object.defineProperty(this,vt,{writable:true,value:{blockContent:".sign-document__block-content",blockPanel:".sign-document__block-panel--wrapper",blockLoading:"sign-document-block-loading",blockEditing:"sign-document__block-wrapper-editing",pageWithNotAllowed:"sign-editor__content-document--active-move"}});Object.defineProperty(this,ut,{writable:true,value:void 0});Object.defineProperty(this,ht,{writable:true,value:void 0});this.setEventNamespace("BX.Sign.V2.Editor.Block");this.blocksManager=e.blocksManager;babelHelpers.classPrivateFieldLooseBase(this,st)[st]=e.id||null;babelHelpers.classPrivateFieldLooseBase(this,tt)[tt]=e.code;babelHelpers.classPrivateFieldLooseBase(this,ot)[ot]=e.party;babelHelpers.classPrivateFieldLooseBase(this,ct)[ct]=e.onClick;babelHelpers.classPrivateFieldLooseBase(this,dt)[dt]=e.onRemove;babelHelpers.classPrivateFieldLooseBase(this,ut)[ut]=null;babelHelpers.classPrivateFieldLooseBase(this,it)[it]=new Ws({block:this,data:e.style});if(!babelHelpers.classPrivateFieldLooseBase(this,bt)[bt][babelHelpers.classPrivateFieldLooseBase(this,tt)[tt]]){throw new Error(`Content provider for '${babelHelpers.classPrivateFieldLooseBase(this,tt)[tt]}' not found.`)}babelHelpers.classPrivateFieldLooseBase(this,lt)[lt]=new(babelHelpers.classPrivateFieldLooseBase(this,bt)[bt][babelHelpers.classPrivateFieldLooseBase(this,tt)[tt]])(this);if(["sign","mysign"].includes(babelHelpers.classPrivateFieldLooseBase(this,tt)[tt])&&p.Type.isString((s=e.style)==null?void 0:s.color)){babelHelpers.classPrivateFieldLooseBase(this,lt)[lt].changeStyleColor(e.style.color,false)}babelHelpers.classPrivateFieldLooseBase(this,Pt)[Pt]();p.Event.bind(babelHelpers.classPrivateFieldLooseBase(this,at)[at],"click",babelHelpers.classPrivateFieldLooseBase(this,gt)[gt].bind(this));if(e.party>1){babelHelpers.classPrivateFieldLooseBase(this,nt)[nt]=true}this.renderStyle();this.setPosition((t=e.position)!=null?t:babelHelpers.classPrivateFieldLooseBase(this,lt)[lt].getInitDimension());if(e.data){setTimeout((()=>{this.setData(e.data)}),0)}babelHelpers.classPrivateFieldLooseBase(this,ht)[ht]=new o.Api}getLayout(){return babelHelpers.classPrivateFieldLooseBase(this,at)[at]}setData(e){babelHelpers.classPrivateFieldLooseBase(this,lt)[lt].setData(e);this.renderView()}setPosition(e){Xs.setRect(babelHelpers.classPrivateFieldLooseBase(this,at)[at],e)}getData(){return babelHelpers.classPrivateFieldLooseBase(this,lt)[lt].getData()}getPosition(){let{top:e,left:s,width:t,height:a}=babelHelpers.classPrivateFieldLooseBase(this,at)[at].getBoundingClientRect();const i=babelHelpers.classPrivateFieldLooseBase(this,at)[at];e=Math.round(e);s=Math.round(s);t=Math.round(t);a=Math.round(a);const l=this.blocksManager.getLayout().getBoundingClientRect();e-=Math.round(l.top);s-=Math.round(l.left);return{top:e,left:s,width:t,height:a}}getStyle(){return{...babelHelpers.classPrivateFieldLooseBase(this,lt)[lt].getStyles(),...babelHelpers.classPrivateFieldLooseBase(this,it)[it].collectStyles()}}getId(){var e;return(e=babelHelpers.classPrivateFieldLooseBase(this,st)[st])!=null?e:null}getCode(){return babelHelpers.classPrivateFieldLooseBase(this,tt)[tt]}showNotAllowedArea(){const{page:e}=this.blocksManager.transferPositionToPage(this.getPosition());const s=document.querySelector(`.sign-editor__content-document--page[data-page="${e}"]`);p.Dom.addClass(s,babelHelpers.classPrivateFieldLooseBase(this,vt)[vt].pageWithNotAllowed)}hideNotAllowedArea(){const{page:e}=this.blocksManager.transferPositionToPage(this.getPosition());const s=document.querySelector(`.sign-editor__content-document--page[data-page="${e}"]`);p.Dom.removeClass(s,babelHelpers.classPrivateFieldLooseBase(this,vt)[vt].pageWithNotAllowed)}getMemberPart(){return babelHelpers.classPrivateFieldLooseBase(this,ot)[ot]}fireAction(){if(babelHelpers.classPrivateFieldLooseBase(this,lt)[lt]["onActionClick"]){if(babelHelpers.classPrivateFieldLooseBase(this,tt)[tt]==="text"){p.Dom.addClass(babelHelpers.classPrivateFieldLooseBase(this,at)[at],babelHelpers.classPrivateFieldLooseBase(this,vt)[vt].blockEditing)}babelHelpers.classPrivateFieldLooseBase(this,lt)[lt]["onActionClick"]()}}onMemberSelect(e){babelHelpers.classPrivateFieldLooseBase(this,ot)[ot]=e;this.assign()}await(e){const s=[];if(!babelHelpers.classPrivateFieldLooseBase(this,lt)[lt].isSingleton()){s.push(this.getLayout())}else{const e=this.getCode();this.blocksManager.getBlocks().map((t=>{if(t.getCode()===e){s.push(t.getLayout())}}))}s.map(((t,a)=>{if(e){if(s.length===a+1){p.Dom.addClass(t,babelHelpers.classPrivateFieldLooseBase(this,vt)[vt].blockLoading)}}else{p.Dom.removeClass(t,babelHelpers.classPrivateFieldLooseBase(this,vt)[vt].blockLoading)}}))}assign(){const e=this.getLayout();const s=[];const t=[];this.await(true);if(!babelHelpers.classPrivateFieldLooseBase(this,lt)[lt].isSingleton()){s.push({code:babelHelpers.classPrivateFieldLooseBase(this,tt)[tt],part:babelHelpers.classPrivateFieldLooseBase(this,ot)[ot],data:this.getData()});t.push(this)}else{this.blocksManager.getBlocks().map((e=>{if(e.getCode()===this.getCode()&&e.getMemberPart()===this.getMemberPart()){s.push({code:e.getCode(),part:e.getMemberPart(),data:e.getData()});t.push(e)}}))}babelHelpers.classPrivateFieldLooseBase(this,ht)[ht].loadBlocksData(this.blocksManager.getDocumentUid(),s).then((e=>{if(p.Type.isArray(e)){e.forEach(((e,s)=>{t[s].setData(e.data)}))}this.await(false);this.blocksManager.showResizeArea(this)})).catch((s=>{p.Dom.remove(e)}))}renderView(){const e=babelHelpers.classPrivateFieldLooseBase(this,at)[at].querySelector(babelHelpers.classPrivateFieldLooseBase(this,vt)[vt].blockContent);p.Dom.clean(e);switch(babelHelpers.classPrivateFieldLooseBase(this,tt)[tt].toLowerCase()){case"stamp":case"mystamp":case"sign":case"mysign":p.Dom.addClass(e,"--image")}const s=babelHelpers.classPrivateFieldLooseBase(this,lt)[lt].getViewContent();p.Dom.append(s,e);p.Dom.addClass(s,"--"+babelHelpers.classPrivateFieldLooseBase(this,tt)[tt].toLowerCase());if(babelHelpers.classPrivateFieldLooseBase(this,tt)[tt].toLowerCase()==="requisites"||babelHelpers.classPrivateFieldLooseBase(this,tt)[tt].toLowerCase()==="myrequisites"||babelHelpers.classPrivateFieldLooseBase(this,tt)[tt].toLowerCase()==="date"||babelHelpers.classPrivateFieldLooseBase(this,tt)[tt].toLowerCase()==="number"||babelHelpers.classPrivateFieldLooseBase(this,tt)[tt].toLowerCase()==="stamp"||babelHelpers.classPrivateFieldLooseBase(this,tt)[tt].toLowerCase()==="mystamp"||babelHelpers.classPrivateFieldLooseBase(this,tt)[tt].toLowerCase()==="sign"||babelHelpers.classPrivateFieldLooseBase(this,tt)[tt].toLowerCase()==="mysign"||babelHelpers.classPrivateFieldLooseBase(this,tt)[tt].toLowerCase()==="reference"||babelHelpers.classPrivateFieldLooseBase(this,tt)[tt].toLowerCase()==="myreference"||babelHelpers.classPrivateFieldLooseBase(this,tt)[tt].toLowerCase()==="text"){s.style.setProperty("display","block");s.style.setProperty("overflow","hidden");if(!this.observerReady){if(this.getStyle()["fontSize"]){this.maxTextSize=parseFloat(this.getStyle()["fontSize"])}else{this.maxTextSize=14}this.isOverflownX=({clientHeight:e,scrollHeight:s})=>s>e;L.EventEmitter.subscribe(s.parentNode.parentNode,"BX.Sign:setFontSize",(e=>{if(e.data.fontSize){this.maxTextSize=e.data.fontSize;this.resizeText({element:e.target.querySelector(".sign-document__block-content > div"),step:.5})}}));this.resizeText=({element:e,minSize:s=1,step:t=1,unit:a="px"})=>{if(this.intervalTextResize){clearTimeout(this.intervalTextResize)}let i=s;let l=false;const o=e.parentNode;while(!l&&i<this.maxTextSize){e.style.fontSize=`${i}${a}`;l=this.isOverflownX(o);if(!l){i+=t}}babelHelpers.classPrivateFieldLooseBase(this,pt)[pt]=`${i-t}${a}`;e.style.fontSize=babelHelpers.classPrivateFieldLooseBase(this,pt)[pt];this.intervalTextResize=setTimeout((()=>{e.parentNode.style.setProperty("font-size",e.style.fontSize);e.style.removeProperty("font-size",e.style.fontSize);babelHelpers.classPrivateFieldLooseBase(this,it)[it].updateFontSize(babelHelpers.classPrivateFieldLooseBase(this,pt)[pt])}),1e3)};if(babelHelpers.classPrivateFieldLooseBase(this,tt)[tt].toLowerCase()==="requisites"||babelHelpers.classPrivateFieldLooseBase(this,tt)[tt].toLowerCase()==="myrequisites"||babelHelpers.classPrivateFieldLooseBase(this,tt)[tt].toLowerCase()==="reference"||babelHelpers.classPrivateFieldLooseBase(this,tt)[tt].toLowerCase()==="myreference"||babelHelpers.classPrivateFieldLooseBase(this,tt)[tt].toLowerCase()==="text"){this.resizeText({element:s,step:.5})}babelHelpers.classPrivateFieldLooseBase(this,lt)[lt].subscribe(babelHelpers.classPrivateFieldLooseBase(this,lt)[lt].events.onChange,babelHelpers.classPrivateFieldLooseBase(this,Lt)[Lt].bind(this));babelHelpers.classPrivateFieldLooseBase(this,lt)[lt].subscribe(babelHelpers.classPrivateFieldLooseBase(this,lt)[lt].events.onColorStyleChange,babelHelpers.classPrivateFieldLooseBase(this,mt)[mt].bind(this));this.observerReady=true}if(babelHelpers.classPrivateFieldLooseBase(this,ut)[ut]){this.resizeText({element:s,step:.5})}}babelHelpers.classPrivateFieldLooseBase(this,ut)[ut]=true;if(babelHelpers.classPrivateFieldLooseBase(this,rt)[rt]){return}const t=babelHelpers.classPrivateFieldLooseBase(this,at)[at].querySelector(babelHelpers.classPrivateFieldLooseBase(this,vt)[vt].blockPanel);p.Dom.clean(t);if(babelHelpers.classPrivateFieldLooseBase(this,lt)[lt].isStyleAllowed()){p.Dom.append(babelHelpers.classPrivateFieldLooseBase(this,it)[it].getLayout(),t)}p.Dom.append(babelHelpers.classPrivateFieldLooseBase(this,lt)[lt].getActionButton(),t);p.Dom.append(babelHelpers.classPrivateFieldLooseBase(this,lt)[lt].getBlockCaption(),t);if(babelHelpers.classPrivateFieldLooseBase(this,nt)[nt]){const e=this.blocksManager.getMembers();const s=e.filter((e=>e.part>1));p.Dom.append(Xs.getMemberSelector(s,babelHelpers.classPrivateFieldLooseBase(this,ot)[ot],this.onMemberSelect.bind(this)),t)}babelHelpers.classPrivateFieldLooseBase(this,rt)[rt]=true}getCurrentFontSize(){return babelHelpers.classPrivateFieldLooseBase(this,pt)[pt]}onStartChangePosition(){babelHelpers.classPrivateFieldLooseBase(this,lt)[lt].onStartChangePosition()}onPlaced(){babelHelpers.classPrivateFieldLooseBase(this,lt)[lt].onPlaced()}updateColor(e,s=true){babelHelpers.classPrivateFieldLooseBase(this,lt)[lt].changeStyleColor(e,s);babelHelpers.classPrivateFieldLooseBase(this,it)[it].updateColor(e)}onSave(){babelHelpers.classPrivateFieldLooseBase(this,lt)[lt].onSave()}onRemove(){babelHelpers.classPrivateFieldLooseBase(this,lt)[lt].onRemove()}onClickOut(){babelHelpers.classPrivateFieldLooseBase(this,lt)[lt].onClickOut()}renderStyle(){babelHelpers.classPrivateFieldLooseBase(this,it)[it].applyStyles(babelHelpers.classPrivateFieldLooseBase(this,at)[at].querySelector(babelHelpers.classPrivateFieldLooseBase(this,vt)[vt].blockContent))}adjustActionsPanel(){const e=this.getLayout();const s=e.querySelector('[data-role="sign-block__actions"]');if(s){const t=s.getBoundingClientRect();const a=e.getBoundingClientRect();const i=t.width;const l=a.width;const o=(i-l)/2;if(o>a.left){s.style.marginLeft=o-50+"px"}else{s.style.marginLeft=0}}}forceSave(){babelHelpers.classPrivateFieldLooseBase(this,at)[at].querySelector('[data-role="saveAction"]').click()}isRemoved(){return babelHelpers.classPrivateFieldLooseBase(this,at)[at].hidden===true}}function yt(){if(babelHelpers.classPrivateFieldLooseBase(this,ct)[ct]){babelHelpers.classPrivateFieldLooseBase(this,ct)[ct](this)}}function Bt(){babelHelpers.classPrivateFieldLooseBase(this,at)[at]=Xs.getBlockLayout({onSave:e=>{this.renderView();this.blocksManager.unMuteResizeArea();this.blocksManager.hideResizeArea();this.blocksManager.setSavingMark(false);this.onSave();p.Dom.removeClass(babelHelpers.classPrivateFieldLooseBase(this,at)[at],babelHelpers.classPrivateFieldLooseBase(this,vt)[vt].blockEditing);e.stopPropagation()},onRemove:e=>{if(babelHelpers.classPrivateFieldLooseBase(this,dt)[dt]){babelHelpers.classPrivateFieldLooseBase(this,dt)[dt](this)}babelHelpers.classPrivateFieldLooseBase(this,at)[at].hidden=true;this.onRemove();e.stopPropagation()}});const e=document.body.querySelector(".sign-editor__content");const s=this.blocksManager.getLayout();const t=s.getBoundingClientRect();const a=babelHelpers.classPrivateFieldLooseBase(this,lt)[lt].getInitDimension();const i={top:Math.min(e.scrollTop+e.offsetHeight/2,t.height-a.height),left:t.width/2-100};if(this.blocksManager.inDeadZone(i.top,i.top+a.height)){i.top+=a.height+this.blocksManager.getPagesGap()}this.setPosition(i)}function _t(){const e=babelHelpers.classPrivateFieldLooseBase(this,lt)[lt];if(!(e instanceof Es)){return}this.resizeText({element:e.getContainer(),step:.5})}function Ht(e){var s,t,a,i;this.emit(this.events.onColorStyleChange,{color:(s=(t=babelHelpers.classPrivateFieldLooseBase(this,lt)[lt].getStyles())==null?void 0:t.color)!=null?s:null});const l=(a=(i=babelHelpers.classPrivateFieldLooseBase(this,lt)[lt].getStyles())==null?void 0:i.color)!=null?a:null;if(p.Type.isString(l)){babelHelpers.classPrivateFieldLooseBase(this,it)[it].updateColor(l)}}var Ft=babelHelpers.classPrivateFieldLooseKey("wrapperLayout");var St=babelHelpers.classPrivateFieldLooseKey("layout");var Ct=babelHelpers.classPrivateFieldLooseKey("fullEditorContent");var Tt=babelHelpers.classPrivateFieldLooseKey("linkedElement");var kt=babelHelpers.classPrivateFieldLooseKey("linkedBlock");var wt=babelHelpers.classPrivateFieldLooseKey("style");var Ot=babelHelpers.classPrivateFieldLooseKey("onClick");var Et=babelHelpers.classPrivateFieldLooseKey("initResize");var Dt=babelHelpers.classPrivateFieldLooseKey("initMove");class Mt{constructor(e){Object.defineProperty(this,Dt,{value:Rt});Object.defineProperty(this,Et,{value:Nt});Object.defineProperty(this,Ot,{value:It});Object.defineProperty(this,Ft,{writable:true,value:void 0});Object.defineProperty(this,St,{writable:true,value:void 0});Object.defineProperty(this,Ct,{writable:true,value:void 0});Object.defineProperty(this,Tt,{writable:true,value:void 0});Object.defineProperty(this,kt,{writable:true,value:void 0});Object.defineProperty(this,wt,{writable:true,value:{resizeContainer:".sign-area-resizable-controls > div",moveContainer:".sign-document__resize-area",blockEditing:"sign-document__block-wrapper-editing"}});if(!p.Type.isDomNode(e.wrapperLayout)){throw new Error("Option wrapperLayout is undefined or not valid DOM Element.")}babelHelpers.classPrivateFieldLooseBase(this,St)[St]=Xs.getResizeArea();babelHelpers.classPrivateFieldLooseBase(this,Ft)[Ft]=e.wrapperLayout;p.Event.bind(babelHelpers.classPrivateFieldLooseBase(this,St)[St],"click",babelHelpers.classPrivateFieldLooseBase(this,Ot)[Ot].bind(this));babelHelpers.classPrivateFieldLooseBase(this,Et)[Et]();babelHelpers.classPrivateFieldLooseBase(this,Dt)[Dt]()}getLayout(){return babelHelpers.classPrivateFieldLooseBase(this,St)[St]}show(e){if(babelHelpers.classPrivateFieldLooseBase(this,kt)[kt]===e){return}const s=e.getLayout().getBoundingClientRect();babelHelpers.classPrivateFieldLooseBase(this,St)[St].style.display="block";if(babelHelpers.classPrivateFieldLooseBase(this,Tt)[Tt]){babelHelpers.classPrivateFieldLooseBase(this,Tt)[Tt].removeAttribute("data-active")}babelHelpers.classPrivateFieldLooseBase(this,kt)[kt]=e;babelHelpers.classPrivateFieldLooseBase(this,Tt)[Tt]=e.getLayout();babelHelpers.classPrivateFieldLooseBase(this,Tt)[Tt].setAttribute("data-active",1);const t=babelHelpers.classPrivateFieldLooseBase(this,Ft)[Ft].getBoundingClientRect();Xs.setRect(babelHelpers.classPrivateFieldLooseBase(this,St)[St],{top:s.top-t.top,left:s.left-t.left,width:s.width+Mt.borderDelta,height:s.height+Mt.borderDelta})}setFullEditorContent(e){babelHelpers.classPrivateFieldLooseBase(this,Ct)[Ct]=e}hide(){babelHelpers.classPrivateFieldLooseBase(this,kt)[kt]=null;babelHelpers.classPrivateFieldLooseBase(this,St)[St].style.display="none";if(babelHelpers.classPrivateFieldLooseBase(this,Tt)[Tt]){babelHelpers.classPrivateFieldLooseBase(this,Tt)[Tt].removeAttribute("data-active")}}getLinkedBlock(){return babelHelpers.classPrivateFieldLooseBase(this,kt)[kt]}}function It(e){if(this.moving||this.resizing){return}if(babelHelpers.classPrivateFieldLooseBase(this,kt)[kt]){babelHelpers.classPrivateFieldLooseBase(this,kt)[kt].fireAction()}}function Nt(){let e=null;const s=new v.Draggable({container:babelHelpers.classPrivateFieldLooseBase(this,Ft)[Ft],draggable:babelHelpers.classPrivateFieldLooseBase(this,wt)[wt].resizeContainer,type:BX.UI.DragAndDrop.Draggable.HEADLESS});this.textResize={wrapper:null,content:null};s.subscribe("start",(t=>{if(babelHelpers.classPrivateFieldLooseBase(this,St)[St].getAttribute("data-disable")){return}if(!this.textResize.wrapper||!this.textResize.content){this.textResize={wrapper:babelHelpers.classPrivateFieldLooseBase(this,kt)[kt].getLayout(),content:babelHelpers.classPrivateFieldLooseBase(this,kt)[kt].getLayout().querySelector(".sign-document__block-content")}}L.EventEmitter.emit("BX.Sign:resizeStart",s);e=babelHelpers.classPrivateFieldLooseBase(this,St)[St].getBoundingClientRect();babelHelpers.classPrivateFieldLooseBase(this,kt)[kt].onStartChangePosition();this.positionLast=null;p.Dom.removeClass(babelHelpers.classPrivateFieldLooseBase(this,kt)[kt].getLayout(),babelHelpers.classPrivateFieldLooseBase(this,wt)[wt].blockEditing)})).subscribe("end",(e=>{setTimeout((()=>{this.resizing=false}),0)})).subscribe("move",(s=>{if(babelHelpers.classPrivateFieldLooseBase(this,St)[St].getAttribute("data-disable")){return}this.resizing=true;let t=null;let a=null;let i=false;let{width:l,height:o}=e;const r=s.getData();const n=babelHelpers.classPrivateFieldLooseBase(this,St)[St].getBoundingClientRect();const c=babelHelpers.classPrivateFieldLooseBase(this,Ft)[Ft].getBoundingClientRect();if(p.Dom.hasClass(r.draggable,"sign-document__resize-control --left-top")){t=Math.max(0,e.left+r.offsetX-c.left);a=Math.max(0,e.top+r.offsetY-c.top);l=e.width-r.offsetX;o=e.height-r.offsetY}if(p.Dom.hasClass(r.draggable,"sign-document__resize-control --middle-top")){a=Math.max(0,e.top+r.offsetY-c.top);o=e.height-r.offsetY}if(p.Dom.hasClass(r.draggable,"sign-document__resize-control --right-top")){a=Math.max(0,e.top+r.offsetY-c.top);l=e.width+r.offsetX;o=e.height-r.offsetY}if(p.Dom.hasClass(r.draggable,"sign-document__resize-control --middle-right")){l=e.width+r.offsetX}if(p.Dom.hasClass(r.draggable,"sign-document__resize-control --right-bottom")){l=e.width+r.offsetX;o=e.height+r.offsetY;i=true}if(p.Dom.hasClass(r.draggable,"sign-document__resize-control --middle-bottom")){o=e.height+r.offsetY;i=true}if(p.Dom.hasClass(r.draggable,"sign-document__resize-control --left-bottom")){t=e.left+r.offsetX-c.left;l=e.width-r.offsetX;o=e.height+r.offsetY;i=true}if(p.Dom.hasClass(r.draggable,"sign-document__resize-control --middle-left")){t=e.left+r.offsetX-c.left;l=e.width-r.offsetX}if(l<60||o<20){return}const d={width:l,height:o};if(d["width"]+n.left-c.left>c.width){l=d["width"]=c.width+c.left-n.left}if(d["height"]+n.top-c.top>c.height){o=d["height"]=c.height+c.top-n.top}if(t){if(t<0){t=0}d["left"]=t}if(a){d["top"]=a}let b=e.top;let v=true;if(d.top){b=d.top;v=false}if(babelHelpers.classPrivateFieldLooseBase(this,kt)[kt].blocksManager.inDeadZone(b,b+d.height,v)){if(!i){babelHelpers.classPrivateFieldLooseBase(this,kt)[kt].showNotAllowedArea()}return}const u=Object.assign({},{...d,width:l-Mt.borderDelta,height:o-Mt.borderDelta});Xs.setRect(babelHelpers.classPrivateFieldLooseBase(this,St)[St],d);Xs.setRect(babelHelpers.classPrivateFieldLooseBase(this,Tt)[Tt],u);babelHelpers.classPrivateFieldLooseBase(this,kt)[kt].renderView();babelHelpers.classPrivateFieldLooseBase(this,kt)[kt].blocksManager.setSavingMark(false);babelHelpers.classPrivateFieldLooseBase(this,kt)[kt].adjustActionsPanel()}))}function Rt(){const e=babelHelpers.classPrivateFieldLooseBase(this,Ft)[Ft];let s;const t=new v.Draggable({container:e,draggable:babelHelpers.classPrivateFieldLooseBase(this,wt)[wt].moveContainer,type:v.Draggable.HEADLESS});t.subscribe("start",(e=>{if(babelHelpers.classPrivateFieldLooseBase(this,St)[St].getAttribute("data-disable")){return}L.EventEmitter.emit("BX.Sign:moveStart",t);if(this.resizing){return}const{source:s}=e.getData();this.position=p.Dom.getPosition(s);babelHelpers.classPrivateFieldLooseBase(this,kt)[kt].onStartChangePosition();this.positionLast=null;p.Dom.removeClass(babelHelpers.classPrivateFieldLooseBase(this,kt)[kt].getLayout(),babelHelpers.classPrivateFieldLooseBase(this,wt)[wt].blockEditing)})).subscribe("end",(e=>{setTimeout((()=>{this.moving=false}),0);if(!babelHelpers.classPrivateFieldLooseBase(this,kt)[kt]){return}if(this.resizing){return}s=null;const t=e.getData();let a=null;if(this.positionLast){a=babelHelpers.classPrivateFieldLooseBase(this,kt)[kt].blocksManager.inDeadZone(this.positionLast.top,this.positionLast.top+this.positionLast.height)}babelHelpers.classPrivateFieldLooseBase(this,kt)[kt].hideNotAllowedArea();if(a){Xs.setRect(t.source,{top:this.positionLast.top+a});Xs.setRect(babelHelpers.classPrivateFieldLooseBase(this,Tt)[Tt],{top:this.positionLast.top+a})}})).subscribe("move",(e=>{if(babelHelpers.classPrivateFieldLooseBase(this,St)[St].getAttribute("data-disable")){return}if(this.resizing){return}this.moving=true;const t=e.getData();const{source:a,offsetY:i,offsetX:l}=t;const o=t.source.getBoundingClientRect();const r=babelHelpers.classPrivateFieldLooseBase(this,Ft)[Ft].getBoundingClientRect();if(this.position){const e={top:i-r.top+this.position.y,left:l-r.left+this.position.x,width:s?s:this.position.width,height:this.position.height};if(e.left<0){e.left=0}if(e.top<0){e.top=0}if(e.top+o.height>r.height){e.top=r.height-o.height}if(e.left+o.width>r.width){babelHelpers.classPrivateFieldLooseBase(this,kt)[kt].renderView();if(r.width-e.left>50){s=e.width=r.width-e.left}else{e.left=r.width-o.width}}this.positionLast=Object.assign({},e);let t=null;if(this.positionLast){t=babelHelpers.classPrivateFieldLooseBase(this,kt)[kt].blocksManager.inDeadZone(this.positionLast.top,this.positionLast.top+this.positionLast.height)}if(t>0){babelHelpers.classPrivateFieldLooseBase(this,kt)[kt].showNotAllowedArea()}else{babelHelpers.classPrivateFieldLooseBase(this,kt)[kt].hideNotAllowedArea()}const n=Object.assign({},{...e,width:e.width-Mt.borderDelta,height:e.height-Mt.borderDelta});Xs.setRect(a,e);Xs.setRect(babelHelpers.classPrivateFieldLooseBase(this,Tt)[Tt],n);babelHelpers.classPrivateFieldLooseBase(this,kt)[kt].blocksManager.setSavingMark(false);babelHelpers.classPrivateFieldLooseBase(this,kt)[kt].adjustActionsPanel()}}))}Mt.borderDelta=2;const At=0;const xt=20;var Kt=babelHelpers.classPrivateFieldLooseKey("documentId");var jt=babelHelpers.classPrivateFieldLooseKey("documentUid");var zt=babelHelpers.classPrivateFieldLooseKey("companyId");var Ut=babelHelpers.classPrivateFieldLooseKey("initiatorName");var Gt=babelHelpers.classPrivateFieldLooseKey("entityId");var $t=babelHelpers.classPrivateFieldLooseKey("blankId");var Xt=babelHelpers.classPrivateFieldLooseKey("pagesMinHeight");var Vt=babelHelpers.classPrivateFieldLooseKey("disableEdit");var qt=babelHelpers.classPrivateFieldLooseKey("closeDemoContent");var Jt=babelHelpers.classPrivateFieldLooseKey("members");var Yt=babelHelpers.classPrivateFieldLooseKey("documentLayout");var Qt=babelHelpers.classPrivateFieldLooseKey("blocks");var Wt=babelHelpers.classPrivateFieldLooseKey("blocksColorChangeListeners");var Zt=babelHelpers.classPrivateFieldLooseKey("pagesRects");var ea=babelHelpers.classPrivateFieldLooseKey("seams");var sa=babelHelpers.classPrivateFieldLooseKey("config");var ta=babelHelpers.classPrivateFieldLooseKey("helpBtnElementId");var aa=babelHelpers.classPrivateFieldLooseKey("helpBtnHelperArticleCode");var ia=babelHelpers.classPrivateFieldLooseKey("api");var la=babelHelpers.classPrivateFieldLooseKey("lastContainerSize");var oa=babelHelpers.classPrivateFieldLooseKey("pixelToPercent");var ra=babelHelpers.classPrivateFieldLooseKey("percentToPixel");var na=babelHelpers.classPrivateFieldLooseKey("addBlock");var ca=babelHelpers.classPrivateFieldLooseKey("onRepositoryItemClick");var da=babelHelpers.classPrivateFieldLooseKey("startDisabledEditDocumentTour");var ba=babelHelpers.classPrivateFieldLooseKey("startEditDocumentTour");var pa=babelHelpers.classPrivateFieldLooseKey("highlightInvalidBlocks");var va=babelHelpers.classPrivateFieldLooseKey("onBlockColorStyleChange");class ua{constructor(e){Object.defineProperty(this,va,{value:Ba});Object.defineProperty(this,pa,{value:ya});Object.defineProperty(this,ba,{value:fa});Object.defineProperty(this,da,{value:ma});Object.defineProperty(this,ca,{value:La});Object.defineProperty(this,na,{value:Pa});Object.defineProperty(this,ra,{value:ga});Object.defineProperty(this,oa,{value:ha});Object.defineProperty(this,Kt,{writable:true,value:void 0});Object.defineProperty(this,jt,{writable:true,value:void 0});Object.defineProperty(this,zt,{writable:true,value:void 0});Object.defineProperty(this,Ut,{writable:true,value:void 0});Object.defineProperty(this,Gt,{writable:true,value:void 0});Object.defineProperty(this,$t,{writable:true,value:void 0});Object.defineProperty(this,Xt,{writable:true,value:0});Object.defineProperty(this,Vt,{writable:true,value:void 0});Object.defineProperty(this,qt,{writable:true,value:false});Object.defineProperty(this,Jt,{writable:true,value:void 0});Object.defineProperty(this,Yt,{writable:true,value:void 0});Object.defineProperty(this,Qt,{writable:true,value:[]});Object.defineProperty(this,Wt,{writable:true,value:new Map});Object.defineProperty(this,Zt,{writable:true,value:[]});Object.defineProperty(this,ea,{writable:true,value:[]});Object.defineProperty(this,sa,{writable:true,value:void 0});Object.defineProperty(this,ta,{writable:true,value:"sign-editor-help-btn"});Object.defineProperty(this,aa,{writable:true,value:"16571388"});Object.defineProperty(this,ia,{writable:true,value:void 0});Object.defineProperty(this,la,{writable:true,value:void 0});const{documentLayout:s,disableEdit:t}=e;babelHelpers.classPrivateFieldLooseBase(this,Yt)[Yt]=s;babelHelpers.classPrivateFieldLooseBase(this,Vt)[Vt]=t;if(!babelHelpers.classPrivateFieldLooseBase(this,Vt)[Vt]){this.resizeArea=new Mt({wrapperLayout:babelHelpers.classPrivateFieldLooseBase(this,Yt)[Yt]});p.Dom.append(this.resizeArea.getLayout(),babelHelpers.classPrivateFieldLooseBase(this,Yt)[Yt])}p.Event.bind(s,"click",(({target:e})=>{const s=e.closest(".sign-document__block-wrapper")||e.closest(".sign-document__resize-area");if(s){return}const t=this.resizeArea.getLinkedBlock();t==null?void 0:t.onClickOut()}));babelHelpers.classPrivateFieldLooseBase(this,ia)[ia]=new o.Api;babelHelpers.classPrivateFieldLooseBase(this,la)[la]={width:0,height:0}}initPagesRect(){let e=0;const s=[...babelHelpers.classPrivateFieldLooseBase(this,Yt)[Yt].querySelectorAll(".sign-editor__document_page img")];babelHelpers.classPrivateFieldLooseBase(this,Zt)[Zt]=[];babelHelpers.classPrivateFieldLooseBase(this,ea)[ea]=[];const t=document.querySelector(".sign-editor__content");s.forEach((s=>{const a=s.getBoundingClientRect();const i={};for(let e in a){if(p.Type.isNumber(a[e])){i[e]=Math.round(a[e])}else{i[e]=a[e]}}const l=e===0?0:i.top-xt+t.scrollTop;const o=i.top+At+t.scrollTop;babelHelpers.classPrivateFieldLooseBase(this,ea)[ea].push([l,o]);if(e===0){e=i.top}else{e+=xt;i.top=e}babelHelpers.classPrivateFieldLooseBase(this,Zt)[Zt].push(i);if(!babelHelpers.classPrivateFieldLooseBase(this,Xt)[Xt]||a.height<babelHelpers.classPrivateFieldLooseBase(this,Xt)[Xt]){babelHelpers.classPrivateFieldLooseBase(this,Xt)[Xt]=a.height}}));babelHelpers.classPrivateFieldLooseBase(this,Yt)[Yt].style.width=`${babelHelpers.classPrivateFieldLooseBase(this,Yt)[Yt].offsetWidth}px`}transferPositionToPage(e){e.page=1;for(let s=0,t=babelHelpers.classPrivateFieldLooseBase(this,Zt)[Zt].length;s<t;s++){const t=babelHelpers.classPrivateFieldLooseBase(this,Zt)[Zt][s].height;if(s!==0){e.top-=xt}e.top-=t;if(e.top<0){e.top+=t;break}else{e.page++}}return e}getMinPageHeight(){return babelHelpers.classPrivateFieldLooseBase(this,Xt)[Xt]-At}getDocumentId(){return babelHelpers.classPrivateFieldLooseBase(this,Kt)[Kt]}getDocumentUid(){return babelHelpers.classPrivateFieldLooseBase(this,jt)[jt]}setEditorContent(e){this.resizeArea.setFullEditorContent(e)}setDocumentUid(e){babelHelpers.classPrivateFieldLooseBase(this,jt)[jt]=e;return this}getEntityId(){return babelHelpers.classPrivateFieldLooseBase(this,Gt)[Gt]}getLayout(){return babelHelpers.classPrivateFieldLooseBase(this,Yt)[Yt]}getSeams(){return babelHelpers.classPrivateFieldLooseBase(this,ea)[ea]}getPagesGap(){return xt+At}addMembers(e){babelHelpers.classPrivateFieldLooseBase(this,Jt)[Jt]=e}getMembers(){return babelHelpers.classPrivateFieldLooseBase(this,Jt)[Jt]}getMemberByPart(e){let s=null;babelHelpers.classPrivateFieldLooseBase(this,Jt)[Jt].map((t=>{if(t.part===e){s=t}}));return s}getCompanyId(){return babelHelpers.classPrivateFieldLooseBase(this,zt)[zt]}getInitiatorName(){return babelHelpers.classPrivateFieldLooseBase(this,Ut)[Ut]}getConfig(){return babelHelpers.classPrivateFieldLooseBase(this,sa)[sa]}hideResizeArea(){this.resizeArea.hide()}showResizeArea(e){this.resizeArea.show(e)}muteResizeArea(){this.resizeArea.getLayout().setAttribute("data-disable",1)}unMuteResizeArea(){this.resizeArea.getLayout().removeAttribute("data-disable")}initBlocks(e){babelHelpers.classPrivateFieldLooseBase(this,Qt)[Qt]=[];for(const[e,s]of babelHelpers.classPrivateFieldLooseBase(this,Wt)[Wt].entries()){e.unsubscribe(e.events.onColorStyleChange,s)}babelHelpers.classPrivateFieldLooseBase(this,Wt)[Wt].clear();this.hideResizeArea();e.map((e=>babelHelpers.classPrivateFieldLooseBase(this,na)[na](e,true)))}initRepository(e){[...e].forEach((e=>{const s=e.getAttribute("data-code");const t=e.getAttribute("data-part");p.Event.bind(e,"click",(e=>{babelHelpers.classPrivateFieldLooseBase(this,ca)[ca](s,t);e.preventDefault()}))}))}getBlocks(){return babelHelpers.classPrivateFieldLooseBase(this,Qt)[Qt]}save(){const e=[];const s=document.querySelector(".sign-editor__document").offsetWidth;babelHelpers.classPrivateFieldLooseBase(this,Qt)[Qt].map((t=>{if(t.isRemoved()){return}const a=t.getLayout();const i=a.getBoundingClientRect();const l=[...babelHelpers.classPrivateFieldLooseBase(this,Yt)[Yt].querySelectorAll(".sign-editor__document_page img")];const o=l.map((e=>{const{top:s,left:t,width:a,height:i}=e.getBoundingClientRect();return{top:s,left:t,width:a,height:i}}));const r=o.find((e=>{if(Math.round(i.top)<Math.round(e.top)){return true}return false}));const n=r?o.indexOf(r):o.length;const c=o[n-1];let d={top:i.top-c.top,left:i.left-c.left,width:i.width,height:i.height,page:n};d=babelHelpers.classPrivateFieldLooseBase(this,oa)[oa](d,c);d.realDocumentWidthPx=s?s:null;const b=t.getCode();let p="text";switch(b){case"stamp":case"mystamp":case"sign":case"mysign":p="image"}e.push({id:t.getId(),code:t.getCode(),data:t.getData(),party:t.getMemberPart(),style:t.getStyle(),position:d,type:p})}));if(babelHelpers.classPrivateFieldLooseBase(this,qt)[qt]);this.hideResizeArea();return babelHelpers.classPrivateFieldLooseBase(this,ia)[ia].saveBlank(this.getDocumentUid(),e.length>0?e:[]).then((s=>{var i;if(!("errors"in s)){return e}if(((i=s.errors[0].customData)==null?void 0:i.field)==="requisites"){var l;const e=new t.Popup({id:"sign_document_error_popup",titleBar:p.Loc.getMessage("SIGN_JS_DOCUMENT_REQUISITES_RESTORE_TITLE"),content:BX.util.htmlspecialchars((l=s.errors[0])==null?void 0:l.message),buttons:[new u.Button({text:p.Loc.getMessage("SIGN_JS_DOCUMENT_REQUISITES_RESTORE"),color:u.ButtonColor.SUCCESS,onclick:({button:t})=>{var i,l;const o=t;p.Dom.addClass(o,"ui-btn-wait");a.Backend.controller({command:"document.restoreRequisiteFields",postData:{documentId:babelHelpers.classPrivateFieldLooseBase(this,Kt)[Kt],presetId:(i=s.errors[0])==null?void 0:i.customData.presetId,code:(l=s.errors[0])==null?void 0:l.customData.code}}).then((()=>{p.Dom.removeClass(o,"ui-btn-wait");babelHelpers.classPrivateFieldLooseBase(this,Qt)[Qt].map((e=>{var t;if(e.isRemoved()){return}if(e.getCode()===((t=s.errors[0])==null?void 0:t.customData.code)){e.assign()}}));e.destroy()})).catch((()=>{e.destroy()}))}}),new u.Button({text:p.Loc.getMessage("SIGN_JS_DOCUMENT_REQUISITES_RESTORE_BY_HANDS"),color:u.ButtonColor.INFO,onclick:()=>{babelHelpers.classPrivateFieldLooseBase(this,Qt)[Qt].map((e=>{var t;if(e.isRemoved()){return}if(e.getCode()===((t=s.errors[0])==null?void 0:t.customData.code)){const s=document.querySelector(`button[data-id="action-${e.getCode()}]`);if(s){s.click()}}}));e.destroy()}})]});e.show();return null}const o=s.errors[0];if(o.code==="REFERENCE_ERROR_FIELD_NOT_SELECTED"){babelHelpers.classPrivateFieldLooseBase(this,pa)[pa]();const e=new t.Popup({id:"sign_document_error_popup",titleBar:p.Loc.getMessage("SIGN_EDITOR_ERROR_SAVE_REFERENCE_BACK_TITLE"),content:BX.util.htmlspecialchars(o.message),buttons:[new u.Button({text:p.Loc.getMessage("SIGN_EDITOR_ERROR_SAVE_REFERENCE_BACK"),color:u.ButtonColor.PRIMARY,onclick:()=>{e.destroy()}})]});L.EventEmitter.subscribeOnce("SidePanel.Slider:onCloseComplete",(()=>{e.destroy()}));e.show();return null}return e}))}onSave(e){p.Event.bind(e.saveButton,"click",(s=>{if(babelHelpers.classPrivateFieldLooseBase(this,Vt)[Vt]){if(e.afterSaveCallback){e.afterSaveCallback()}return}this.save().then((s=>{if(s===true){this.setSavingMark(true);if(e.afterSaveCallback){e.afterSaveCallback()}}if(s!==true){if(e.saveErrorCallback){e.saveErrorCallback()}}}))}))}onCloseSlider(){BX.addCustomEvent("SidePanel.Slider:onClose",(e=>{if(e.slider.url.indexOf("/sign/edit/")===0){if(!this.everythingIsSaved()){e.denyAction();s.MessageBox.confirm(p.Loc.getMessage("SIGN_JS_DOCUMENT_SAVE_ALERT_MESSAGE"),p.Loc.getMessage("SIGN_JS_DOCUMENT_SAVE_ALERT_TITLE"),(s=>{this.setSavingMark(true);s.close();e.slider.close()}),p.Loc.getMessage("SIGN_JS_DOCUMENT_SAVE_ALERT_APPLY"),(e=>{e.close()}))}}}))}setSavingMark(e){this.setParam("bxSignEditorAllSaved",e)}everythingIsSaved(){return this.getParam("bxSignEditorAllSaved")===true}setParam(e,s){const t=BX.SidePanel.Instance.getSliderByWindow(window);if(t){t.getData().set(e,s)}}getParam(e){const s=BX.SidePanel.Instance.getSliderByWindow(window);if(s){return s.getData().get(e)}return undefined}inDeadZone(e,s,t){const a=this.getSeams();const i=document.querySelector(".sign-editor__content");e+=i.scrollTop;s+=i.scrollTop;if(a.length>0&&t!==true){const t=babelHelpers.classPrivateFieldLooseBase(this,Yt)[Yt].getBoundingClientRect();e+=t.top;s+=t.top}for(let t=0,i=a.length;t<i;t++){const i=a[t];if(e<=i[0]&&s>=i[0]&&s<=i[1]){return i[0]-s}if(e<=i[0]&&s>=i[1]){return i[0]-s}if(e>=i[0]&&s<=i[1]){return i[0]-s}if(e>=i[0]&&e<=i[1]&&s>=i[1]){return i[1]-e}}return 0}}function ha(e,s){e.widthPx=e.width;e.heightPx=e.height;e.left=e.left*100/s.width;e.top=e.top*100/s.height;e.width=e.width/s.width*100;e.height=e.height/s.height*100;return e}function ga(e){if(!e.page||typeof babelHelpers.classPrivateFieldLooseBase(this,Zt)[Zt][e.page-1]==="undefined"){return e}const s=babelHelpers.classPrivateFieldLooseBase(this,Zt)[Zt][e.page-1];const t={};if(typeof e.left==="number"){t.left=e.left*s.width/100}if(typeof e.top==="number"){let a=e.top*s.height/100;let i=0;while(i<e.page-1){a+=babelHelpers.classPrivateFieldLooseBase(this,Zt)[Zt][i].height+xt;i++}t.top=a}if(typeof e.width==="number"){t.width=e.width*s.width/100}if(typeof e.height==="number"){t.height=e.height*s.height/100}return t}function Pa(e,s){const t=e.position?babelHelpers.classPrivateFieldLooseBase(this,ra)[ra](e.position):null;const a=new ft({id:e.id,code:e.code,party:e.party,blocksManager:this,data:e.data,position:t,style:e.style,onClick:e=>{if(babelHelpers.classPrivateFieldLooseBase(this,Vt)[Vt]){return}this.resizeArea.show(e);this.unMuteResizeArea();e.adjustActionsPanel()},onRemove:e=>{this.resizeArea.hide()}});const i=a.getLayout();if(["sign","mysign"].includes(a.getCode())){var l;const e=e=>babelHelpers.classPrivateFieldLooseBase(this,va)[va](a,e);babelHelpers.classPrivateFieldLooseBase(this,Wt)[Wt].set(a,e);a.subscribe(a.events.onColorStyleChange,e);const s=babelHelpers.classPrivateFieldLooseBase(this,Qt)[Qt].find((e=>e.getCode()===a.getCode()));const t=s==null?void 0:s.getStyle==null?void 0:(l=s.getStyle())==null?void 0:l.color;if(!p.Type.isNil(t)){a.updateColor(t,false)}}babelHelpers.classPrivateFieldLooseBase(this,Qt)[Qt].push(a);p.Dom.append(i,babelHelpers.classPrivateFieldLooseBase(this,Yt)[Yt]);return a}function La(e,s){s=parseInt(s);this.setSavingMark(false);const t=babelHelpers.classPrivateFieldLooseBase(this,na)[na]({code:e,party:s});t.assign();t.onPlaced()}function ma(){const e=new h.Guide({steps:[{target:document.getElementById("sign-editor-btn-edit"),title:p.Loc.getMessage("SIGN_JS_DOCUMENT_TOUR_BTN_EDIT_TITLE"),text:p.Loc.getMessage("SIGN_JS_DOCUMENT_TOUR_BTN_EDIT_TEXT")}],id:"sign-tour-guide-onboarding-master-document-edit-disabled",autoSave:true,simpleMode:true});e.startOnce()}function fa(){const e=new BX.SpotLight({targetElement:document.getElementById(babelHelpers.classPrivateFieldLooseBase(this,ta)[ta]),targetVertex:"middle-center",autoSave:true,id:"sign-spotlight-onboarding-master-document-edit"});const s=new h.Guide({steps:[{target:document.getElementById("sign-editor-bar-content"),title:p.Loc.getMessage("SIGN_JS_DOCUMENT_TOUR_BTN_BLOCKS_TITLE"),text:p.Loc.getMessage("SIGN_JS_DOCUMENT_TOUR_BTN_BLOCKS_TEXT"),position:"left"},{target:document.getElementById(babelHelpers.classPrivateFieldLooseBase(this,ta)[ta]),title:p.Loc.getMessage("SIGN_JS_DOCUMENT_TOUR_BTN_HELP_TITLE"),text:p.Loc.getMessage("SIGN_JS_DOCUMENT_TOUR_BTN_HELP_TEXT"),rounded:true,article:babelHelpers.classPrivateFieldLooseBase(this,aa)[aa],events:{onShow:()=>e.show(),onClose:()=>e.close()}}],id:"sign-tour-guide-onboarding-master-document-edit",autoSave:true,simpleMode:true});s.startOnce()}function ya(){babelHelpers.classPrivateFieldLooseBase(this,Qt)[Qt].forEach((e=>{if(e.isRemoved()){return}const s=e.getCode();const t=s==="reference"||s==="myreference";if(t&&p.Type.isArray(e.getData())){p.Dom.addClass(e.getLayout(),"--invalid")}}))}function Ba(e,s){var t;if(!["sign","mysign"].includes(e.getCode())){return}const a=(t=s.getData().color)!=null?t:null;if(p.Type.isNull(a)){return}babelHelpers.classPrivateFieldLooseBase(this,Qt)[Qt].filter((s=>e.getCode()===s.getCode())).forEach((s=>{if(e===s){return}s.updateColor(a,false)}))}let _a=e=>e,Ha,Fa,Sa,Ca,Ta,ka,wa,Oa;const Ea=["ui-btn","ui-btn-sm","ui-btn-round","ui-btn-light-border"];const Da={myreference:{title:"SIGN_EDITOR_BLOCK_CRM",hint:"SIGN_EDITOR_BLOCK_CRM_HINT"},myrequisites:{title:"SIGN_EDITOR_BLOCK_REQUISITES",hint:"SIGN_EDITOR_BLOCK_FIRST_PARTY_REQUISITES_HINT"},mysign:{title:"SIGN_EDITOR_BLOCK_SIGNATURE",hint:"SIGN_EDITOR_BLOCK_FIRST_PARTY_SIGNATURE_HINT"},mystamp:{title:"SIGN_EDITOR_BLOCK_STAMP_MSGVER_1",hint:"SIGN_EDITOR_BLOCK_FIRST_PARTY_STAMP_HINT"}};const Ma={reference:{...Da.myreference},requisites:{...Da.myrequisites,hint:"SIGN_EDITOR_BLOCK_PARTNER_REQUISITES_HINT"},sign:{...Da.mysign,hint:"SIGN_EDITOR_BLOCK_PARTNER_SIGNATURE_HINT"},stamp:{...Da.mystamp,hint:"SIGN_EDITOR_BLOCK_PARTNER_STAMP_HINT"}};const Ia={text:{title:"SIGN_EDITOR_BLOCK_TEXT",hint:"SIGN_EDITOR_BLOCK_TEXT_HINT"},date:{title:"SIGN_EDITOR_BLOCK_DATE",hint:"SIGN_EDITOR_BLOCK_DATE_HINT"},number:{title:"SIGN_EDITOR_BLOCK_NUMBER",hint:"SIGN_EDITOR_BLOCK_NUMBER_HINT"}};const Na=[{title:"SIGN_EDITOR_BLOCKS_FIRST_PARTY",blocks:Da,part:1},{title:"SIGN_EDITOR_BLOCKS_PARTNER",blocks:Ma,part:2},{title:"SIGN_EDITOR_BLOCKS_GENERAL",blocks:Ia,part:0}];const Ra="16571388";var Aa=babelHelpers.classPrivateFieldLooseKey("sidePanel");var xa=babelHelpers.classPrivateFieldLooseKey("closeSidePanel");var Ka=babelHelpers.classPrivateFieldLooseKey("dom");var ja=babelHelpers.classPrivateFieldLooseKey("documentLayout");var za=babelHelpers.classPrivateFieldLooseKey("blocksManager");var Ua=babelHelpers.classPrivateFieldLooseKey("popupHint");var Ga=babelHelpers.classPrivateFieldLooseKey("render");var $a=babelHelpers.classPrivateFieldLooseKey("createHeader");var Xa=babelHelpers.classPrivateFieldLooseKey("createContent");var Va=babelHelpers.classPrivateFieldLooseKey("createSections");var qa=babelHelpers.classPrivateFieldLooseKey("toggleEditMode");class Ja extends L.EventEmitter{constructor(){super();Object.defineProperty(this,qa,{value:ei});Object.defineProperty(this,Va,{value:Za});Object.defineProperty(this,Xa,{value:Wa});Object.defineProperty(this,$a,{value:Qa});Object.defineProperty(this,Ga,{value:Ya});Object.defineProperty(this,Aa,{writable:true,value:void 0});Object.defineProperty(this,xa,{writable:true,value:void 0});Object.defineProperty(this,Ka,{writable:true,value:void 0});Object.defineProperty(this,ja,{writable:true,value:void 0});Object.defineProperty(this,za,{writable:true,value:void 0});Object.defineProperty(this,Ua,{writable:true,value:void 0});this.setEventNamespace("BX.Sign.V2.Editor");const{Instance:e}=p.Reflection.getClass("BX.SidePanel");babelHelpers.classPrivateFieldLooseBase(this,Aa)[Aa]=e;babelHelpers.classPrivateFieldLooseBase(this,Ka)[Ka]=p.Tag.render(Ha||(Ha=_a`<div class="sign-wizard__scope sign-editor"></div>`));babelHelpers.classPrivateFieldLooseBase(this,ja)[ja]=p.Tag.render(Fa||(Fa=_a`
			<div class="sign-editor__document"></div>
		`));babelHelpers.classPrivateFieldLooseBase(this,za)[za]=new ua({documentLayout:babelHelpers.classPrivateFieldLooseBase(this,ja)[ja],disableEdit:false});const s=p.Reflection.getClass("BX.UI.Hint");babelHelpers.classPrivateFieldLooseBase(this,Ua)[Ua]=s==null?void 0:s.createInstance({popupParameters:{autoHide:true,bindOptions:{position:"top"},angle:{position:"bottom"}}})}set entityData(e){const s=Object.values(e).map((e=>{const{id:s,title:t,part:a,presetId:i,entityTypeId:l,uid:o}=e;return{cid:s,name:t,part:a,presetId:i,entityTypeId:l,uid:o}}));babelHelpers.classPrivateFieldLooseBase(this,za)[za].addMembers(s)}async renderDocument(){p.Dom.clean(babelHelpers.classPrivateFieldLooseBase(this,ja)[ja]);if(this.urls.length===0){return}const{uid:e="",isTemplate:s}=this.documentData;!s?babelHelpers.classPrivateFieldLooseBase(this,qa)[qa](true):babelHelpers.classPrivateFieldLooseBase(this,qa)[qa](false);babelHelpers.classPrivateFieldLooseBase(this,za)[za].setDocumentUid(e);const{promises:t,fragment:a}=this.urls.reduce(((e,s)=>{const{fragment:t,promises:a}=e;const i=new Promise((e=>{const a=p.Tag.render(Sa||(Sa=_a`
					<div class="sign-editor__document_page">
						<img src="${0}" onload="${0}" />
					</div>
				`),s,e);p.Dom.append(a,t)}));a.push(i);return e}),{fragment:new DocumentFragment,promises:[]});p.Dom.append(a,babelHelpers.classPrivateFieldLooseBase(this,ja)[ja]);const{resizeArea:i}=babelHelpers.classPrivateFieldLooseBase(this,za)[za];p.Dom.append(i.getLayout(),babelHelpers.classPrivateFieldLooseBase(this,ja)[ja]);await Promise.all(t);L.EventEmitter.unsubscribeAll("SidePanel.Slider:onOpenComplete");L.EventEmitter.subscribeOnce("SidePanel.Slider:onOpenComplete",(e=>{const s=babelHelpers.classPrivateFieldLooseBase(this,Ka)[Ka].querySelector(".sign-editor__content");if(s){s.scrollTop=0}babelHelpers.classPrivateFieldLooseBase(this,za)[za].initPagesRect();babelHelpers.classPrivateFieldLooseBase(this,za)[za].initBlocks(this.documentData.blocks)}))}show(){return new Promise((e=>{babelHelpers.classPrivateFieldLooseBase(this,xa)[xa]=e;babelHelpers.classPrivateFieldLooseBase(this,Aa)[Aa].open("editor",{contentCallback:()=>{babelHelpers.classPrivateFieldLooseBase(this,Ga)[Ga]();return babelHelpers.classPrivateFieldLooseBase(this,Ka)[Ka]},events:{onCloseComplete:()=>babelHelpers.classPrivateFieldLooseBase(this,xa)[xa]()}})}));return this.promise}}function Ya(){p.Dom.clean(babelHelpers.classPrivateFieldLooseBase(this,Ka)[Ka]);p.Dom.append(babelHelpers.classPrivateFieldLooseBase(this,$a)[$a](),babelHelpers.classPrivateFieldLooseBase(this,Ka)[Ka]);p.Dom.append(babelHelpers.classPrivateFieldLooseBase(this,Xa)[Xa](),babelHelpers.classPrivateFieldLooseBase(this,Ka)[Ka])}function Qa(){const e=["sign-editor__header_edit-btn",...Ea].join(" ");const s=["ui-btn-success",...Ea.slice(0,-1)].join(" ");const t=p.Loc.getMessage("SIGN_EDITOR_EDIT");const a=p.Loc.getMessage("SIGN_EDITOR_SAVE");return p.Tag.render(Ca||(Ca=_a`
			<div class="sign-editor__header">
				<p class="sign-editor__header_title">
					${0}
				</p>
				<div class="sign-editor__header_right">
					<span
						onclick="${0}"
						class="sign-editor__header_help"
					></span>
					<span
						class="${0}"
						title="${0}"
						onclick="${0}"
					>
						${0}
					</span>
					<span
						class="${0}"
						title="${0}"
						onclick="${0}"
					>
						${0}
					</span>
				</div>
			</div>
		`),p.Loc.getMessage("SIGN_EDITOR_EDITING"),(e=>{const s=p.Reflection.getClass("BX.Helper");s.show("redirect=detail&code="+Ra)}),e,t,(()=>{babelHelpers.classPrivateFieldLooseBase(this,qa)[qa](true)}),t,s,a,(async({target:e})=>{p.Dom.addClass(e,"ui-btn-wait");const s=await babelHelpers.classPrivateFieldLooseBase(this,za)[za].save();p.Dom.removeClass(e,"ui-btn-wait");if(!s){return}L.EventEmitter.subscribeOnce("SidePanel.Slider:onCloseComplete",(()=>{this.emit("save",{blocks:s})}));babelHelpers.classPrivateFieldLooseBase(this,Aa)[Aa].close();babelHelpers.classPrivateFieldLooseBase(this,qa)[qa](false)}),a)}function Wa(){const e=p.Tag.render(Ta||(Ta=_a`
			<div class="sign-editor__content">
				<div class="sign-editor__document-container">
					${0}
				</div>
				${0}
			</div>
		`),babelHelpers.classPrivateFieldLooseBase(this,ja)[ja],babelHelpers.classPrivateFieldLooseBase(this,Va)[Va]());babelHelpers.classPrivateFieldLooseBase(this,za)[za].setEditorContent(e);babelHelpers.classPrivateFieldLooseBase(this,Ua)[Ua].popupParameters={...babelHelpers.classPrivateFieldLooseBase(this,Ua)[Ua].popupParameters,targetContainer:e};return e}function Za(){const e=Na.map((e=>{const s=Object.entries(e.blocks);const t=s.map((([s,t])=>{const{title:a,hint:i}=t;return p.Tag.render(ka||(ka=_a`
					<div
						class="sign-editor__section_block"
						data-code="${0}"
						data-part="${0}"
					>
						<span>
							<span>${0}</span>
							<span data-hint="${0}"></span>
						</span>
						<span class="sign-editor__section_add-block-btn">
							${0}
						</span>
					</div>
				`),s,e.part,p.Loc.getMessage(a),p.Loc.getMessage(i),p.Loc.getMessage("SIGN_EDITOR_BLOCK_ADD_TO_DOCUMENT"))}));babelHelpers.classPrivateFieldLooseBase(this,za)[za].initRepository(t);return p.Tag.render(wa||(wa=_a`
				<div class="sign-editor__section">
					<p class="sign-editor__section_title">
						${0}
					</p>
					${0}
				</div>
			`),p.Loc.getMessage(e.title),t)}));const s=p.Tag.render(Oa||(Oa=_a`
			<div class="sign-editor__sections">
				${0}
			</div>
		`),e);babelHelpers.classPrivateFieldLooseBase(this,Ua)[Ua].init(s);return s}function ei(e){if(e){p.Dom.addClass(babelHelpers.classPrivateFieldLooseBase(this,Ka)[Ka],"--editable");return}p.Dom.removeClass(babelHelpers.classPrivateFieldLooseBase(this,Ka)[Ka],"--editable")}e.Editor=Ja})(this.BX.Sign.V2=this.BX.Sign.V2||{},BX.UI.Dialogs,BX.Main,BX.Sign,BX,BX.UI.Stamp,BX.Sign.V2,BX.Crm.Form.Fields,BX.Crm.Requisite,BX.Sign,BX,BX.Sign,BX,BX.UI.DragAndDrop,BX.UI,BX.Sign.Tour,BX,BX,BX.Event);
//# sourceMappingURL=editor.bundle.map.js