{"version":3,"file":"editor.bundle.js","sources":["../src/blocks/dummy.js","../src/blocks/date.js","../src/blocks/myrequisites.js","../../../document/src/ui.js","../src/blocks/mysign.js","../src/blocks/mystamp.js","../src/blocks/number.js","../src/blocks/reference.js","../src/blocks/myreference.js","../src/blocks/requisites.js","../src/blocks/stamp.js","../src/blocks/sign.js","../src/blocks/text.js","../src/blocks/ui.js","../src/blocks/style.js","../src/blocks/block.js","../src/blocks/resize.js","../src/blocks/blocksManager.js","../src/index.js"],"sourcesContent":["import { Tag, Text as TextFormat } from 'main.core';\nimport Block from './block';\nimport { EventEmitter } from \"main.core.events\";\n\nexport default class Dummy extends EventEmitter\n{\n\tblock: Block;\n\tdata: any = {};\n\tevents= {\n\t\tonChange: 'onChange',\n\t\tonColorStyleChange: 'onColorStyleChange',\n\t};\n\n\tstatic defaultTextBlockPaddingStyles = {\n\t\tpadding: \"5px 8px\"\n\t};\n\n\t/**\n\t * Constructor.\n\t * @param {Block} block\n\t */\n\tconstructor(block: Block)\n\t{\n\t\tsuper();\n\t\tthis.setEventNamespace('BX.Sign.V2.Editor.Blocks.Dummy')\n\t\tthis.block = block;\n\t}\n\n\t/**\n\t * Returns true if block is in singleton mode.\n\t * @return {boolean}\n\t */\n\tisSingleton(): boolean\n\t{\n\t\treturn false;\n\t}\n\n\t/**\n\t * Returns true if style panel mast be showed.\n\t * @return {boolean}\n\t */\n\tisStyleAllowed(): boolean\n\t{\n\t\treturn true;\n\t}\n\n\t/**\n\t * Sets new data.\n\t * @param {any} data\n\t */\n\tsetData(data: any)\n\t{\n\t\tthis.data = data ? data : {};\n\t}\n\n\t/**\n\t * Changes only text key in data.\n\t * @param {string} text\n\t */\n\tsetText(text: string)\n\t{\n\t\tthis.setData({ text });\n\t}\n\n\t/**\n\t * Returns initial dimension of block.\n\t * @return {width: number, height: number}\n\t */\n\tgetInitDimension(): {width: number, height: number}\n\t{\n\t\treturn {\n\t\t\twidth: 250,\n\t\t\theight: 28\n\t\t};\n\t}\n\n\t/**\n\t * Returns current data.\n\t * @return {any}\n\t */\n\tgetData(): any\n\t{\n\t\treturn this.data;\n\t}\n\n\t/**\n\t * Returns action button for edit content.\n\t * @return {HTMLElement | null}\n\t */\n\tgetActionButton(): ?HTMLElement\n\t{\n\t\treturn null;\n\t}\n\n\t/**\n\t * @return {HTMLElement | null}\n\t */\n\tgetBlockCaption(): ?HTMLElement\n\t{\n\t\treturn null;\n\t}\n\n\t/**\n\t * Returns type's content in view mode.\n\t * @return {HTMLElement | string}\n\t */\n\tgetViewContent(): HTMLElement | string\n\t{\n\t\treturn Tag.render`\n\t\t\t<div>\n\t\t\t\t${TextFormat.encode(this.data.text || '').toString().replaceAll('[br]', '<br>')}\n\t\t\t</div>\n\t\t`;\n\t}\n\n\t/**\n\t * Calls when block starts being resized or moved.\n\t */\n\tonStartChangePosition()\n\t{\n\t}\n\n\t/**\n\t * Calls when block has placed on document.\n\t */\n\tonPlaced()\n\t{\n\t}\n\n\t/**\n\t * Calls when block saved.\n\t */\n\tonSave()\n\t{\n\t}\n\n\t/**\n\t * Calls when block removed.\n\t */\n\tonRemove()\n\t{\n\t}\n\n\t/**\n\t * Calls when click was out the block.\n\t */\n\tonClickOut()\n\t{\n\t\tthis.block.forceSave();\n\t}\n\n\tonChange(): void\n\t{\n\t\tthis.emit(this.events.onChange)\n\t}\n\n\tgetStyles(): {[styleName: string]: string}\n\t{\n\t\treturn {};\n\t}\n\n\tchangeStyleColor(color: string): void\n\t{}\n}\n","import 'date';\nimport { Loc, Tag, Dom } from 'main.core';\n\nimport Dummy from './dummy';\n\nexport default class Date extends Dummy\n{\n\t#calendar: BX.JCCalendar;\n\t#calendarOpened: boolean = false;\n\t#date: string;\n\n\t/**\n\t * Returns initial dimension of block.\n\t * @return {width: number, height: number}\n\t */\n\tgetInitDimension(): {width: number, height: number}\n\t{\n\t\treturn {\n\t\t\twidth: 105,\n\t\t\theight: 28\n\t\t};\n\t}\n\n\t/**\n\t * Sets new data.\n\t * @param {any} data\n\t */\n\tsetData(data: any)\n\t{\n\t\tthis.data = data ? data : {};\n\t\tthis.#date = this.data.text;\n\t}\n\n\t/**\n\t * Calls when action button was clicked.\n\t */\n\tonActionClick()\n\t{\n\t\tthis.#calendar = BX.calendar({\n\t\t\tnode: this.block.getLayout(),\n\t\t\tfield: this.getViewContent(),\n\t\t\tvalue: this.#date,\n\t\t\tbTime: false,\n\t\t\tcallback_after: (date) => {\n\t\t\t\tthis.setText(\n\t\t\t\t\tBX.date.format(BX.date.convertBitrixFormat(BX.message('FORMAT_DATE')), date, null)\n\t\t\t\t);\n\t\t\t\tthis.block.renderView();\n\t\t\t}\n\t\t});\n\n\t\tthis.#calendarOpened = true;\n\t\tconst targetContainer = document.querySelector('.sign-editor__content');\n\t\tconst { popup } = this.#calendar;\n\t\tpopup.targetContainer = targetContainer;\n\t\tif (popup.popupContainer.parentElement !== targetContainer)\n\t\t{\n\t\t\tDom.append(popup.popupContainer, targetContainer);\n\t\t\tpopup.adjustPosition();\n\t\t}\n\t}\n\n\t/**\n\t * Returns action button for edit content.\n\t * @return {HTMLElement}\n\t */\n\tgetActionButton(): HTMLElement\n\t{\n\t\treturn Tag.render`\n\t\t\t<div class=\"sign-document__block-style-btn --funnel\">\n\t\t\t\t<button onclick=\"${this.onActionClick.bind(this)}\" data-role=\"action\">\n\t\t\t\t\t${Loc.getMessage('SIGN_JS_DOCUMENT_DATE_ACTION_BUTTON')}\n\t\t\t\t</button>\n\t\t\t</div>\n\t\t`;\n\t}\n\n\t/**\n\t * Closes calendar if open.\n\t */\n\t#closeCalendar()\n\t{\n\t\tif (this.#calendar)\n\t\t{\n\t\t\tthis.#calendar.Close();\n\t\t\tthis.#calendarOpened = false;\n\t\t}\n\t}\n\n\t/**\n\t * Calls when block starts being resized or moved.\n\t */\n\tonStartChangePosition()\n\t{\n\t\tthis.#closeCalendar();\n\t}\n\n\t/**\n\t * Calls when block saved.\n\t */\n\tonSave()\n\t{\n\t\tthis.#closeCalendar();\n\t}\n\n\t/**\n\t * Calls when block removed.\n\t */\n\tonRemove()\n\t{\n\t\tthis.#closeCalendar();\n\t}\n\n\t/**\n\t * Calls when click was out the block.\n\t */\n\tonClickOut()\n\t{\n\t\tif (!this.#calendarOpened)\n\t\t{\n\t\t\tthis.block.forceSave();\n\t\t}\n\n\t\tthis.#calendarOpened = false;\n\t}\n\n\tgetStyles(): { [p: string]: string }\n\t{\n\t\treturn { ...super.getStyles(), ...Date.defaultTextBlockPaddingStyles };\n\t}\n}\n","import { FieldsetViewer } from 'crm.requisite.fieldset-viewer';\nimport { Loc, Tag } from 'main.core';\n\nimport Dummy from './dummy';\n\nexport default class MyRequisites extends Dummy\n{\n\t/**\n\t * Returns true if block is in singleton mode.\n\t * @return {boolean}\n\t */\n\tisSingleton(): boolean\n\t{\n\t\treturn true;\n\t}\n\n\t/**\n\t * Returns initial dimension of block.\n\t * @return {width: number, height: number}\n\t */\n\tgetInitDimension(): { width: number, height: number }\n\t{\n\t\treturn {\n\t\t\twidth: 250,\n\t\t\theight: 220,\n\t\t};\n\t}\n\n\t/**\n\t * Calls when action button was clicked.\n\t * @param {PointerEvent} event\n\t */\n\t#onActionClick(event: PointerEvent)\n\t{\n\t\tconst blocksManager = this.block.blocksManager;\n\t\tconst config = blocksManager.getConfig();\n\n\t\tevent.stopPropagation();\n\t\tconst member = blocksManager.getMemberByPart(1);\n\t\tconst { cid, entityTypeId, presetId } = member;\n\t\t(new FieldsetViewer({\n\t\t\tentityTypeId,\n\t\t\tentityId: cid,\n\t\t\tevents: {\n\t\t\t\tonClose: () => {\n\t\t\t\t\tthis.block.assign();\n\t\t\t\t},\n\t\t\t},\n\t\t\tfieldListEditorOptions: {\n\t\t\t\tfieldsPanelOptions: {\n\t\t\t\t\tfilter: {\n\t\t\t\t\t\t'+categories': [\n\t\t\t\t\t\t\t'COMPANY',\n\t\t\t\t\t\t],\n\t\t\t\t\t\t'+fields': [\n\t\t\t\t\t\t\t'list',\n\t\t\t\t\t\t\t'string',\n\t\t\t\t\t\t\t'date',\n\t\t\t\t\t\t\t'typed_string',\n\t\t\t\t\t\t\t'text',\n\t\t\t\t\t\t\t'datetime',\n\t\t\t\t\t\t\t'enumeration',\n\t\t\t\t\t\t\t'address',\n\t\t\t\t\t\t\t'url',\n\t\t\t\t\t\t\t'money',\n\t\t\t\t\t\t\t'boolean',\n\t\t\t\t\t\t\t'double',\n\t\t\t\t\t\t\t'integer',\n\t\t\t\t\t\t],\n\t\t\t\t\t},\n\t\t\t\t\tpresetId,\n\t\t\t\t\tcontrollerOptions: {\n\t\t\t\t\t\thideVirtual: 1,\n\t\t\t\t\t\thideRequisites: 0,\n\t\t\t\t\t\thideSmartDocument: 1,\n\t\t\t\t\t\tpresetId,\n\t\t\t\t\t},\n\t\t\t\t},\n\t\t\t},\n\t\t}))\n\t\t\t.show()\n\t\t;\n\t}\n\n\t/**\n\t * Returns action button for edit content.\n\t * @return {HTMLElement}\n\t */\n\tgetActionButton(): HTMLElement\n\t{\n\t\treturn Tag.render`\n\t\t\t<div class=\"sign-document__block-style-btn --funnel\">\n\t\t\t\t<button onclick=\"${this.#onActionClick.bind(this)}\" data-role=\"action\" data-id=\"action-${this.block.getCode()}\">\n\t\t\t\t\t${Loc.getMessage('SIGN_JS_DOCUMENT_REQUISITES_ACTION_BUTTON')}\n\t\t\t\t</button>\n\t\t\t</div>\n\t\t`;\n\t}\n\n\tgetStyles(): { [p: string]: string }\n\t{\n\t\treturn { ...super.getStyles(), ...MyRequisites.defaultTextBlockPaddingStyles };\n\t}\n}\n","import { Dom, Event, Loc, Tag, Text as TextFormat, Reflection, Type } from 'main.core';\nimport { UI as SignUI } from 'sign.ui';\nimport { MemberItem } from './types/document';\n\nimport './style.css';\nimport 'color_picker';\n\ntype BlockLayoutOptions = {\n\tonRemove: () => {},\n\tonSave: () => {}\n};\n\nexport type ColorPickerOptions = {\n\tcolors?: Array<Array<string>>,\n\tallowCustomColor?: boolean,\n\tselectedColor?: string,\n\tcolorPreview?: boolean,\n}\n\nconst ColorPicker = Reflection.getClass('BX.ColorPicker');\n\nexport default class UI\n{\n\t/**\n\t * Sets width/height/top/left to element.\n\t * @param {HTMLElement} element\n\t * @param {{[key: string]: number}} rect\n\t */\n\tstatic setRect(element: HTMLElement, rect: {[key: string]: number})\n\t{\n\t\tObject.keys(rect).map(key => {\n\t\t\trect[key] = parseInt(rect[key]) + 'px';\n\t\t});\n\t\tDom.style(element, rect);\n\t}\n\n\t/**\n\t * Returns block's layout.\n\t * @param {BlockLayoutOptions} options Layout options.\n\t * @return {HTMLElement}\n\t */\n\tstatic getBlockLayout(options: BlockLayoutOptions): HTMLElement\n\t{\n\t\treturn Tag.render`\n\t\t\t<div class=\"sign-document__block-wrapper\">\n\t\t\t\t<div class=\"sign-document__block-panel--wrapper\" data-role=\"sign-block__actions\">\n\t\t\t\t</div>\n\t\t\t\t<div class=\"sign-document__block-content\">\n\t\t\t\t</div>\n\t\t\t\t<div class=\"sign-document__block-actions\">\n\t\t\t\t\t<div class=\"sign-document__block-actions--wrapper\">\n\t\t\t\t\t\t<button class=\"sign-document__block-actions-btn --remove sign-block-action-remove\" data-role=\"removeAction\" onclick=\"${options.onRemove}\"></button>\n\t\t\t\t\t\t<button class=\"sign-document__block-actions-btn --save sign-block-action-save\" data-role=\"saveAction\" onclick=\"${options.onSave}\"></button>\n\t\t\t\t\t</div>\n\t\t\t\t</div>\n\t\t\t</div>\n\t\t`;\n\t}\n\n\t/**\n\t * Returns member selector for block.\n\t * @param {Array<MemberItem>} members All document's members.\n\t * @param {number} selectedValue Selected member.\n\t * @param {() => {}} onChange Handler on change value.\n\t * @return {HTMLElement}\n\t */\n\tstatic getMemberSelector(members: Array<MemberItem>, selectedValue: number,  onChange: () => {}): HTMLElement\n\t{\n\t\tconst menuItems = {};\n\t\tlet selectedName = Loc.getMessage('SIGN_JS_DOCUMENT_MEMBER_NAME_NOT_SET');\n\n\t\tmembers.map(member => {\n\t\t\tmember.name = member.name || Loc.getMessage('SIGN_JS_DOCUMENT_MEMBER_NAME_NOT_SET');\n\t\t\tmenuItems[member.part] = member.name;\n\n\t\t\tif (member.part === selectedValue)\n\t\t\t{\n\t\t\t\tselectedName = member.name;\n\t\t\t}\n\t\t});\n\n\t\tconst memberSelector = (members.length > 1)\n\t\t\t? Tag.render`<span>${TextFormat.encode(selectedName)}</span>`\n\t\t\t: Tag.render`<i>${TextFormat.encode(selectedName)}</i>`;\n\n\t\tif (members.length > 1)\n\t\t{\n\t\t\tSignUI.bindSimpleMenu({\n\t\t\t\tbindElement: memberSelector,\n\t\t\t\titems: menuItems,\n\t\t\t\tactionHandler: value => {\n\t\t\t\t\tmemberSelector.innerHTML = menuItems[value];\n\t\t\t\t\tonChange(parseInt(value));\n\t\t\t\t}\n\t\t\t});\n\t\t}\n\n\t\treturn Tag.render`\n\t\t\t<div class=\"sign-document-block-member-wrapper\">\n\t\t\t\t${memberSelector}\n\t\t\t</div>\n\t\t`;\n\t}\n\n\t/**\n\t * Returns resizing area's layout.\n\t * @return {HTMLElement}\n\t */\n\tstatic getResizeArea(): HTMLElement\n\t{\n\t\treturn Tag.render`\n\t\t\t<div class=\"sign-document__resize-area\">\n\t\t\t\t<div class=\"sign-area-resizable-controls\">\n\t\t\t\t\t<span class=\"sign-document__move-control\"></span>\n\t\t\t\t\t<div class=\"sign-document__resize-control --middle-top\"></div>\n\t\t\t\t\t<div class=\"sign-document__resize-control --right-top\"></div>\n\t\t\t\t\t<div class=\"sign-document__resize-control --middle-right\"></div>\n\t\t\t\t\t<div class=\"sign-document__resize-control --right-bottom\"></div>\n\t\t\t\t\t<div class=\"sign-document__resize-control --middle-bottom\"></div>\n\t\t\t\t\t<div class=\"sign-document__resize-control --left-bottom\"></div>\n\t\t\t\t\t<div class=\"sign-document__resize-control --middle-left\"></div>\n\t\t\t\t</div>\n\t\t\t</div>\n\t\t`;\n\t}\n\n\t/**\n\t * Returns style panel layout.\n\t * @return {HTMLElement}\n\t */\n\tstatic getStylePanel(\n\t\tactionHandler: (actionName: string, actionValue: string) => {},\n\t\tcollectStyles: {[key: string]: string},\n\t): HTMLElement\n\t{\n\t\t// font family selector\n\t\tconst fonts = {\n\t\t\t'\"Times New Roman\", Times':   '<span style=\"font-family: \\'Times New Roman\\', Times\">Times New Roman</span>',\n\t\t\t'\"Courier New\"':              '<span style=\"font-family: \\'Courier New\\'\">Courier New</span>',\n\t\t\t'Arial, Helvetica':           '<span style=\"font-family: Arial, Helvetica\">Arial / Helvetica</span>',\n\t\t\t'\"Arial Black\", Gadget':      '<span style=\"font-family: \\'Arial Black\\', Gadget\">Arial Black</span>',\n\t\t\t'Tahoma, Geneva':             '<span style=\"font-family: Tahoma, Geneva\">Tahoma / Geneva</span>',\n\t\t\t'Verdana':                    '<span style=\"font-family: Verdana\">Verdana</span>',\n\t\t\t'Georgia, serif':             '<span style=\"font-family: Georgia, serif\">Georgia</span>',\n\t\t\t'monospace':                  '<span style=\"font-family: monospace\">monospace</span>',\n\t\t};\n\t\tconst fontFamily = Tag.render`<div class=\"sign-document__block-style-btn --btn-font-family\">${fonts[collectStyles['font-family']] || 'Font'}</div>`;\n\t\tSignUI.bindSimpleMenu({\n\t\t\tbindElement: fontFamily,\n\t\t\titems: fonts,\n\t\t\tactionHandler: value => {\n\t\t\t\tfontFamily.innerHTML = fonts[value];\n\t\t\t\tactionHandler('family', value);\n\t\t\t}\n\t\t});\n\n\t\t// font size selector\n\t\t\n\t\tlet fontSizereal = parseInt(collectStyles['font-size']);\n\t\tlet fontSizeValue = 14;\n\t\t\n\t\tif (fontSizereal) \n\t\t{\n\t\t\tfontSizeValue = fontSizereal;\n\t\t}\n\n\t\tconst fontSize = Tag.render`<div class=\"sign-document__block-style-btn --btn-fontsize\">${fontSizeValue+ 'px' || '<i></i>'}</div>`;\n\t\tSignUI.bindSimpleMenu({\n\t\t\tbindElement: fontSize,\n\t\t\titems: [\n\t\t\t\t'6px', '7px', '8px', '9px', '10px', '11px', '12px', '13px', '14px', '15px', '16px',\n\t\t\t\t'18px', '20px', '22px', '24px', '26px', '28px', '36px', '48px', '72px'\n\t\t\t],\n\t\t\tactionHandler: value => {\n\t\t\t\tfontSize.innerHTML = parseInt(value) + 'px';\n\t\t\t\tactionHandler('size', value);\n\t\t\t},\n\t\t\tcurrentValue: fontSizeValue,\n\t\t});\n\n\t\t// color\n\t\tconst { layout: fontColor } = UI.getColorSelectorBtn(\n\t\t\tcollectStyles.color ?? '#000',\n\t\t\t(color) => actionHandler('color', color),\n\t\t);\n\n\t\treturn Tag.render`\n\t\t\t<div class=\"sign-document__block-style--panel\">\n<!--\t\t\t\t<div class=\"sign-document__block-style&#45;&#45;move-control\"></div>-->\n\t\t\t\t${fontFamily}\n\t\t\t\t${fontSize}\n\t\t\t\t${fontColor}\n\t\t\t\t<div class=\"sign-document__block-style--separator\"></div>\n\t\t\t\t<div class=\"sign-document__block-style-btn --btn-bold\" data-action=\"bold\"><i></i></div>\n\t\t\t\t<div class=\"sign-document__block-style-btn --btn-italic\" data-action=\"italic\"><i></i></div>\n\t\t\t\t<div class=\"sign-document__block-style-btn --btn-underline\" data-action=\"underline\"><i></i></div>\n\t\t\t\t<div class=\"sign-document__block-style-btn --btn-strike\" data-action=\"through\"><i></i></div>\n\t\t\t\t<div class=\"sign-document__block-style-btn --btn-align-left\" data-action=\"left\"><i></i></div>\n\t\t\t\t<div class=\"sign-document__block-style-btn --btn-align-center\" data-action=\"center\"><i></i></div>\n\t\t\t\t<div class=\"sign-document__block-style-btn --btn-align-right\" data-action=\"right\"><i></i></div>\n\t\t\t\t<div class=\"sign-document__block-style-btn --btn-align-justify\" data-action=\"justify\"><i></i></div>\n\t\t\t</div>\n\t\t`;\n\t}\n\n\tstatic getColorSelectorBtn(\n\t\tdefaultColorPickerColor: string,\n\t\tonColorSelect: (string) => any,\n\t\tcolorPickerOptions: ColorPickerOptions = {},\n\t): { layout: HTMLElement, colorPicker: BX.ColorPicker }\n\t{\n\t\tconst layout = Tag.render`<div class=\"sign-document__block-style-btn --btn-color\">\n\t\t\t\t<span class=\"sign-document__block-style-btn--color-block\"></span> \n\t\t\t\t<span>${Loc.getMessage('SIGN_JS_DOCUMENT_STYLE_COLOR')}</span>\n\t\t\t</div>`\n\t\t;\n\t\tUI.updateColorSelectorBtnColor(layout, defaultColorPickerColor);\n\t\tconst updatedColorPickerOptions = {\n\t\t\t...colorPickerOptions,\n\t\t\tbindElement: layout,\n\t\t\tonColorSelected:\n\t\t\t\t(color) => {\n\t\t\t\t\tonColorSelect(color);\n\t\t\t\t\tUI.updateColorSelectorBtnColor(layout, color);\n\t\t\t\t},\n\t\t};\n\n\t\tconst picker = new ColorPicker(updatedColorPickerOptions);\n\n\t\tEvent.bind(layout, 'click', () => {\n\t\t\tpicker.open();\n\t\t});\n\n\t\treturn { layout, colorPicker: picker };\n\t}\n\n\tstatic updateColorSelectorBtnColor(layout: HTMLElement, color: string): void\n\t{\n\t\tconst circleColor = layout.querySelector('.sign-document__block-style-btn--color-block');\n\t\tif (Type.isNil(circleColor))\n\t\t{\n\t\t\treturn;\n\t\t}\n\n\t\tDom.style(\n\t\t\tcircleColor,\n\t\t\t'background-color',\n\t\t\tcolor,\n\t\t);\n\t}\n}\n","import { Cache, Loc, Tag, Text as TextFormat } from 'main.core';\nimport UI from '../../../../document/src/ui';\nimport Block from './block';\nimport Dummy from './dummy';\n\nexport default class MySign extends Dummy\n{\n\tdataSrc: string;\n\n\t#cache = new Cache.MemoryCache();\n\t#defaultSignatureColor: string = '#0047ab';\n\t#availableSignatureColors: string = ['#000', this.#defaultSignatureColor, '#8b00ff'];\n\t#selectedSignatureColor: string | null = null;\n\n\t/**\n\t * Returns true if block is in singleton mode.\n\t * @return {boolean}\n\t */\n\tisSingleton(): boolean\n\t{\n\t\treturn true;\n\t}\n\n\t/**\n\t * Returns true if style panel mast be showed.\n\t * @return {boolean}\n\t */\n\tisStyleAllowed(): boolean\n\t{\n\t\treturn false;\n\t}\n\n\t/**\n\t * Returns initial dimension of block.\n\t * @return {width: number, height: number}\n\t */\n\tgetInitDimension(): { width: number, height: number }\n\t{\n\t\treturn {\n\t\t\twidth: 200,\n\t\t\theight: 70,\n\t\t};\n\t}\n\n\t/**\n\t * Returns type's content in view mode.\n\t * @return {HTMLElement | string}\n\t */\n\tgetViewContent(): HTMLElement | string\n\t{\n\t\tconst { width, height } = this.block.getPosition();\n\n\t\tlet src = null;\n\t\tif (this.dataSrc)\n\t\t{\n\t\t\tsrc = this.dataSrc;\n\t\t}\n\t\telse if (this.data.base64)\n\t\t{\n\t\t\tsrc = 'data:image;base64,' + this.data.base64;\n\t\t}\n\n\t\tif (src)\n\t\t{\n\t\t\treturn Tag.render`\n\t\t\t\t<img src=\"${src}\" alt=\"\">\n\t\t\t`;\n\t\t}\n\t\telse\n\t\t{\n\t\t\treturn Tag.render`\n\t\t\t\t<div class=\"sign-document__block-content_member-nodata\">\n\t\t\t\t\t${TextFormat.encode(this.data.text || this.getPlaceholderLabel())}\n\t\t\t\t</div>\n\t\t\t`;\n\t\t}\n\t}\n\n\t/**\n\t * Returns placeholder's label.\n\t * @return {string}\n\t */\n\tgetPlaceholderLabel(): string\n\t{\n\t\treturn Loc.getMessage('SIGN_JS_DOCUMENT_MEMBER_NO_DATA_MY_SIGN');\n\t}\n\n\t#getSignatureColor(): string\n\t{\n\t\treturn this.#selectedSignatureColor ?? this.#defaultSignatureColor;\n\t}\n\n\tonClickOut()\n\t{\n\t\tsuper.onClickOut();\n\t\tthis.#closeColorPickerPopup();\n\t}\n\n\t#closeColorPickerPopup()\n\t{\n\t\tconst { colorPicker } = this.#getColorSelectorBtn();\n\t\tcolorPicker.close();\n\t}\n\n\tonSave()\n\t{\n\t\tsuper.onSave();\n\t\tthis.#closeColorPickerPopup();\n\t}\n\n\tgetStyles(): { [styleName: string]: string }\n\t{\n\t\treturn { backgroundPosition: 'center !important', color: this.#getSignatureColor() };\n\t}\n\n\tchangeStyleColor(color: string, emitEvent: boolean = true): void\n\t{\n\t\tsuper.changeStyleColor(color);\n\t\tthis.#selectedSignatureColor = color;\n\n\t\tconst { layout, colorPicker } = this.#getColorSelectorBtn();\n\t\tUI.updateColorSelectorBtnColor(layout, color);\n\t\tcolorPicker.setSelectedColor(color);\n\n\t\tif (emitEvent)\n\t\t{\n\t\t\tthis.emit(this.events.onColorStyleChange);\n\t\t}\n\t}\n\n\t/**\n\t * @return {HTMLElement | null}\n\t */\n\tgetBlockCaption(): ?HTMLElement\n\t{\n\t\tconst { layout: colorSelectorBtnLayout } = this.#getColorSelectorBtn();\n\n\t\treturn Tag.render`\n\t\t\t<div style=\"display: flex; flex-direction: row;\">\n\t\t\t${colorSelectorBtnLayout}\n\t\t\t<div class=\"sign-document__block-style--separator\"></div>\n\t\t\t<div class=\"sign-document-block-member-wrapper\">\n\t\t\t\t<i>${Loc.getMessage('SIGN_JS_DOCUMENT_SIGN_ACTION_BUTTON')}</i>\n\t\t\t</div>\n\t\t\t</div>\n\t\t`;\n\t}\n\n\t#getColorSelectorBtn(): { layout: HTMLElement, colorPicker: BX.ColorPicker }\n\t{\n\t\treturn this.#cache.remember('colorSelectorBtn', () => UI.getColorSelectorBtn(\n\t\t\tthis.#selectedSignatureColor ?? this.#defaultSignatureColor,\n\t\t\t(color) => this.changeStyleColor(color),\n\t\t\t{\n\t\t\t\tcolors: [this.#availableSignatureColors],\n\t\t\t\tallowCustomColor: false,\n\t\t\t\tselectedColor: this.#selectedSignatureColor ?? this.#defaultSignatureColor,\n\t\t\t\tcolorPreview: false,\n\t\t\t},\n\t\t));\n\t}\n}\n","import { Loc, Tag, Text } from 'main.core';\nimport { Api } from 'sign.v2.api';\nimport { Uploader } from 'ui.stamp.uploader';\nimport Dummy from './dummy';\nimport Block from './block';\n\nexport default class MyStamp extends Dummy\n{\n\tstatic currentBlock: Block;\n\n\tdataSrc: string;\n\t#uploader: Uploader;\n\t#api: Api;\n\n\tconstructor(block: Block)\n\t{\n\t\tsuper(block);\n\n\t\tthis.#uploader = new Uploader({\n\t\t\tcontroller: {\n\t\t\t\tupload: 'sign.upload.stampUploadController',\n\t\t\t},\n\t\t\tcontact: {\n\t\t\t\tid: 0,\n\t\t\t\tlabel: 'Admin'\n\t\t\t},\n\t\t});\n\t\tthis.#uploader.subscribe('onSaveAsync', async (event) => {\n\t\t\tMyStamp.currentBlock.await(true);\n\t\t\tconst eventData = event.getData();\n\t\t\tif (!eventData?.file?.serverId)\n\t\t\t{\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\tthis.dataSrc = eventData.file.serverPreviewUrl;\n\t\t\tthis.#saveStamp(MyStamp.currentBlock, eventData.file.serverId);\n\t\t});\n\t\tthis.#api = new Api();\n\t}\n\n\t/**\n\t * Returns true if block is in singleton mode.\n\t * @return {boolean}\n\t */\n\tisSingleton(): boolean\n\t{\n\t\treturn true;\n\t}\n\n\t/**\n\t * Returns true if style panel mast be showed.\n\t * @return {boolean}\n\t */\n\tisStyleAllowed(): boolean\n\t{\n\t\treturn false;\n\t}\n\n\t/**\n\t * Returns initial dimension of block.\n\t * @return {width: number, height: number}\n\t */\n\tgetInitDimension(): {width: number, height: number}\n\t{\n\t\treturn {\n\t\t\twidth: 151,\n\t\t\theight: 151\n\t\t};\n\t}\n\n\t/**\n\t * Returns action button for edit content.\n\t * @return {HTMLElement}\n\t */\n\tgetActionButton(): HTMLElement\n\t{\n\t\treturn Tag.render`\n\t\t\t<div class=\"sign-document__block-style-btn --funnel\">\n\t\t\t\t<button onclick=\"${this.#onActionClick.bind(this)}\" data-role=\"action\">\n\t\t\t\t\t${Loc.getMessage('SIGN_JS_DOCUMENT_STAMP_ACTION_BUTTON')}\n\t\t\t\t</button>\n\t\t\t</div>\n\t\t`;\n\t}\n\n\t/**\n\t * Calls when action button was clicked.\n\t * @param {PointerEvent} event\n\t */\n\t#onActionClick(event: PointerEvent)\n\t{\n\t\tMyStamp.currentBlock = this.block;\n\t\tthis.#uploader.show();\n\t}\n\n\t/**\n\t * Saves stamp to backend.\n\t * @param {Block} block\n\t * @param {string} fileId\n\t */\n\tasync #saveStamp(block: Block, fileId: string): Promise\n\t{\n\t\tconst memberPart = block.getMemberPart();\n\t\tconst member = block.blocksManager.getMemberByPart(memberPart);\n\t\tawait this.#api.saveStamp(member.uid, fileId);\n\t\tblock.assign();\n\t}\n\n\t/**\n\t * Returns type's content in view mode.\n\t * @return {HTMLElement | string}\n\t */\n\tgetViewContent(): HTMLElement | string\n\t{\n\t\tlet src = null;\n\n\t\tif (this.data.__view?.base64)\n\t\t{\n\t\t\tsrc = 'data:image;base64,' + this.data.__view.base64;\n\t\t}\n\n\t\tif (src)\n\t\t{\n\t\t\treturn Tag.render`\n\t\t\t\t<div class=\"sign-document__block-content_stamp\" style=\"background-image: url(${src})\"></div>\n\t\t\t`;\n\t\t}\n\t\telse\n\t\t{\n\t\t\treturn Tag.render`\n\t\t\t\t<div class=\"sign-document__block-content_member-nodata --stamp\"></div>\n\t\t\t`;\n\t\t}\n\t}\n}\n","import { Loc, Tag, Text as TextFormat } from 'main.core';\nimport { Api } from 'sign.v2.api';\n\nimport Dummy from './dummy';\n\nexport default class Number extends Dummy\n{\n\tstatic sliderOnMessageBind: boolean = false;\n\n\t/**\n\t * Returns true if block is in singleton mode.\n\t * @return {boolean}\n\t */\n\tisSingleton(): boolean\n\t{\n\t\treturn true;\n\t}\n\n\t/**\n\t * Returns initial dimension of block.\n\t * @return {width: number, height: number}\n\t */\n\tgetInitDimension(): {width: number, height: number}\n\t{\n\t\treturn {\n\t\t\twidth: 100,\n\t\t\theight: 28\n\t\t};\n\t}\n\n\t/**\n\t * Calls when action button was clicked.\n\t * @param {PointerEvent} event\n\t */\n\t#onActionClick(event: PointerEvent)\n\t{\n\t\tevent.stopPropagation();\n\t\tif (!Number.sliderOnMessageBind)\n\t\t{\n\t\t\tNumber.sliderOnMessageBind = true;\n\n\t\t\tBX.addCustomEvent(window, 'SidePanel.Slider:onMessage', async (event) =>\n\t\t\t{\n\t\t\t\tconst isEditor = event.slider?.url === 'editor';\n\t\t\t\tif (isEditor && event.getEventId() === 'numerator-saved-event')\n\t\t\t\t{\n\t\t\t\t\tconst numeratorData = event.getData();\n\t\t\t\t\tconst currentBlock = event?.sender?.options?.data?.block ?? this.block;\n\n\t\t\t\t\tif (numeratorData.type === 'CRM_SMART_DOCUMENT')\n\t\t\t\t\t{\n\t\t\t\t\t\tcurrentBlock.await(true);\n\t\t\t\t\t\tconst api = new Api();\n\t\t\t\t\t\tconst uid = currentBlock.blocksManager.getDocumentUid();\n\t\t\t\t\t\tawait api.refreshEntityNumber(uid);\n\t\t\t\t\t\tcurrentBlock.assign();\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t});\n\t\t}\n\n\t\tconst { crmNumeratorUrl } = this.data.__view;\n\t\tBX.SidePanel.Instance.open(crmNumeratorUrl, {\n\t\t\twidth: 480,\n\t\t\tcacheable: false,\n\t\t\tdata: {\n\t\t\t\tblock: this.block\n\t\t\t}\n\t\t});\n\t}\n\n\t/**\n\t * Returns action button for edit content.\n\t * @return {HTMLElement | null}\n\t */\n\tgetActionButton(): ?HTMLElement\n\t{\n\t\treturn Tag.render`\n\t\t\t<div class=\"sign-document__block-style-btn --funnel\">\n\t\t\t\t<button onclick=\"${this.#onActionClick.bind(this)}\" data-role=\"action\">\n\t\t\t\t\t${Loc.getMessage('SIGN_JS_DOCUMENT_NUMBER_ACTION_EDIT')}\n\t\t\t\t</button>\n\t\t\t</div>\n\t\t`;\n\t}\n\n\t/**\n\t * Returns type's content in view mode.\n\t * @return {HTMLElement | string}\n\t */\n\tgetViewContent(): HTMLElement | string\n\t{\n\t\treturn Tag.render`\n\t\t\t<div class=\"sign-document__block-number\">\n\t\t\t\t${TextFormat.encode(this.data.text || '').toString()}\n\t\t\t</div>\n\t\t`;\n\t}\n\n\tgetStyles(): { [p: string]: string }\n\t{\n\t\treturn { ...super.getStyles(), ...Number.defaultTextBlockPaddingStyles };\n\t}\n}\n","import { Cache, Loc, Tag, Text as TextFormat, Type, Dom } from 'main.core';\nimport Dummy from './dummy';\nimport { Selector } from \"crm.form.fields.selector\";\n\nexport default class Reference extends Dummy\n{\n\t#cache = new Cache.MemoryCache();\n\t#field: string;\n\t#actionButton: HTMLElement;\n\n\t/**\n\t * Sets new data.\n\t * @param {any} data\n\t */\n\tsetData(data: any)\n\t{\n\t\tthis.data = data ? data : {};\n\t\tthis.#field = this.data.field ?? '';\n\t}\n\n\t/**\n\t * Calls when block has placed on document.\n\t */\n\tonPlaced()\n\t{\n\t\tthis.#onActionClick();\n\t}\n\n\t/**\n\t * Calls when action button was clicked.\n\t */\n\t#onActionClick()\n\t{\n\t\tthis.#getCrmFieldSelectorPanel()\n\t\t\t.show()\n\t\t\t.then((selectedName: Array<string>) => {\n\t\t\t\tif (selectedName.length === 0)\n\t\t\t\t{\n\t\t\t\t\treturn;\n\t\t\t\t}\n\n\t\t\t\tDom.removeClass(this.block.getLayout(), '--invalid');\n\t\t\t\tthis.#field = selectedName[0];\n\t\t\t\tthis.setData({\n\t\t\t\t\tfield: this.#field,\n\t\t\t\t});\n\t\t\t\tsetTimeout(() => {\n\t\t\t\t\tthis.block.assign();\n\t\t\t\t}, 0);\n\t\t\t});\n\t}\n\n\t/**\n\t * Returns action button for edit content.\n\t * @return {HTMLElement | null}\n\t */\n\tgetActionButton(): ?HTMLElement\n\t{\n\t\tif (Type.isUndefined(Selector))\n\t\t{\n\t\t\treturn null;\n\t\t}\n\n\t\tthis.#actionButton = Tag.render`\n\t\t\t<div class=\"sign-document__block-style-btn --funnel\">\n\t\t\t\t<button onclick=\"${this.#onActionClick.bind(this)}\" data-role=\"action\">\n\t\t\t\t</button>\n\t\t\t</div>\n\t\t`;\n\n\t\tthis.#setActionButtonLabel();\n\n\t\treturn this.#actionButton;\n\t}\n\n\t/**\n\t * Sets label to action button.\n\t */\n\t#setActionButtonLabel()\n\t{\n\t\tif (!this.#actionButton)\n\t\t{\n\t\t\treturn;\n\t\t}\n\n\t\tconst actionButton = this.#actionButton.querySelector('button');\n\t\tconst defaultCaption = Loc.getMessage('SIGN_JS_DOCUMENT_REFERENCE_ACTION_BUTTON');\n\t\tif (!this.#field)\n\t\t{\n\t\t\tactionButton.textContent = defaultCaption;\n\t\t\treturn;\n\t\t}\n\n\t\tconst fieldSelector = this.#cache.get('fieldSelector') ?? this.#getCrmFieldSelectorPanel();\n\t\tconst fieldsList = fieldSelector.getFieldsList();\n\t\tconst fields = [\n\t\t\t...fieldsList?.CONTACT?.FIELDS ?? [],\n\t\t\t...fieldsList?.SMART_DOCUMENT?.FIELDS ?? [],\n\t\t];\n\t\tconst field = fields.find((field) => field.name === this.#field);\n\t\tconst caption = field ? field.caption : defaultCaption;\n\t\tactionButton.textContent = caption;\n\t}\n\n\t/**\n\t * Returns type's content in view mode.\n\t * @return {HTMLElement | string}\n\t */\n\tgetViewContent(): HTMLElement | string\n\t{\n\t\tthis.#setActionButtonLabel();\n\n\t\tconst { width, height } = this.block.getPosition();\n\n\t\tif (this.data.src)\n\t\t{\n\t\t\treturn Tag.render`\n\t\t\t\t<div style=\"width: ${width - 14}px; height: ${height - 14}px; background: url(${this.data.src}) no-repeat top; background-size: cover;\">\n\t\t\t\t</div>\n\t\t\t`;\n\t\t}\n\t\telse\n\t\t{\n\t\t\tconst className = !this.data.text ? 'sign-document__block-content_member-nodata' : '';\n\n\t\t\treturn Tag.render`\n\t\t\t\t<div class=\"${className}\">\n\t\t\t\t\t${TextFormat.encode(this.data.text || Loc.getMessage('SIGN_JS_DOCUMENT_MEMBER_NO_DATA'))}\n\t\t\t\t</div>\n\t\t\t`;\n\t\t}\n\t}\n\n\t#getCrmFieldSelectorPanel(): Selector\n\t{\n\t\tconst blocksManager = this.block.blocksManager;\n\t\tconst member = blocksManager.getMemberByPart(this.block.getMemberPart());\n\n\t\tconst { presetId } = member;\n\n\t\treturn this.#cache.remember('fieldSelector', () => new Selector({\n\t\t\tmultiple: false,\n\t\t\tcontrollerOptions: {\n\t\t\t\thideVirtual: 1,\n\t\t\t\thideRequisites: 1,\n\t\t\t\thideSmartDocument: 1,\n\t\t\t\tpresetId,\n\t\t\t},\n\t\t\tpresetId,\n\t\t\tfilter: {\n\t\t\t\t'+categories': [\n\t\t\t\t\t'CONTACT',\n\t\t\t\t\t'SMART_DOCUMENT',\n\t\t\t\t],\n\t\t\t\t'+fields': [\n\t\t\t\t\t'list',\n\t\t\t\t\t'string',\n\t\t\t\t\t'date',\n\t\t\t\t\t'typed_string',\n\t\t\t\t\t'text',\n\t\t\t\t\t'datetime',\n\t\t\t\t\t'enumeration',\n\t\t\t\t\t'address',\n\t\t\t\t\t'url',\n\t\t\t\t\t'money',\n\t\t\t\t\t'boolean',\n\t\t\t\t\t'double',\n\t\t\t\t\t'integer',\n\t\t\t\t],\n\t\t\t},\n\t\t}));\n\t}\n\n\tgetStyles(): { [p: string]: string }\n\t{\n\t\treturn { ...super.getStyles(), ...Reference.defaultTextBlockPaddingStyles };\n\t}\n}\n","import { Cache, Loc, Tag, Text as TextFormat, Type, Dom } from 'main.core';\nimport Dummy from './dummy';\nimport { Selector } from 'crm.form.fields.selector';\n\nexport default class MyReference extends Dummy\n{\n\t#field: string;\n\t#actionButton: HTMLElement;\n\t#cache = new Cache.MemoryCache();\n\n\t/**\n\t * Sets new data.\n\t * @param {any} data\n\t */\n\tsetData(data: any)\n\t{\n\t\tthis.data = data ? data : {};\n\t\tthis.#field = this.data.field ?? '';\n\t}\n\n\t/**\n\t * Calls when block has placed on document.\n\t */\n\tonPlaced()\n\t{\n\t\tthis.#onActionClick();\n\t}\n\n\t/**\n\t * Calls when action button was clicked.\n\t */\n\t#onActionClick()\n\t{\n\t\tthis.#getCrmFieldSelectorPanel()\n\t\t\t.show()\n\t\t\t.then((selectedName: Array<string>) => {\n\t\t\t\tif (selectedName.length === 0)\n\t\t\t\t{\n\t\t\t\t\treturn;\n\t\t\t\t}\n\n\t\t\t\tDom.removeClass(this.block.getLayout(), '--invalid');\n\t\t\t\tthis.#field = selectedName[0];\n\t\t\t\tthis.setData({\n\t\t\t\t\tfield: this.#field,\n\t\t\t\t});\n\t\t\t\tsetTimeout(() => {\n\t\t\t\t\tthis.block.assign();\n\t\t\t\t}, 0);\n\t\t\t});\n\t}\n\n\t/**\n\t * Returns action button for edit content.\n\t * @return {HTMLElement | null}\n\t */\n\tgetActionButton(): ?HTMLElement\n\t{\n\t\tif (Type.isUndefined(Selector))\n\t\t{\n\t\t\treturn null;\n\t\t}\n\n\t\tthis.#actionButton = Tag.render`\n\t\t\t<div class=\"sign-document__block-style-btn --funnel\">\n\t\t\t\t<button onclick=\"${this.#onActionClick.bind(this)}\" data-role=\"action\">\n\t\t\t\t</button>\n\t\t\t</div>\n\t\t`;\n\n\t\tthis.#setActionButtonLabel();\n\n\t\treturn this.#actionButton;\n\t}\n\n\t/**\n\t * Sets label to action button.\n\t */\n\t#setActionButtonLabel()\n\t{\n\t\tif (!this.#actionButton)\n\t\t{\n\t\t\treturn;\n\t\t}\n\n\t\tconst actionButton = this.#actionButton.querySelector('button');\n\t\tconst defaultCaption = Loc.getMessage('SIGN_JS_DOCUMENT_REFERENCE_ACTION_BUTTON');\n\t\tif (!this.#field)\n\t\t{\n\t\t\tactionButton.textContent = defaultCaption;\n\t\t\treturn;\n\t\t}\n\n\t\tconst fieldSelector = this.#cache.get('fieldSelector') ?? this.#getCrmFieldSelectorPanel();\n\t\tconst fieldsList = fieldSelector.getFieldsList();\n\t\tconst fields = [\n\t\t\t...fieldsList?.COMPANY?.FIELDS ?? [],\n\t\t\t...fieldsList?.SMART_DOCUMENT?.FIELDS ?? []\n\t\t];\n\t\tconst field = fields.find((field) => field.name === this.#field);\n\t\tconst caption = field ? field.caption : defaultCaption;\n\t\tactionButton.textContent = caption;\n\t}\n\n\t/**\n\t * Returns type's content in view mode.\n\t * @return {HTMLElement | string}\n\t */\n\tgetViewContent(): HTMLElement | string\n\t{\n\t\tthis.#setActionButtonLabel();\n\n\t\tconst { width, height } = this.block.getPosition();\n\n\t\tif (this.data.src)\n\t\t{\n\t\t\treturn Tag.render`\n\t\t\t\t<div style=\"width: ${width - 14}px; height: ${height - 14}px; background: url(${this.data.src}) no-repeat top; background-size: cover;\">\n\t\t\t\t</div>\n\t\t\t`;\n\t\t}\n\t\telse\n\t\t{\n\t\t\tconst className = !this.data.text ? 'sign-document__block-content_member-nodata' : '';\n\n\t\t\treturn Tag.render`\n\t\t\t\t<div class=\"${className}\">\n\t\t\t\t\t${TextFormat.encode(this.data.text || Loc.getMessage('SIGN_JS_DOCUMENT_MEMBER_NO_DATA_MY_BLOCKS'))}\n\t\t\t\t</div>\n\t\t\t`;\n\t\t}\n\t}\n\n\t#getCrmFieldSelectorPanel(): Selector\n\t{\n\t\tconst blocksManager = this.block.blocksManager;\n\t\tconst member = blocksManager.getMemberByPart(this.block.getMemberPart());\n\t\tconst { presetId } = member;\n\n\t\treturn this.#cache.remember('fieldSelector', () => new Selector({\n\t\t\tmultiple: false,\n\t\t\tcontrollerOptions: {\n\t\t\t\thideVirtual: 1,\n\t\t\t\thideRequisites: 1,\n\t\t\t\thideSmartDocument: 1,\n\t\t\t\tpresetId,\n\t\t\t},\n\t\t\tpresetId,\n\t\t\tfilter: {\n\t\t\t\t'+categories': [\n\t\t\t\t\t'COMPANY',\n\t\t\t\t\t'SMART_DOCUMENT',\n\t\t\t\t],\n\t\t\t\t'+fields': [\n\t\t\t\t\t'list',\n\t\t\t\t\t'string',\n\t\t\t\t\t'date',\n\t\t\t\t\t'typed_string',\n\t\t\t\t\t'text',\n\t\t\t\t\t'datetime',\n\t\t\t\t\t'enumeration',\n\t\t\t\t\t'address',\n\t\t\t\t\t'url',\n\t\t\t\t\t'money',\n\t\t\t\t\t'boolean',\n\t\t\t\t\t'double',\n\t\t\t\t\t'integer',\n\t\t\t\t],\n\t\t\t\t'-fields': [\n\t\t\t\t\tthis.#getFieldNegativeFilter()\n\t\t\t\t]\n\t\t\t},\n\t\t}));\n\t}\n\n\t#getFieldNegativeFilter(): (Object) => boolean\n\t{\n\t\tconst blackList = this.#getFieldsNameBlackList();\n\t\treturn (field) => {\n\t\t\treturn blackList.some((blankListFieldName) => field.name === blankListFieldName)\n\t\t}\n\t}\n\n\t#getFieldsNameBlackList(): Array<string>\n\t{\n\t\treturn [\n\t\t\t'COMPANY_LINK',\n\t\t\t'COMPANY_REG_ADDRESS',\n\t\t\t'COMPANY_ORIGIN_VERSION'\n\t\t];\n\t}\n\n\tgetStyles(): { [p: string]: string }\n\t{\n\t\treturn { ...super.getStyles(), ...MyReference.defaultTextBlockPaddingStyles };\n\t}\n}\n","import { FieldsetViewer } from 'crm.requisite.fieldset-viewer';\nimport { Loc, Tag, Text as TextFormat } from 'main.core';\n\nimport Dummy from './dummy';\n\nexport default class Requisites extends Dummy\n{\n\t/**\n\t * Returns true if block is in singleton mode.\n\t * @return {boolean}\n\t */\n\tisSingleton(): boolean\n\t{\n\t\treturn true;\n\t}\n\n\t/**\n\t * Returns initial dimension of block.\n\t * @return {width: number, height: number}\n\t */\n\tgetInitDimension(): { width: number, height: number }\n\t{\n\t\treturn {\n\t\t\twidth: 250,\n\t\t\theight: 220,\n\t\t};\n\t}\n\n\t/**\n\t * Calls when action button was clicked.\n\t * @param {PointerEvent} event\n\t */\n\t#onActionClick(event: PointerEvent)\n\t{\n\t\tconst blocksManager = this.block.blocksManager;\n\t\tconst config = blocksManager.getConfig();\n\t\tconst member = blocksManager.getMemberByPart(this.block.getMemberPart());\n\n\t\tevent.stopPropagation();\n\n\t\tif (!member)\n\t\t{\n\t\t\treturn;\n\t\t}\n\n\t\tconst { cid, entityTypeId, presetId } = member;\n\t\t(new FieldsetViewer({\n\t\t\tentityTypeId,\n\t\t\tentityId: cid,\n\t\t\tevents: {\n\t\t\t\tonClose: () => {\n\t\t\t\t\tthis.block.assign();\n\t\t\t\t},\n\t\t\t},\n\t\t\tfieldListEditorOptions: {\n\t\t\t\tfieldsPanelOptions: {\n\t\t\t\t\tfilter: {\n\t\t\t\t\t\t'+categories': [\n\t\t\t\t\t\t\t'CONTACT',\n\t\t\t\t\t\t],\n\t\t\t\t\t\t'+fields': [\n\t\t\t\t\t\t\t'list',\n\t\t\t\t\t\t\t'string',\n\t\t\t\t\t\t\t'date',\n\t\t\t\t\t\t\t'typed_string',\n\t\t\t\t\t\t\t'text',\n\t\t\t\t\t\t\t'datetime',\n\t\t\t\t\t\t\t'enumeration',\n\t\t\t\t\t\t\t'address',\n\t\t\t\t\t\t\t'url',\n\t\t\t\t\t\t\t'money',\n\t\t\t\t\t\t\t'boolean',\n\t\t\t\t\t\t\t'double',\n\t\t\t\t\t\t\t'integer',\n\t\t\t\t\t\t],\n\t\t\t\t\t},\n\t\t\t\t\tpresetId,\n\t\t\t\t\tcontrollerOptions: {\n\t\t\t\t\t\thideVirtual: 1,\n\t\t\t\t\t\thideRequisites: 0,\n\t\t\t\t\t\thideSmartDocument: 1,\n\t\t\t\t\t\tpresetId,\n\t\t\t\t\t},\n\t\t\t\t},\n\t\t\t},\n\t\t}))\n\t\t\t.show()\n\t\t;\n\t}\n\n\t/**\n\t * Returns action button for edit content.\n\t * @return {HTMLElement}\n\t */\n\tgetActionButton(): HTMLElement\n\t{\n\t\treturn Tag.render`\n\t\t\t<div class=\"sign-document__block-style-btn --funnel\">\n\t\t\t\t<button onclick=\"${this.#onActionClick.bind(this)}\" data-role=\"action\" data-id=\"action-${this.block.getCode()}\">\n\t\t\t\t\t${Loc.getMessage('SIGN_JS_DOCUMENT_REQUISITES_ACTION_BUTTON')}\n\t\t\t\t</button>\n\t\t\t</div>\n\t\t`;\n\t}\n\n\t/**\n\t * Returns type's content in view mode.\n\t * @return {HTMLElement | string}\n\t */\n\tgetViewContent(): HTMLElement | string\n\t{\n\t\tconst text = this.data.text || Loc.getMessage('SIGN_JS_DOCUMENT_MEMBER_NO_DATA_REQUISITES');\n\t\tconst tagBody = this.data.text ? '' : ' class=\"sign-document__block-content_member-nodata\"';\n\n\t\treturn Tag.render`\n\t\t\t<div${tagBody}>\n\t\t\t\t${TextFormat.encode(text).toString().replaceAll('[br]', '<br>')}\n\t\t\t</div>\n\t\t`;\n\t}\n\n\tgetStyles(): { [p: string]: string }\n\t{\n\t\treturn { ...super.getStyles(), ...Requisites.defaultTextBlockPaddingStyles };\n\t}\n}\n","import { Loc, Tag, Text as TextFormat } from 'main.core';\nimport Dummy from './dummy';\n\nexport default class Stamp extends Dummy\n{\n\t/**\n\t * Returns true if style panel mast be showed.\n\t * @return {boolean}\n\t */\n\tisStyleAllowed(): boolean\n\t{\n\t\treturn false;\n\t}\n\n\t/**\n\t * Returns initial dimension of block.\n\t * @return {width: number, height: number}\n\t */\n\tgetInitDimension(): {width: number, height: number}\n\t{\n\t\treturn {\n\t\t\twidth: 151,\n\t\t\theight: 151\n\t\t};\n\t}\n\n\t/**\n\t * Returns placeholder's label.\n\t * @return {string}\n\t */\n\tgetPlaceholderLabel(): string\n\t{\n\t\treturn Loc.getMessage('SIGN_JS_DOCUMENT_MEMBER_NO_DATA_STAMP');\n\t}\n\n\t/**\n\t * Returns type's content in view mode.\n\t * @return {HTMLElement | string}\n\t */\n\tgetViewContent(): HTMLElement | string\n\t{\n\t\tconst {width, height} = this.block.getPosition();\n\n\t\tif (this.data.base64)\n\t\t{\n\t\t\treturn Tag.render`\n\t\t\t\t<div class=\"sign-document__block-content_stamp\" style=\"background-image: url(${src})\"></div>\n\t\t\t`;\n\t\t}\n\t\telse\n\t\t{\n\t\t\treturn Tag.render`\n\t\t\t\t<div class=\"sign-document__block-content_member-nodata\">\n\t\t\t\t\t\n\t\t\t\t</div>\n\t\t\t`;\n\t\t}\n\t}\n}\n","import { Cache, Loc, Tag, Text as TextFormat } from 'main.core';\nimport UI from '../../../../document/src/ui';\nimport Stamp from './stamp';\n\nexport default class Sign extends Stamp\n{\n\t#cache = new Cache.MemoryCache();\n\t#defaultSignatureColor: string = '#0047ab';\n\t#availableSignatureColors: string = ['#000', this.#defaultSignatureColor, '#8b00ff'];\n\t#selectedSignatureColor: string | null = null;\n\n\t/**\n\t * Returns placeholder's label.\n\t * @return {string}\n\t */\n\tgetPlaceholderLabel(): string\n\t{\n\t\treturn Loc.getMessage('SIGN_JS_DOCUMENT_MEMBER_NO_DATA_SIGN');\n\t}\n\n\t/**\n\t * Returns initial dimension of block.\n\t * @return {width: number, height: number}\n\t */\n\tgetInitDimension(): { width: number, height: number }\n\t{\n\t\treturn {\n\t\t\twidth: 200,\n\t\t\theight: 70,\n\t\t};\n\t}\n\n\tgetBlockCaption(): ?HTMLElement\n\t{\n\t\tconst { layout: colorSelectorBtnLayout } = this.#getColorSelectorBtn();\n\n\t\treturn Tag.render`\n\t\t\t<div style=\"display: flex; flex-direction: row;\">\n\t\t\t${colorSelectorBtnLayout}\n\t\t\t<div class=\"sign-document__block-style--separator\"></div>\n\t\t\t</div>\n\t\t`;\n\t}\n\n\t/**\n\t * Returns type's content in view mode.\n\t * @return {HTMLElement | string}\n\t */\n\tgetViewContent(): HTMLElement | string\n\t{\n\t\treturn Tag.render`\n\t\t\t<div class=\"sign-document__block-content_member-nodata\">\n\t\t\t\t${TextFormat.encode(this.getPlaceholderLabel())}\n\t\t\t</div>\n\t\t`;\n\t}\n\n\tgetStyles(): { [styleName: string]: string }\n\t{\n\t\treturn { backgroundPosition: 'center !important', color: this.#getSignatureColor() };\n\t}\n\n\tupdateColor(color: string)\n\t{\n\t\tsuper.updateColor(color);\n\t\tconst { layout, colorPicker } = this.#getColorSelectorBtn();\n\t\tthis.#selectedSignatureColor = color;\n\n\t\tUI.updateColorSelectorBtnColor(layout, color);\n\t\tcolorPicker.setSelectedColor(color);\n\t}\n\n\tchangeStyleColor(color: string, emitEvent: boolean = true): void\n\t{\n\t\tsuper.changeStyleColor(color);\n\t\tthis.#selectedSignatureColor = color;\n\n\t\tconst { layout, colorPicker } = this.#getColorSelectorBtn();\n\t\tUI.updateColorSelectorBtnColor(layout, color);\n\t\tcolorPicker.setSelectedColor(color);\n\n\t\tif (emitEvent)\n\t\t{\n\t\t\tthis.emit(this.events.onColorStyleChange);\n\t\t}\n\t}\n\n\t#getColorSelectorBtn(): { layout: HTMLElement, colorPicker: BX.ColorPicker }\n\t{\n\t\treturn this.#cache.remember('colorSelectorBtn', () => UI.getColorSelectorBtn(\n\t\t\tthis.#selectedSignatureColor ?? this.#defaultSignatureColor,\n\t\t\t(color) => this.changeStyleColor(color),\n\t\t\t{\n\t\t\t\tcolors: [this.#availableSignatureColors],\n\t\t\t\tallowCustomColor: false,\n\t\t\t\tselectedColor: this.#selectedSignatureColor ?? this.#defaultSignatureColor,\n\t\t\t\tcolorPreview: false,\n\t\t\t},\n\t\t));\n\t}\n\n\t#getSignatureColor(): string\n\t{\n\t\treturn this.#selectedSignatureColor ?? this.#defaultSignatureColor;\n\t}\n\n\tonSave()\n\t{\n\t\tsuper.onSave();\n\t\tthis.#closeColorPickerPopup();\n\t}\n\n\tonClickOut()\n\t{\n\t\tsuper.onClickOut();\n\t\tthis.#closeColorPickerPopup();\n\t}\n\n\t#closeColorPickerPopup()\n\t{\n\t\tconst { colorPicker } = this.#getColorSelectorBtn();\n\t\tcolorPicker.close();\n\t}\n}\n","import { Event, Loc, Tag, Text as TextFormat } from 'main.core';\nimport Dummy from './dummy';\nimport Block from './block';\n\nexport default class Text extends Dummy\n{\n\t#textContainer: HTMLElement;\n\n\tconstructor(block: Block)\n\t{\n\t\tsuper(block);\n\t\tthis.setEventNamespace('BX.Sign.V2.Blocks.Text');\n\t}\n\n\t/**\n\t * Calls when action button was clicked.\n\t */\n\tonActionClick()\n\t{\n\t\tthis.#textContainer.contentEditable = true;\n\t\tthis.#textContainer.focus();\n\t}\n\n\t/**\n\t * Calls when typing in text container.\n\t */\n\t#onKeyUp(event): void\n\t{\n\t\tthis.setText(this.#textContainer.innerText.replaceAll(\"\\n\", '[br]'));\n\t\tthis.onChange();\n\t}\n\n\tgetText(): string\n\t{\n\t\treturn this.data.text;\n\t}\n\n\tgetContainer(): HTMLElement\n\t{\n\t\treturn this.#textContainer;\n\t}\n\n\t/**\n\t * Returns type's content in view mode.\n\t * @return {HTMLElement}\n\t */\n\tgetViewContent(): HTMLElement\n\t{\n\t\tconst content = this.data.text === Loc.getMessage('SIGN_JS_DOCUMENT_TEXT_PLACEHOLDER')\n\t\t\t? ''\n\t\t\t: this.data.text\n\t\t;\n\n\t\tthis.#textContainer = Tag.render`\n\t\t\t<div class=\"sign-document-block-text\" placeholder=\"${Loc.getMessage('SIGN_JS_DOCUMENT_TEXT_PLACEHOLDER')}\">\n\t\t\t\t${TextFormat.encode(content).replaceAll('[br]', '<br>')}\n\t\t\t</div>\n\t\t`;\n\n\t\tEvent.bind(this.#textContainer, 'keyup', this.#onKeyUp.bind(this));\n\t\tEvent.bind(this.#textContainer, 'paste', event => setTimeout(this.#onPaste.bind(this, event)));\n\n\t\treturn this.#textContainer;\n\t}\n\n\t#onPaste(event: ClipboardEvent): void\n\t{\n\t\tthis.#textContainer.innerHTML = this.#textContainer.innerText.replaceAll('\\n', '<br>');\n\n\t\tconst range = document.createRange();\n\t\trange.selectNodeContents(this.#textContainer);\n\t\trange.collapse(false)\n\n\t\tconst selection = document.getSelection();\n\t\tselection.removeAllRanges();\n\t\tselection.addRange(range);\n\n\t\tthis.setText(\n\t\t\tthis.#textContainer\n\t\t\t\t.innerHTML\n\t\t\t\t.replaceAll('<br>', '[br]'),\n\t\t);\n\t\tthis.onChange();\n\t}\n\n\tgetStyles(): { [p: string]: string }\n\t{\n\t\treturn { ...super.getStyles(), ...Text.defaultTextBlockPaddingStyles };\n\t}\n}","import { Dom, Event, Loc, Tag, Text as TextFormat, Reflection, Type } from 'main.core';\nimport { UI as SignUI } from 'sign.ui';\nimport { ColorPickerOptions } from '../../../../document/src/ui';\nimport { MemberItem } from '../types/document';\nimport '../style.css';\nimport 'color_picker';\n\ntype BlockLayoutOptions = {\n\tonRemove: () => {},\n\tonSave: () => {}\n};\n\nconst ColorPicker = Reflection.getClass('BX.ColorPicker');\n\nexport default class UI\n{\n\t/**\n\t * Sets width/height/top/left to element.\n\t * @param {HTMLElement} element\n\t * @param {{[key: string]: number}} rect\n\t */\n\tstatic setRect(element: HTMLElement, rect: {[key: string]: number})\n\t{\n\t\tObject.keys(rect).map(key => {\n\t\t\trect[key] = parseInt(rect[key]) + 'px';\n\t\t});\n\t\tDom.style(element, rect);\n\t}\n\n\t/**\n\t * Returns block's layout.\n\t * @param {BlockLayoutOptions} options Layout options.\n\t * @return {HTMLElement}\n\t */\n\tstatic getBlockLayout(options: BlockLayoutOptions): HTMLElement\n\t{\n\t\treturn Tag.render`\n\t\t\t<div class=\"sign-document__block-wrapper\">\n\t\t\t\t<div class=\"sign-document__block-panel--wrapper\" data-role=\"sign-block__actions\">\n\t\t\t\t</div>\n\t\t\t\t<div class=\"sign-document__block-content\">\n\t\t\t\t</div>\n\t\t\t\t<div class=\"sign-document__block-actions\">\n\t\t\t\t\t<div class=\"sign-document__block-actions--wrapper\">\n\t\t\t\t\t\t<button class=\"sign-document__block-actions-btn --remove sign-block-action-remove\" data-role=\"removeAction\" onclick=\"${options.onRemove}\"></button>\n\t\t\t\t\t\t<button class=\"sign-document__block-actions-btn --save sign-block-action-save\" data-role=\"saveAction\" onclick=\"${options.onSave}\"></button>\n\t\t\t\t\t</div>\n\t\t\t\t</div>\n\t\t\t</div>\n\t\t`;\n\t}\n\n\t/**\n\t * Returns member selector for block.\n\t * @param {Array<MemberItem>} members All document's members.\n\t * @param {number} selectedValue Selected member.\n\t * @param {() => {}} onChange Handler on change value.\n\t * @return {HTMLElement}\n\t */\n\tstatic getMemberSelector(members: Array<MemberItem>, selectedValue: number,  onChange: () => {}): HTMLElement\n\t{\n\t\tconst menuItems = {};\n\t\tlet selectedName = Loc.getMessage('SIGN_JS_DOCUMENT_MEMBER_NAME_NOT_SET');\n\n\t\tmembers.map(member => {\n\t\t\tmember.name = member.name || Loc.getMessage('SIGN_JS_DOCUMENT_MEMBER_NAME_NOT_SET');\n\t\t\tmenuItems[member.part] = member.name;\n\n\t\t\tif (member.part === selectedValue)\n\t\t\t{\n\t\t\t\tselectedName = member.name;\n\t\t\t}\n\t\t});\n\n\t\tconst memberSelector = (members.length > 1)\n\t\t\t? Tag.render`<span>${TextFormat.encode(selectedName)}</span>`\n\t\t\t: Tag.render`<i>${TextFormat.encode(selectedName)}</i>`;\n\n\t\tif (members.length > 1)\n\t\t{\n\t\t\tSignUI.bindSimpleMenu({\n\t\t\t\tbindElement: memberSelector,\n\t\t\t\titems: menuItems,\n\t\t\t\tactionHandler: value => {\n\t\t\t\t\tmemberSelector.innerHTML = menuItems[value];\n\t\t\t\t\tonChange(parseInt(value));\n\t\t\t\t}\n\t\t\t});\n\t\t}\n\n\t\treturn Tag.render`\n\t\t\t<div class=\"sign-document-block-member-wrapper\">\n\t\t\t\t${memberSelector}\n\t\t\t</div>\n\t\t`;\n\t}\n\n\t/**\n\t * Returns resizing area's layout.\n\t * @return {HTMLElement}\n\t */\n\tstatic getResizeArea(): HTMLElement\n\t{\n\t\treturn Tag.render`\n\t\t\t<div class=\"sign-document__resize-area\">\n\t\t\t\t<div class=\"sign-area-resizable-controls\">\n\t\t\t\t\t<span class=\"sign-document__move-control\"></span>\n\t\t\t\t\t<div class=\"sign-document__resize-control --middle-top\"></div>\n\t\t\t\t\t<div class=\"sign-document__resize-control --right-top\"></div>\n\t\t\t\t\t<div class=\"sign-document__resize-control --middle-right\"></div>\n\t\t\t\t\t<div class=\"sign-document__resize-control --right-bottom\"></div>\n\t\t\t\t\t<div class=\"sign-document__resize-control --middle-bottom\"></div>\n\t\t\t\t\t<div class=\"sign-document__resize-control --left-bottom\"></div>\n\t\t\t\t\t<div class=\"sign-document__resize-control --middle-left\"></div>\n\t\t\t\t</div>\n\t\t\t</div>\n\t\t`;\n\t}\n\n\t/**\n\t * Returns style panel layout.\n\t * @return {HTMLElement}\n\t */\n\tstatic getStylePanel(\n\t\tactionHandler: (actionName: string, actionValue: string) => {},\n\t\tcollectStyles: {[key: string]: string}\n\t): HTMLElement\n\t{\n\t\t// font family selector\n\t\tconst fonts = {\n\t\t\t'\"Times New Roman\", Times':   '<span style=\"font-family: \\'Times New Roman\\', Times\">Times New Roman</span>',\n\t\t\t'\"Courier New\"':              '<span style=\"font-family: \\'Courier New\\'\">Courier New</span>',\n\t\t\t'Arial, Helvetica':           '<span style=\"font-family: Arial, Helvetica\">Arial / Helvetica</span>',\n\t\t\t'\"Arial Black\", Gadget':      '<span style=\"font-family: \\'Arial Black\\', Gadget\">Arial Black</span>',\n\t\t\t'Tahoma, Geneva':             '<span style=\"font-family: Tahoma, Geneva\">Tahoma / Geneva</span>',\n\t\t\t'Verdana':                    '<span style=\"font-family: Verdana\">Verdana</span>',\n\t\t\t'Georgia, serif':             '<span style=\"font-family: Georgia, serif\">Georgia</span>',\n\t\t\t'monospace':                  '<span style=\"font-family: monospace\">monospace</span>',\n\t\t};\n\t\tconst fontFamily = Tag.render`<div class=\"sign-document__block-style-btn --btn-font-family\">${fonts[collectStyles['fontFamily']] || 'Font'}</div>`;\n\t\tSignUI.bindSimpleMenu({\n\t\t\tbindElement: fontFamily,\n\t\t\titems: fonts,\n\t\t\tactionHandler: value => {\n\t\t\t\tfontFamily.innerHTML = fonts[value];\n\t\t\t\tactionHandler('family', value);\n\t\t\t}\n\t\t});\n\n\t\t// font size selector\n\n\t\tlet fontSizereal = parseInt(collectStyles['fontSize']);\n\t\tlet fontSizeValue = 14;\n\n\t\tif (fontSizereal)\n\t\t{\n\t\t\tfontSizeValue = fontSizereal;\n\t\t}\n\n\t\tconst fontSize = Tag.render`<div class=\"sign-document__block-style-btn --btn-fontsize\">${fontSizeValue+ 'px' || '<i></i>'}</div>`;\n\t\tSignUI.bindSimpleMenu({\n\t\t\tbindElement: fontSize,\n\t\t\titems: [\n\t\t\t\t'6px', '7px', '8px', '9px', '10px', '11px', '12px', '13px', '14px', '15px', '16px',\n\t\t\t\t'18px', '20px', '22px', '24px', '26px', '28px', '36px', '48px', '72px'\n\t\t\t],\n\t\t\tactionHandler: value => {\n\t\t\t\tfontSize.innerHTML = parseInt(value) + 'px';\n\t\t\t\tactionHandler('size', value);\n\t\t\t},\n\t\t\tcurrentValue: fontSizeValue\n\t\t});\n\n\t\tconst { layout: fontColor } = UI.getColorSelectorBtn(\n\t\t\tcollectStyles.color ?? '#000',\n\t\t\t(color) => actionHandler('color', color),\n\t\t);\n\n\t\treturn Tag.render`\n\t\t\t<div class=\"sign-document__block-style--panel\">\n<!--\t\t\t\t<div class=\"sign-document__block-style&#45;&#45;move-control\"></div>-->\n\t\t\t\t${fontFamily}\n\t\t\t\t${fontSize}\n\t\t\t\t${fontColor}\n\t\t\t\t<div class=\"sign-document__block-style--separator\"></div>\n\t\t\t\t<div class=\"sign-document__block-style-btn --btn-bold\" data-action=\"bold\"><i></i></div>\n\t\t\t\t<div class=\"sign-document__block-style-btn --btn-italic\" data-action=\"italic\"><i></i></div>\n\t\t\t\t<div class=\"sign-document__block-style-btn --btn-underline\" data-action=\"underline\"><i></i></div>\n\t\t\t\t<div class=\"sign-document__block-style-btn --btn-strike\" data-action=\"through\"><i></i></div>\n\t\t\t\t<div class=\"sign-document__block-style-btn --btn-align-left\" data-action=\"left\"><i></i></div>\n\t\t\t\t<div class=\"sign-document__block-style-btn --btn-align-center\" data-action=\"center\"><i></i></div>\n\t\t\t\t<div class=\"sign-document__block-style-btn --btn-align-right\" data-action=\"right\"><i></i></div>\n\t\t\t\t<div class=\"sign-document__block-style-btn --btn-align-justify\" data-action=\"justify\"><i></i></div>\n\t\t\t</div>\n\t\t`;\n\t}\n\n\tstatic getColorSelectorBtn(\n\t\tdefaultColorPickerColor: string,\n\t\tonColorSelect: (string) => any,\n\t\tcolorPickerOptions: ColorPickerOptions = {},\n\t): { layout: HTMLElement, colorPicker: BX.ColorPicker }\n\t{\n\t\tconst layout = Tag.render`<div class=\"sign-document__block-style-btn --btn-color\">\n\t\t\t\t<span class=\"sign-document__block-style-btn--color-block\"></span> \n\t\t\t\t<span>${Loc.getMessage('SIGN_JS_DOCUMENT_STYLE_COLOR')}</span>\n\t\t\t</div>`\n\t\t;\n\t\tUI.updateColorSelectorBtnColor(layout, defaultColorPickerColor);\n\t\tconst updatedColorPickerOptions = {\n\t\t\t...colorPickerOptions,\n\t\t\tbindElement: layout,\n\t\t\tonColorSelected:\n\t\t\t\t(color) => {\n\t\t\t\t\tonColorSelect(color);\n\t\t\t\t\tUI.updateColorSelectorBtnColor(layout, color);\n\t\t\t\t},\n\t\t};\n\n\t\tconst picker = new ColorPicker(updatedColorPickerOptions);\n\n\t\tEvent.bind(layout, 'click', () => {\n\t\t\tpicker.open();\n\t\t});\n\n\t\treturn { layout, colorPicker: picker };\n\t}\n\n\tstatic updateColorSelectorBtnColor(layout: HTMLElement, color: string): void\n\t{\n\t\tconst circleColor = layout.querySelector('.sign-document__block-style-btn--color-block');\n\t\tif (Type.isNil(circleColor))\n\t\t{\n\t\t\treturn;\n\t\t}\n\n\t\tDom.style(\n\t\t\tcircleColor,\n\t\t\t'background-color',\n\t\t\tcolor,\n\t\t);\n\t}\n}\n","import { Dom, Event } from 'main.core';\nimport Block from './block';\nimport UI from './ui';\n\ntype StyleOptions = {\n\tblock: Block,\n\tdata: {[key: string]: string}\n};\n\nexport default class Style\n{\n\t#block: Block;\n\n\t#buttons = {\n\t\tfamily: {\n\t\t\tproperty: 'fontFamily',\n\t\t\tvalue: null\n\t\t},\n\t\tsize: {\n\t\t\tproperty: 'fontSize',\n\t\t\tvalue: 14\n\t\t},\n\t\tcolor: {\n\t\t\tproperty: 'color',\n\t\t\tvalue: null\n\t\t},\n\t\tbold: {\n\t\t\tbutton: null,\n\t\t\tproperty: 'fontWeight',\n\t\t\tvalue: 'bold',\n\t\t\tstate: false\n\t\t},\n\t\titalic: {\n\t\t\tbutton: null,\n\t\t\tproperty: 'fontStyle',\n\t\t\tvalue: 'italic',\n\t\t\tstate: false\n\t\t},\n\t\tunderline: {\n\t\t\tbutton: null,\n\t\t\tproperty: 'textDecoration',\n\t\t\tvalue: 'underline',\n\t\t\tstate: false\n\t\t},\n\t\tthrough: {\n\t\t\tbutton: null,\n\t\t\tproperty: 'textDecoration',\n\t\t\tvalue: 'line-through',\n\t\t\tstate: false\n\t\t},\n\t\tleft: {\n\t\t\tbutton: null,\n\t\t\tproperty: 'textAlign',\n\t\t\tvalue: 'left',\n\t\t\tstate: false,\n\t\t\tgroup: 'align'\n\t\t},\n\t\tcenter: {\n\t\t\tbutton: null,\n\t\t\tproperty: 'textAlign',\n\t\t\tvalue: 'center',\n\t\t\tstate: false,\n\t\t\tgroup: 'align'\n\t\t},\n\t\tright: {\n\t\t\tbutton: null,\n\t\t\tproperty: 'textAlign',\n\t\t\tvalue: 'right',\n\t\t\tstate: false,\n\t\t\tgroup: 'align'\n\t\t},\n\t\tjustify: {\n\t\t\tbutton: null,\n\t\t\tproperty: 'textAlign',\n\t\t\tvalue: 'justify',\n\t\t\tstate: false,\n\t\t\tgroup: 'align'\n\t\t}\n\t};\n\n\t#style = {\n\t\tbuttonPressed: 'sign-document__block-style--button-pressed'\n\t};\n\n\t/**\n\t * Constructor.\n\t * @param {StyleOptions} options\n\t */\n\tconstructor(options: StyleOptions)\n\t{\n\t\tthis.#block = options.block;\n\n\t\tif (options.data)\n\t\t{\n\t\t\tthis.#applyData(options.data);\n\t\t}\n\t}\n\n\t/**\n\t * Handle on panel button click.\n\t * @param {string} code\n\t */\n\t#onPressButton(code: string)\n\t{\n\t\tthis.#buttons[code]['state'] = !this.#buttons[code]['state'];\n\n\t\tif (this.#buttons[code]['state'])\n\t\t{\n\t\t\tDom.addClass(this.#buttons[code]['button'], this.#style.buttonPressed);\n\n\t\t\tif (this.#buttons[code]['group'])\n\t\t\t{\n\t\t\t\tconst group = this.#buttons[code]['group'];\n\n\t\t\t\t[...Object.keys(this.#buttons)].map(key => {\n\t\t\t\t\tif (key !== code && this.#buttons[key]['group'] === group)\n\t\t\t\t\t{\n\t\t\t\t\t\tthis.#buttons[key]['state'] = false;\n\t\t\t\t\t\tDom.removeClass(this.#buttons[key]['button'], this.#style.buttonPressed);\n\t\t\t\t\t}\n\t\t\t\t});\n\t\t\t}\n\t\t}\n\t\telse\n\t\t{\n\t\t\tDom.removeClass(this.#buttons[code]['button'], this.#style.buttonPressed);\n\t\t}\n\n\t\tthis.#block.renderStyle();\n\t}\n\n\t/**\n\t * Applies initiated data to current state.\n\t * @param {{[key: string]: string}} data\n\t */\n\t#applyData(data: {[key: string]: string})\n\t{\n\t\t[...Object.keys(this.#buttons)].map(key => {\n\t\t\tconst property = this.#buttons[key]['property'];\n\n\t\t\tif (data[property])\n\t\t\t{\n\t\t\t\tif (typeof this.#buttons[key]['state'] !== 'undefined')\n\t\t\t\t{\n\t\t\t\t\tif (data[property].indexOf(this.#buttons[key]['value']) !== -1)\n\t\t\t\t\t{\n\t\t\t\t\t\tthis.#buttons[key]['state'] = true;\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t\telse\n\t\t\t\t{\n\t\t\t\t\tthis.#buttons[key]['value'] = data[property];\n\t\t\t\t}\n\t\t\t}\n\t\t});\n\t}\n\n\t/**\n\t * Applies collected styles to the element.\n\t * @param {HTMLElement} element\n\t */\n\tapplyStyles(element: HTMLElement)\n\t{\n\t\telement.removeAttribute('style');\n\t\tDom.style(element, this.collectStyles());\n\t}\n\n\tupdateFontSize(fontSize)\n\t{\n\t\tif (fontSize)\n\t\t{\n\t\t\tthis.#buttons.size['property'] = 'fontSize';\n\t\t\tthis.#buttons.size['value'] = fontSize;\n\t\t}\n\t}\n\n\t/**\n\t * Collects checked styles in one dataset.\n\t * @return {{[key: string]: string}}\n\t */\n\tcollectStyles(): {[key: string]: string}\n\t{\n\t\tconst styles = {};\n\n\t\t[...Object.keys(this.#buttons)].map(key => {\n\t\t\tif (this.#buttons[key]['state'] || (typeof this.#buttons[key]['state'] === 'undefined'))\n\t\t\t{\n\t\t\t\tconst property = this.#buttons[key]['property'];\n\t\t\t\tconst value = this.#buttons[key]['value'];\n\n\t\t\t\tif (value === null)\n\t\t\t\t{\n\t\t\t\t\treturn;\n\t\t\t\t}\n\n\t\t\t\tif (this.#buttons[key]['group'])\n\t\t\t\t{\n\t\t\t\t\tstyles[property] = value;\n\t\t\t\t}\n\t\t\t\telse\n\t\t\t\t{\n\t\t\t\t\tstyles[property] = (styles[property] ? styles[property] + ' ' : '') + value;\n\t\t\t\t}\n\t\t\t}\n\t\t});\n\n\t\treturn styles;\n\t}\n\n\t/**\n\t * Returns style panel layout.\n\t * @return {HTMLElement}\n\t */\n\tgetLayout(): HTMLElement\n\t{\n\t\tconst layout = UI.getStylePanel(\n\t\t\t(code: string, value: string) => {\n\t\t\t\tthis.#buttons[code]['value'] = value;\n\t\t\t\tthis.#block.renderStyle();\n\t\t\t},\n\t\t\tthis.collectStyles()\n\t\t);\n\n\t\t[...layout.querySelectorAll('[data-action]')].map(button => {\n\t\t\t\tconst action = button.getAttribute('data-action');\n\n\t\t\tif (this.#buttons[action])\n\t\t\t{\n\t\t\t\tEvent.bind(button, 'click', () => this.#onPressButton(action));\n\t\t\t\tthis.#buttons[action]['button'] = button;\n\n\t\t\t\tif (this.#buttons[action]['state'])\n\t\t\t\t{\n\t\t\t\t\tDom.addClass(this.#buttons[action]['button'], this.#style.buttonPressed);\n\t\t\t\t}\n\t\t\t}\n\t\t});\n\n\t\treturn layout;\n\t}\n\n\tupdateColor(color: string): void\n\t{\n\t\tthis.#buttons.color.value = color;\n\t}\n}\n","import { Dom, Event, Type } from 'main.core';\nimport { Backend } from 'sign.backend';\nimport { EventEmitter } from 'main.core.events';\nimport { Api } from 'sign.v2.api';\nimport { Date, Dummy, MyRequisites, MySign, MyStamp, Number, Reference, Requisites, Sign, Stamp, Text, MyReference } from './index';\nimport { BlocksManager } from './blocksManager';\nimport Style from './style';\nimport { PositionType, BlockOptions } from '../types/block';\nimport UI from './ui';\n\nexport default class Block extends EventEmitter\n{\n\tevents = {\n\t\tonColorStyleChange: 'onColorStyleChange',\n\t};\n\n\t#id: number;\n\t#code: string;\n\t#layout: HTMLElement;\n\t#stylePanel: Style;\n\t#content: Dummy = null;\n\tblocksManager: BlocksManager;\n\t#memberPart: number = 2;\n\t#panelCreated: boolean = false;\n\t#allowMembers: boolean = false;\n\t#onClickCallback: ?() => {};\n\t#onRemoveCallback: ?() => {};\n\t#contentProviders = {\n\t\tdate: Date,\n\t\tmyrequisites: MyRequisites,\n\t\tmysign: MySign,\n\t\tmystamp: MyStamp,\n\t\tnumber: Number,\n\t\treference: Reference,\n\t\tmyreference: MyReference,\n\t\trequisites: Requisites,\n\t\tsign: Sign,\n\t\tstamp: Stamp,\n\t\ttext: Text,\n\t};\n\t#currentFontSize: String;\n\n\t#style = {\n\t\tblockContent: '.sign-document__block-content',\n\t\tblockPanel: '.sign-document__block-panel--wrapper',\n\t\tblockLoading: 'sign-document-block-loading',\n\t\tblockEditing: 'sign-document__block-wrapper-editing',\n\t\tpageWithNotAllowed: 'sign-editor__content-document--active-move',\n\t};\n\n\t#firstRenderReady: boolean;\n\n\t#api: Api;\n\n\t/**\n\t * Constructor.\n\t * @param {BlockOptions} options\n\t */\n\tconstructor(options: BlockOptions)\n\t{\n\t\tsuper();\n\t\tthis.setEventNamespace('BX.Sign.V2.Editor.Block');\n\t\tthis.blocksManager = options.blocksManager;\n\t\tthis.#id = options.id || null;\n\t\tthis.#code = options.code;\n\t\tthis.#memberPart = options.party;\n\t\tthis.#onClickCallback = options.onClick;\n\t\tthis.#onRemoveCallback = options.onRemove;\n\t\tthis.#firstRenderReady = null;\n\t\tthis.#stylePanel = new Style({\n\t\t\tblock: this,\n\t\t\tdata: options.style\n\t\t});\n\t\tif (!this.#contentProviders[this.#code])\n\t\t{\n\t\t\tthrow new Error(`Content provider for '${this.#code}' not found.`);\n\t\t}\n\n\t\tthis.#content = new this.#contentProviders[this.#code](this);\n\n\t\tif (['sign', 'mysign'].includes(this.#code) && Type.isString(options.style?.color))\n\t\t{\n\t\t\tthis.#content.changeStyleColor(options.style.color, false);\n\t\t}\n\n\t\tthis.#createLayout();\n\n\t\tEvent.bind(this.#layout, 'click', this.#onClick.bind(this));\n\n\t\tif (options.party > 1)\n\t\t{\n\t\t\tthis.#allowMembers = true;\n\t\t}\n\n\t\tthis.renderStyle();\n\n\t\tthis.setPosition(options.position ?? this.#content.getInitDimension());\n\n\t\tif (options.data)\n\t\t{\n\t\t\tsetTimeout(() => {\n\t\t\t\tthis.setData(options.data);\n\t\t\t}, 0);\n\t\t}\n\t\tthis.#api = new Api();\n\t}\n\n\t/**\n\t * Returns block's layout.\n\t * @return {HTMLElement}\n\t */\n\tgetLayout(): HTMLElement\n\t{\n\t\treturn this.#layout;\n\t}\n\n\t/**\n\t * Sets new data to the block.\n\t * @param {any} data\n\t */\n\tsetData(data: any)\n\t{\n\t\tthis.#content.setData(data);\n\t\tthis.renderView();\n\t}\n\n\t/**\n\t * Sets initial position to the block.\n\t * @param {PositionType} position\n\t */\n\tsetPosition(position: PositionType)\n\t{\n\t\tUI.setRect(this.#layout, position);\n\t}\n\n\t/**\n\t * Returns block's data.\n\t * @return {any}\n\t */\n\tgetData(): any\n\t{\n\t\treturn this.#content.getData();\n\t}\n\n\t/**\n\t * Returns position.\n\t * @return {PositionType}\n\t */\n\tgetPosition(): PositionType\n\t{\n\t\tlet {top, left, width, height} = this.#layout.getBoundingClientRect();\n\t\tconst layout = this.#layout;\n\t\ttop = Math.round(top);\n\t\tleft = Math.round(left);\n\t\twidth = Math.round(width);\n\t\theight = Math.round(height);\n\n\t\tconst documentRect = this.blocksManager.getLayout().getBoundingClientRect();\n\n\t\ttop -= Math.round(documentRect.top);\n\t\tleft -= Math.round(documentRect.left);\n\n\t\treturn {top, left, width, height};\n\t}\n\n\t/**\n\t * Returns block styles.\n\t * @return {{{[key: string]: string}}}\n\t */\n\tgetStyle(): {[key: string]: string}\n\t{\n\t\treturn { ...this.#content.getStyles(), ...this.#stylePanel.collectStyles() };\n\t}\n\n\t/**\n\t * Returns id.\n\t * @return {number|null}\n\t */\n\tgetId(): ?number\n\t{\n\t\treturn this.#id ?? null;\n\t}\n\n\t/**\n\t * Returns code.\n\t * @return {string}\n\t */\n\tgetCode(): string\n\t{\n\t\treturn this.#code;\n\t}\n\n\t/**\n\t * Shows page's areas not allowed for block's placement.\n\t */\n\tshowNotAllowedArea()\n\t{\n\t\tconst {page} = this.blocksManager.transferPositionToPage(this.getPosition());\n\t\tconst pageElement = document.querySelector(`.sign-editor__content-document--page[data-page=\"${page}\"]`);\n\n\t\tDom.addClass(pageElement, this.#style.pageWithNotAllowed);\n\t}\n\n\thideNotAllowedArea()\n\t{\n\t\tconst {page} = this.blocksManager.transferPositionToPage(this.getPosition());\n\t\tconst pageElement = document.querySelector(`.sign-editor__content-document--page[data-page=\"${page}\"]`);\n\n\t\tDom.removeClass(pageElement, this.#style.pageWithNotAllowed);\n\t}\n\n\t/**\n\t * Returns member part.\n\t * @return {number}\n\t */\n\tgetMemberPart(): number\n\t{\n\t\treturn this.#memberPart;\n\t}\n\n\t/**\n\t * Handler on click to block.\n\t */\n\t#onClick()\n\t{\n\t\tif (this.#onClickCallback)\n\t\t{\n\t\t\tthis.#onClickCallback(this);\n\t\t}\n\t}\n\n\t/**\n\t * Calls block's action.\n\t */\n\tfireAction()\n\t{\n\t\tif (this.#content['onActionClick'])\n\t\t{\n\t\t\tif (this.#code === 'text')\n\t\t\t{\n\t\t\t\tDom.addClass(this.#layout, this.#style.blockEditing);\n\t\t\t}\n\t\t\tthis.#content['onActionClick']();\n\t\t}\n\t}\n\n\t/**\n\t * Handler on member change.\n\t * @param {number} part\n\t */\n\tonMemberSelect(part: number)\n\t{\n\t\tthis.#memberPart = part;\n\t\tthis.assign();\n\t}\n\n\t/**\n\t * Sets/removes awaiting class to the block.\n\t * @param {boolean} flag\n\t */\n\tawait(flag: boolean)\n\t{\n\t\tconst blockLayouts = [];\n\n\t\tif (!this.#content.isSingleton())\n\t\t{\n\t\t\tblockLayouts.push(this.getLayout());\n\t\t}\n\t\telse\n\t\t{\n\t\t\tconst currentCode = this.getCode();\n\n\t\t\tthis.blocksManager.getBlocks().map(block => {\n\t\t\t\tif (block.getCode() === currentCode)\n\t\t\t\t{\n\t\t\t\t\tblockLayouts.push(block.getLayout());\n\t\t\t\t}\n\t\t\t});\n\t\t}\n\n\t\tblockLayouts.map((blockLayout, key) => {\n\t\t\tif (flag)\n\t\t\t{\n\t\t\t\tif (blockLayouts.length === key + 1)\n\t\t\t\t{\n\t\t\t\t\tDom.addClass(blockLayout, this.#style.blockLoading);\n\t\t\t\t}\n\t\t\t}\n\t\t\telse\n\t\t\t{\n\t\t\t\tDom.removeClass(blockLayout, this.#style.blockLoading);\n\t\t\t}\n\t\t});\n\t}\n\n\t/**\n\t * Assigns block to the document (without saving).\n\t */\n\tassign()\n\t{\n\t\tconst blockLayout = this.getLayout();\n\t\tconst blocksData = [];\n\t\tconst blocksInstance = [];\n\n\t\tthis.await(true);\n\n\t\tif (!this.#content.isSingleton())\n\t\t{\n\t\t\tblocksData.push({\n\t\t\t\tcode: this.#code,\n\t\t\t\tpart: this.#memberPart,\n\t\t\t\tdata: this.getData()\n\t\t\t});\n\t\t\tblocksInstance.push(this);\n\t\t}\n\t\t// if block is a singleton push all blocks with same code\n\t\telse\n\t\t{\n\t\t\tthis.blocksManager.getBlocks().map(block => {\n\t\t\t\tif (\n\t\t\t\t\tblock.getCode() === this.getCode() &&\n\t\t\t\t\tblock.getMemberPart() === this.getMemberPart()\n\t\t\t\t)\n\t\t\t\t{\n\t\t\t\t\tblocksData.push({\n\t\t\t\t\t\tcode: block.getCode(),\n\t\t\t\t\t\tpart: block.getMemberPart(),\n\t\t\t\t\t\tdata: block.getData()\n\t\t\t\t\t});\n\t\t\t\t\tblocksInstance.push(block);\n\t\t\t\t}\n\t\t\t});\n\t\t}\n\n\t\tthis.#api.loadBlocksData(\n\t\t\tthis.blocksManager.getDocumentUid(),\n\t\t\tblocksData\n\t\t).then(result => {\n\t\t\tif (Type.isArray(result))\n\t\t\t{\n\t\t\t\tresult.forEach((block, i) => {\n\t\t\t\t\tblocksInstance[i].setData(block.data);\n\t\t\t\t});\n\t\t\t}\n\n\t\t\tthis.await(false);\n\t\t\tthis.blocksManager.showResizeArea(this);\n\t\t})\n\t\t.catch((response) => {\n\t\t\tDom.remove(blockLayout);\n\t\t});\n\t}\n\n\t/**\n\t * Renders block within document's layout.\n\t */\n\trenderView()\n\t{\n\t\tconst contentTag = this.#layout.querySelector(this.#style.blockContent);\n\n\t\t// content\n\t\tDom.clean(contentTag);\n\n\t\tswitch (this.#code.toLowerCase())\n\t\t{\n\t\t\tcase 'stamp':\n\t\t\tcase 'mystamp':\n\t\t\tcase 'sign':\n\t\t\tcase 'mysign':\n\t\t\t\tDom.addClass(contentTag, '--image')\n\t\t}\n\n\t\tconst resizeNode = this.#content.getViewContent();\n\n\t\tDom.append(resizeNode, contentTag);\n\n\t\tDom.addClass(resizeNode, '--' + this.#code.toLowerCase());\n\n\t\tif (\n\t\t\tthis.#code.toLowerCase() === 'requisites'\n\t\t\t|| this.#code.toLowerCase() === 'myrequisites'\n\t\t\t|| this.#code.toLowerCase() === 'date'\n\t\t\t|| this.#code.toLowerCase() === 'number'\n\t\t\t|| this.#code.toLowerCase() === 'stamp'\n\t\t\t|| this.#code.toLowerCase() === 'mystamp'\n\t\t\t|| this.#code.toLowerCase() === 'sign'\n\t\t\t|| this.#code.toLowerCase() === 'mysign'\n\t\t\t|| this.#code.toLowerCase() === 'reference'\n\t\t\t|| this.#code.toLowerCase() === 'myreference'\n\t\t\t|| this.#code.toLowerCase() === 'text'\n\t\t)\n\t\t{\n\t\t\tresizeNode.style.setProperty('display', 'block');\n\t\t\tresizeNode.style.setProperty('overflow', 'hidden');\n\n\t\t\tif (!this.observerReady)\n\t\t\t{\n\t\t\t\tif (this.getStyle()['fontSize'])\n\t\t\t\t{\n\t\t\t\t\tthis.maxTextSize = parseFloat(this.getStyle()['fontSize']);\n\t\t\t\t}\n\t\t\t\telse\n\t\t\t\t{\n\t\t\t\t\tthis.maxTextSize = 14;\n\t\t\t\t}\n\n\t\t\t\tthis.isOverflownX = ({ clientHeight, scrollHeight }) => {\n\t\t\t\t\treturn scrollHeight > clientHeight;\n\t\t\t\t}\n\n\t\t\t\tEventEmitter.subscribe(resizeNode.parentNode.parentNode, 'BX.Sign:setFontSize', (param)=> {\n\t\t\t\t\tif (param.data.fontSize)\n\t\t\t\t\t{\n\t\t\t\t\t\tthis.maxTextSize = param.data.fontSize;\n\t\t\t\t\t\tthis.resizeText({\n\t\t\t\t\t\t\telement: param.target.querySelector('.sign-document__block-content > div'),\n\t\t\t\t\t\t\tstep: 0.5\n\t\t\t\t\t\t});\n\t\t\t\t\t}\n\t\t\t\t});\n\n\t\t\t\tthis.resizeText = ({ element, minSize = 1, step = 1, unit = 'px' }) => {\n\n\t\t\t\t\tif (this.intervalTextResize)\n\t\t\t\t\t{\n\t\t\t\t\t\tclearTimeout(this.intervalTextResize);\n\t\t\t\t\t}\n\n\t\t\t\t\tlet i = minSize;\n\t\t\t\t\tlet overflow = false;\n\n\t\t\t\t\tconst parent = element.parentNode\n\n\t\t\t\t\twhile (!overflow && i < this.maxTextSize)\n\t\t\t\t\t{\n\t\t\t\t\t\telement.style.fontSize = `${i}${unit}`;\n\t\t\t\t\t\toverflow = this.isOverflownX(parent);\n\t\t\t\t\t\tif (!overflow)\n\t\t\t\t\t\t{\n\t\t\t\t\t\t\ti += step;\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t\tthis.#currentFontSize = `${i - step}${unit}`;\n\t\t\t\t\telement.style.fontSize = this.#currentFontSize;\n\n\t\t\t\t\tthis.intervalTextResize = setTimeout(() => {\n\t\t\t\t\t\telement.parentNode.style.setProperty('font-size', element.style.fontSize);\n\t\t\t\t\t\telement.style.removeProperty('font-size', element.style.fontSize);\n\t\t\t\t\t\tthis.#stylePanel.updateFontSize(this.#currentFontSize);\n\t\t\t\t\t}, 1000);\n\t\t\t\t}\n\n\t\t\t\tif (\n\t\t\t\t\tthis.#code.toLowerCase() === 'requisites'\n\t\t\t\t\t|| this.#code.toLowerCase() === 'myrequisites'\n\t\t\t\t\t|| this.#code.toLowerCase() === 'reference'\n\t\t\t\t\t|| this.#code.toLowerCase() === 'myreference'\n\t\t\t\t\t|| this.#code.toLowerCase() === 'text'\n\t\t\t\t)\n\t\t\t\t{\n\t\t\t\t\tthis.resizeText({\n\t\t\t\t\t\telement: resizeNode,\n\t\t\t\t\t\tstep: 0.5\n\t\t\t\t\t});\n\t\t\t\t}\n\t\t\t\tthis.#content.subscribe(this.#content.events.onChange, this.#onContentChange.bind(this));\n\t\t\t\tthis.#content.subscribe(this.#content.events.onColorStyleChange, this.#onContentColorStyleChange.bind(this));\n\n\t\t\t\tthis.observerReady = true;\n\t\t\t}\n\n\t\t\tif (this.#firstRenderReady)\n\t\t\t{\n\t\t\t\tthis.resizeText({\n\t\t\t\t\telement: resizeNode,\n\t\t\t\t\tstep: 0.5\n\t\t\t\t});\n\t\t\t}\n\t\t}\n\n\t\tthis.#firstRenderReady = true;\n\n\t\tif (this.#panelCreated)\n\t\t{\n\t\t\treturn;\n\t\t}\n\n\t\t// action / style panel\n\t\tconst panelTag = this.#layout.querySelector(this.#style.blockPanel);\n\t\tDom.clean(panelTag);\n\n\t\t// style\n\t\tif (this.#content.isStyleAllowed())\n\t\t{\n\t\t\tDom.append(this.#stylePanel.getLayout(), panelTag);\n\t\t}\n\n\t\t// action\n\t\tDom.append(this.#content.getActionButton(), panelTag);\n\n\t\t// block caption\n\t\tDom.append(this.#content.getBlockCaption(), panelTag);\n\n\t\t// member selector\n\t\tif (this.#allowMembers)\n\t\t{\n\t\t\tconst allMembers = this.blocksManager.getMembers();\n\t\t\tconst selectedMembers = allMembers.filter((member) => {\n\t\t\t\treturn member.part > 1\n\t\t\t});\n\t\t\tDom.append(UI.getMemberSelector(\n\t\t\t\tselectedMembers,\n\t\t\t\tthis.#memberPart,\n\t\t\t\tthis.onMemberSelect.bind(this)\n\t\t\t), panelTag);\n\t\t}\n\n\t\tthis.#panelCreated = true;\n\t}\n\n\tgetCurrentFontSize()\n\t{\n\t\treturn this.#currentFontSize;\n\t}\n\n\t/**\n\t * Calls when block starts being resized or moved.\n\t */\n\tonStartChangePosition()\n\t{\n\t\tthis.#content.onStartChangePosition();\n\t}\n\n\t/**\n\t * Calls when block has placed on document.\n\t */\n\tonPlaced()\n\t{\n\t\tthis.#content.onPlaced();\n\t}\n\n\tupdateColor(color: string, emitEvent: boolean = true): void\n\t{\n\t\tthis.#content.changeStyleColor(color, emitEvent);\n\t\tthis.#stylePanel.updateColor(color);\n\t}\n\n\t/**\n\t * Calls when block saved.\n\t */\n\tonSave()\n\t{\n\t\tthis.#content.onSave();\n\t}\n\n\t/**\n\t * Calls when block removed.\n\t */\n\tonRemove()\n\t{\n\t\tthis.#content.onRemove();\n\t}\n\n\t/**\n\t * Calls when click was out the block.\n\t */\n\tonClickOut()\n\t{\n\t\tthis.#content.onClickOut();\n\t}\n\n\t/**\n\t * Set block styles to layout.\n\t */\n\trenderStyle()\n\t{\n\t\tthis.#stylePanel.applyStyles(\n\t\t\tthis.#layout.querySelector(this.#style.blockContent)\n\t\t);\n\t}\n\n\t/**\n\t * Adjust actions panel.\n\t */\n\tadjustActionsPanel()\n\t{\n\t\tconst blockLayout = this.getLayout();\n\t\tconst actionsPanel = blockLayout.querySelector('[data-role=\"sign-block__actions\"]');\n\n\t\tif (actionsPanel)\n\t\t{\n\t\t\tconst actionsPanelRect = actionsPanel.getBoundingClientRect();\n\t\t\tconst blockRect = blockLayout.getBoundingClientRect();\n\t\t\tconst a = actionsPanelRect.width;\n\t\t\tconst b = blockRect.width;\n\t\t\tconst detectBorder = (a-b) / 2;\n\n\t\t\tif (detectBorder > blockRect.left)\n\t\t\t{\n\t\t\t\tactionsPanel.style.marginLeft = detectBorder - 50 + 'px';\n\t\t\t}\n\t\t\telse\n\t\t\t{\n\t\t\t\tactionsPanel.style.marginLeft = 0;\n\t\t\t}\n\t\t}\n\t}\n\n\t/**\n\t * Force saves the block.\n\t */\n\tforceSave()\n\t{\n\t\tthis.#layout.querySelector('[data-role=\"saveAction\"]').click();\n\t}\n\n\t/**\n\t * Creates layout for new block within document.\n\t */\n\t#createLayout()\n\t{\n\t\tthis.#layout = UI.getBlockLayout({\n\t\t\tonSave: (event) => {\n\t\t\t\tthis.renderView();\n\t\t\t\tthis.blocksManager.unMuteResizeArea();\n\t\t\t\tthis.blocksManager.hideResizeArea();\n\t\t\t\tthis.blocksManager.setSavingMark(false);\n\t\t\t\tthis.onSave();\n\n\t\t\t\tDom.removeClass(this.#layout, this.#style.blockEditing);\n\n\t\t\t\tevent.stopPropagation();\n\t\t\t},\n\t\t\tonRemove: (event) => {\n\t\t\t\tif (this.#onRemoveCallback)\n\t\t\t\t{\n\t\t\t\t\tthis.#onRemoveCallback(this);\n\t\t\t\t}\n\t\t\t\tthis.#layout.hidden = true;\n\t\t\t\tthis.onRemove();\n\n\t\t\t\tevent.stopPropagation();\n\t\t\t}\n\t\t});\n\t\tconst nodeForPosition = document.body.querySelector('.sign-editor__content');\n\t\tconst documentLayout = this.blocksManager.getLayout();\n\t\tconst documentLayoutRect = documentLayout.getBoundingClientRect();\n\t\tconst blockInitDim = this.#content.getInitDimension();\n\t\tconst position = {\n\t\t\ttop: Math.min(nodeForPosition.scrollTop + nodeForPosition.offsetHeight / 2, documentLayoutRect.height - blockInitDim.height),\n\t\t\tleft: documentLayoutRect.width / 2 - 100\n\t\t};\n\n\t\tif (this.blocksManager.inDeadZone(position.top, position.top + blockInitDim.height))\n\t\t{\n\t\t\tposition.top += blockInitDim.height + this.blocksManager.getPagesGap();\n\t\t}\n\n\t\tthis.setPosition(position);\n\t}\n\n\t/**\n\t * Returns true, if block was removed.\n\t * @return {boolean}\n\t */\n\tisRemoved()\n\t{\n\t\treturn this.#layout.hidden === true;\n\t}\n\n\t#onContentChange(): void\n\t{\n\t\tconst content = this.#content;\n\t\tif (!(content instanceof Text))\n\t\t{\n\t\t\treturn;\n\t\t}\n\n\t\tthis.resizeText({ element: content.getContainer(), step: 0.5 });\n\t}\n\n\t#onContentColorStyleChange(event): void\n\t{\n\t\tthis.emit(this.events.onColorStyleChange, { color: this.#content.getStyles()?.color ?? null });\n\t\tconst color = this.#content.getStyles()?.color ?? null;\n\t\tif (Type.isString(color))\n\t\t{\n\t\t\tthis.#stylePanel.updateColor(color);\n\t\t}\n\t}\n}\n","import { Dom, Event, Type } from 'main.core';\nimport { Draggable, DragMoveEvent, DragStartEvent, DragEndEvent } from 'ui.draganddrop.draggable';\nimport { EventEmitter } from 'main.core.events';\nimport Block from './block';\nimport UI from './ui';\n\ntype ResizeOptions = {\n\twrapperLayout: HTMLElement\n};\n\nexport default class Resize\n{\n\tstatic borderDelta = 2;\n\n\t#wrapperLayout: HTMLElement;\n\t#layout: HTMLElement;\n\t#fullEditorContent: HTMLElement;\n\t#linkedElement: HTMLElement;\n\t#linkedBlock: Block;\n\n\tposition: DOMRect;\n\tpositionLast: { ...DOMRect, notAddDeathMargin?: boolean };\n\tresizing: boolean;\n\tmoving: boolean;\n\n\t#style = {\n\t\tresizeContainer: '.sign-area-resizable-controls > div',\n\t\tmoveContainer: '.sign-document__resize-area',\n\t\tblockEditing: 'sign-document__block-wrapper-editing'\n\t};\n\n\t/**\n\t * Constructor.\n\t * @param {ResizeOptions} options\n\t */\n\tconstructor(options: ResizeOptions)\n\t{\n\t\tif (!Type.isDomNode(options.wrapperLayout))\n\t\t{\n\t\t\tthrow new Error('Option wrapperLayout is undefined or not valid DOM Element.');\n\t\t}\n\n\t\tthis.#layout = UI.getResizeArea();\n\t\tthis.#wrapperLayout = options.wrapperLayout;\n\t\tEvent.bind(this.#layout, 'click', this.#onClick.bind(this));\n\n\t\tthis.#initResize();\n\t\tthis.#initMove();\n\t}\n\n\t/**\n\t * Returns layout of resizing area.\n\t * @return {HTMLElement}\n\t */\n\tgetLayout(): HTMLElement\n\t{\n\t\treturn this.#layout;\n\t}\n\n\t/**\n\t * Shows resizing area over the element.\n\t * @param {Block} block\n\t */\n\tshow(block: Block)\n\t{\n\t\tif (this.#linkedBlock === block)\n\t\t{\n\t\t\treturn;\n\t\t}\n\n\t\tconst pointRect = block.getLayout().getBoundingClientRect();\n\t\tthis.#layout.style.display = 'block';\n\n\t\tif (this.#linkedElement)\n\t\t{\n\t\t\tthis.#linkedElement.removeAttribute('data-active');\n\t\t}\n\t\tthis.#linkedBlock = block;\n\t\tthis.#linkedElement = block.getLayout();\n\t\tthis.#linkedElement.setAttribute('data-active', 1);\n\t\tconst wrapperLayoutRect = this.#wrapperLayout.getBoundingClientRect();\n\t\tUI.setRect(this.#layout, {\n\t\t\ttop: pointRect.top - wrapperLayoutRect.top,\n\t\t\tleft: pointRect.left - wrapperLayoutRect.left,\n\t\t\twidth: pointRect.width + Resize.borderDelta,\n\t\t\theight: pointRect.height + Resize.borderDelta,\n\t\t});\n\t}\n\n\tsetFullEditorContent(editorContent: HTMLElement)\n\t{\n\t\tthis.#fullEditorContent = editorContent;\n\t}\n\n\t/**\n\t * Hides resizing area.\n\t */\n\thide()\n\t{\n\t\tthis.#linkedBlock = null;\n\t\tthis.#layout.style.display = 'none';\n\n\t\tif (this.#linkedElement)\n\t\t{\n\t\t\tthis.#linkedElement.removeAttribute('data-active');\n\t\t}\n\t}\n\n\t/**\n\t * Returns linked block.\n\t * @return {Block|null}\n\t */\n\tgetLinkedBlock(): ?Block\n\t{\n\t\treturn this.#linkedBlock;\n\t}\n\n\t/**\n\t * On click handler (provide click to linked element).\n\t */\n\t#onClick(e)\n\t{\n\t\tif (this.moving || this.resizing)\n\t\t{\n\t\t\treturn;\n\t\t}\n\n\t\tif (this.#linkedBlock)\n\t\t{\n\t\t\tthis.#linkedBlock.fireAction();\n\t\t}\n\t}\n\n\t/**\n\t * Initializes resizing.\n\t */\n\t#initResize()\n\t{\n\t\tlet initialRect = null;\n\n\t\tconst draggable = new Draggable({\n\t\t\tcontainer: this.#wrapperLayout,\n\t\t\tdraggable: this.#style.resizeContainer,\n\t\t\ttype: BX.UI.DragAndDrop.Draggable.HEADLESS\n\t\t});\n\n\t\tthis.textResize = {\n\t\t\twrapper: null,\n\t\t\tcontent: null\n\t\t};\n\n\t\tdraggable\n\t\t\t.subscribe('start', (event: DragStartEvent) => {\n\t\t\t\tif (this.#layout.getAttribute('data-disable'))\n\t\t\t\t{\n\t\t\t\t\treturn;\n\t\t\t\t}\n\n\t\t\t\tif (!this.textResize.wrapper || !this.textResize.content)\n\t\t\t\t{\n\t\t\t\t\tthis.textResize = {\n\t\t\t\t\t\twrapper: this.#linkedBlock.getLayout(),\n\t\t\t\t\t\tcontent: this.#linkedBlock.getLayout().querySelector('.sign-document__block-content')\n\t\t\t\t\t}\n\t\t\t\t}\n\n\t\t\t\tEventEmitter.emit('BX.Sign:resizeStart', draggable);\n\t\t\t\tinitialRect = this.#layout.getBoundingClientRect();\n\t\t\t\tthis.#linkedBlock.onStartChangePosition();\n\t\t\t\tthis.positionLast = null;\n\n\t\t\t\tDom.removeClass(this.#linkedBlock.getLayout(), this.#style.blockEditing);\n\t\t\t})\n\t\t\t.subscribe('end', (event: DragEndEvent) => {\n\n\t\t\t\tsetTimeout(() => {\n\t\t\t\t\tthis.resizing = false;\n\t\t\t\t}, 0);\n\n\t\t\t})\n\t\t\t.subscribe('move', (event) => {\n\n\t\t\t\tif (this.#layout.getAttribute('data-disable'))\n\t\t\t\t{\n\t\t\t\t\treturn;\n\t\t\t\t}\n\n\t\t\t\tthis.resizing = true;\n\n\t\t\t\tlet left = null;\n\t\t\t\tlet top = null;\n\t\t\t\tlet bottomResize = false;\n\t\t\t\tlet {width, height} = initialRect;\n\n\t\t\t\tconst data = event.getData();\n\t\t\t\tconst areaRect = this.#layout.getBoundingClientRect();\n\t\t\t\tconst wrapperRect = this.#wrapperLayout.getBoundingClientRect();\n\n\t\t\t\tif (Dom.hasClass(data.draggable, 'sign-document__resize-control --left-top'))\n\t\t\t\t{\n\t\t\t\t\tleft = Math.max(0, initialRect.left + data.offsetX - wrapperRect.left);\n\t\t\t\t\ttop = Math.max(0, initialRect.top + data.offsetY - wrapperRect.top);\n\t\t\t\t\twidth = initialRect.width - data.offsetX;\n\t\t\t\t\theight = initialRect.height - data.offsetY;\n\t\t\t\t}\n\n\t\t\t\tif (Dom.hasClass(data.draggable, 'sign-document__resize-control --middle-top'))\n\t\t\t\t{\n\t\t\t\t\ttop = Math.max(0, initialRect.top + data.offsetY - wrapperRect.top);\n\t\t\t\t\theight = initialRect.height - data.offsetY;\n\t\t\t\t}\n\n\t\t\t\tif (Dom.hasClass(data.draggable, 'sign-document__resize-control --right-top'))\n\t\t\t\t{\n\t\t\t\t\ttop = Math.max(0, initialRect.top + data.offsetY - wrapperRect.top);\n\t\t\t\t\twidth = initialRect.width + data.offsetX;\n\t\t\t\t\theight = initialRect.height - data.offsetY;\n\t\t\t\t}\n\n\t\t\t\tif (Dom.hasClass(data.draggable, 'sign-document__resize-control --middle-right'))\n\t\t\t\t{\n\t\t\t\t\twidth = initialRect.width + data.offsetX;\n\t\t\t\t}\n\n\t\t\t\tif (Dom.hasClass(data.draggable, 'sign-document__resize-control --right-bottom'))\n\t\t\t\t{\n\t\t\t\t\twidth = initialRect.width + data.offsetX;\n\t\t\t\t\theight = initialRect.height + data.offsetY;\n\t\t\t\t\tbottomResize = true;\n\t\t\t\t}\n\n\t\t\t\tif (Dom.hasClass(data.draggable, 'sign-document__resize-control --middle-bottom'))\n\t\t\t\t{\n\t\t\t\t\theight = initialRect.height + data.offsetY;\n\t\t\t\t\tbottomResize = true;\n\t\t\t\t}\n\n\t\t\t\tif (Dom.hasClass(data.draggable, 'sign-document__resize-control --left-bottom'))\n\t\t\t\t{\n\t\t\t\t\tleft = initialRect.left + data.offsetX - wrapperRect.left;\n\t\t\t\t\twidth = initialRect.width - data.offsetX;\n\t\t\t\t\theight = initialRect.height + data.offsetY;\n\t\t\t\t\tbottomResize = true;\n\t\t\t\t}\n\n\t\t\t\tif (Dom.hasClass(data.draggable, 'sign-document__resize-control --middle-left'))\n\t\t\t\t{\n\t\t\t\t\tleft = initialRect.left + data.offsetX - wrapperRect.left;\n\t\t\t\t\twidth = initialRect.width - data.offsetX;\n\t\t\t\t}\n\n\t\t\t\tif (width < 60 || height < 20)\n\t\t\t\t{\n\t\t\t\t\treturn;\n\t\t\t\t}\n\n\t\t\t\tconst newPosition = { width, height };\n\n\t\t\t\tif (newPosition['width'] + areaRect.left - wrapperRect.left > wrapperRect.width)\n\t\t\t\t{\n\t\t\t\t\twidth = newPosition['width'] = wrapperRect.width + wrapperRect.left - areaRect.left;\n\t\t\t\t}\n\n\t\t\t\tif (newPosition['height'] + areaRect.top - wrapperRect.top > wrapperRect.height)\n\t\t\t\t{\n\t\t\t\t\theight = newPosition['height'] = wrapperRect.height + wrapperRect.top - areaRect.top;\n\t\t\t\t}\n\n\t\t\t\tif (left)\n\t\t\t\t{\n\t\t\t\t\tif (left < 0)\n\t\t\t\t\t{\n\t\t\t\t\t\tleft = 0;\n\t\t\t\t\t}\n\t\t\t\t\tnewPosition['left'] = left;\n\t\t\t\t}\n\t\t\t\tif (top)\n\t\t\t\t{\n\t\t\t\t\tnewPosition['top'] = top;\n\t\t\t\t}\n\n\t\t\t\tlet calcDeathTop = initialRect.top;\n\t\t\t\tlet notAddDeathMargin = true;\n\t\t\t\tif (newPosition.top)\n\t\t\t\t{\n\t\t\t\t\tcalcDeathTop = newPosition.top;\n\t\t\t\t\tnotAddDeathMargin = false;\n\t\t\t\t}\n\n\t\t\t\tif (this.#linkedBlock.blocksManager.inDeadZone(calcDeathTop, calcDeathTop + newPosition.height, notAddDeathMargin))\n\t\t\t\t{\n\t\t\t\t\tif (!bottomResize)\n\t\t\t\t\t{\n\t\t\t\t\t\tthis.#linkedBlock.showNotAllowedArea();\n\t\t\t\t\t}\n\t\t\t\t\treturn;\n\t\t\t\t}\n\n\t\t\t\tconst newPositionLinked = Object.assign({}, {\n\t\t\t\t\t...newPosition,\n\t\t\t\t\twidth: width - Resize.borderDelta,\n\t\t\t\t\theight: height - Resize.borderDelta,\n\t\t\t\t});\n\n\t\t\t\tUI.setRect(this.#layout, newPosition);\n\t\t\t\tUI.setRect(this.#linkedElement, newPositionLinked);\n\n\t\t\t\tthis.#linkedBlock.renderView();\n\t\t\t\tthis.#linkedBlock.blocksManager.setSavingMark(false);\n\t\t\t\tthis.#linkedBlock.adjustActionsPanel();\n\t\t\t});\n\t}\n\n\t/**\n\t * Initializes moving.\n\t */\n\t#initMove()\n\t{\n\t\tconst dragArea = this.#wrapperLayout;\n\t\tlet widthInProcess;\n\n\t\tconst draggable = new Draggable({\n\t\t\tcontainer: dragArea,\n\t\t\tdraggable: this.#style.moveContainer,\n\t\t\ttype: Draggable.HEADLESS\n\t\t});\n\n\t\tdraggable\n\t\t\t.subscribe('start', (event: DragStartEvent) => {\n\n\t\t\t\tif (this.#layout.getAttribute('data-disable'))\n\t\t\t\t{\n\t\t\t\t\treturn;\n\t\t\t\t}\n\n\t\t\t\tEventEmitter.emit('BX.Sign:moveStart', draggable);\n\n\t\t\t\tif (this.resizing)\n\t\t\t\t{\n\t\t\t\t\treturn;\n\t\t\t\t}\n\n\t\t\t\tconst {source} = event.getData();\n\t\t\t\tthis.position = Dom.getPosition(source);\n\t\t\t\tthis.#linkedBlock.onStartChangePosition();\n\t\t\t\tthis.positionLast = null;\n\n\t\t\t\tDom.removeClass(this.#linkedBlock.getLayout(), this.#style.blockEditing);\n\t\t\t})\n\t\t\t.subscribe('end', (event: DragEndEvent) => {\n\n\t\t\t\tsetTimeout(() => {\n\t\t\t\t\tthis.moving = false;\n\t\t\t\t}, 0);\n\n\t\t\t\tif (!this.#linkedBlock)\n\t\t\t\t{\n\t\t\t\t\treturn;\n\t\t\t\t}\n\n\t\t\t\tif (this.resizing)\n\t\t\t\t{\n\t\t\t\t\treturn;\n\t\t\t\t}\n\n\t\t\t\twidthInProcess = null;\n\n\t\t\t\tconst data = event.getData();\n\t\t\t\tlet moveTopDelta = null;\n\t\t\t\tif (this.positionLast)\n\t\t\t\t{\n\t\t\t\t\tmoveTopDelta = this.#linkedBlock.blocksManager.inDeadZone(this.positionLast.top, this.positionLast.top + this.positionLast.height);\n\t\t\t\t}\n\n\t\t\t\tthis.#linkedBlock.hideNotAllowedArea();\n\n\t\t\t\tif (moveTopDelta)\n\t\t\t\t{\n\t\t\t\t\tUI.setRect(data.source, {top: this.positionLast.top + moveTopDelta});\n\t\t\t\t\tUI.setRect(this.#linkedElement, {top: this.positionLast.top + moveTopDelta});\n\t\t\t\t}\n\t\t\t})\n\t\t\t.subscribe('move', (event: DragMoveEvent) => {\n\n\t\t\t\tif (this.#layout.getAttribute('data-disable'))\n\t\t\t\t{\n\t\t\t\t\treturn;\n\t\t\t\t}\n\n\t\t\t\tif (this.resizing)\n\t\t\t\t{\n\t\t\t\t\treturn;\n\t\t\t\t}\n\n\t\t\t\tthis.moving = true;\n\n\t\t\t\tconst data = event.getData();\n\t\t\t\tconst {source, offsetY, offsetX} = data;\n\t\t\t\tconst areaRect = data.source.getBoundingClientRect();\n\t\t\t\tconst wrapperRect = this.#wrapperLayout.getBoundingClientRect();\n\n\t\t\t\tif (this.position)\n\t\t\t\t{\n\t\t\t\t\tconst newPosition = {\n\t\t\t\t\t\ttop: offsetY - wrapperRect.top + this.position.y,\n\t\t\t\t\t\tleft: offsetX - wrapperRect.left + this.position.x,\n\t\t\t\t\t\twidth: widthInProcess ? widthInProcess : this.position.width,\n\t\t\t\t\t\theight: this.position.height\n\t\t\t\t\t};\n\n\t\t\t\t\tif (newPosition.left < 0)\n\t\t\t\t\t{\n\t\t\t\t\t\tnewPosition.left = 0;\n\t\t\t\t\t}\n\t\t\t\t\tif (newPosition.top < 0)\n\t\t\t\t\t{\n\t\t\t\t\t\tnewPosition.top = 0;\n\t\t\t\t\t}\n\t\t\t\t\tif (newPosition.top + areaRect.height > wrapperRect.height)\n\t\t\t\t\t{\n\t\t\t\t\t\tnewPosition.top = wrapperRect.height - areaRect.height;\n\t\t\t\t\t}\n\t\t\t\t\tif (newPosition.left + areaRect.width > wrapperRect.width)\n\t\t\t\t\t{\n\t\t\t\t\t\tthis.#linkedBlock.renderView();\n\t\t\t\t\t\tif (wrapperRect.width - newPosition.left > 50)\n\t\t\t\t\t\t{\n\t\t\t\t\t\t\twidthInProcess = newPosition.width = wrapperRect.width - newPosition.left;\n\t\t\t\t\t\t}\n\t\t\t\t\t\telse\n\t\t\t\t\t\t{\n\t\t\t\t\t\t\tnewPosition.left = wrapperRect.width - areaRect.width;\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\n\t\t\t\t\tthis.positionLast = Object.assign({}, newPosition);\n\n\t\t\t\t\tlet moveTopDelta = null;\n\n\t\t\t\t\tif (this.positionLast)\n\t\t\t\t\t{\n\t\t\t\t\t\tmoveTopDelta = this.#linkedBlock.blocksManager.inDeadZone(this.positionLast.top, this.positionLast.top + this.positionLast.height);\n\t\t\t\t\t}\n\n\t\t\t\t\tif (moveTopDelta > 0)\n\t\t\t\t\t{\n\t\t\t\t\t\tthis.#linkedBlock.showNotAllowedArea();\n\t\t\t\t\t}\n\t\t\t\t\telse\n\t\t\t\t\t{\n\t\t\t\t\t\tthis.#linkedBlock.hideNotAllowedArea();\n\t\t\t\t\t}\n\n\t\t\t\t\tconst newPositionLinked = Object.assign({}, {\n\t\t\t\t\t\t...newPosition,\n\t\t\t\t\t\twidth: newPosition.width - Resize.borderDelta,\n\t\t\t\t\t\theight: newPosition.height - Resize.borderDelta,\n\t\t\t\t\t});\n\n\t\t\t\t\tUI.setRect(source, newPosition);\n\t\t\t\t\tUI.setRect(this.#linkedElement, newPositionLinked);\n\n\t\t\t\t\tthis.#linkedBlock.blocksManager.setSavingMark(false);\n\t\t\t\t\tthis.#linkedBlock.adjustActionsPanel();\n\t\t\t\t}\n\t\t\t});\n\t}\n}\n","import { Dom, Event, Loc, Type } from 'main.core';\nimport { Backend } from 'sign.backend';\nimport { MessageBox } from 'ui.dialogs.messagebox';\nimport { Popup } from 'main.popup';\nimport { Api } from 'sign.v2.api';\nimport Block from './block';\nimport Resize from './resize';\nimport { BlockItem, Config, DocumentOptions, MemberItem, PositionType } from '../types/document';\nimport { Button, ButtonColor } from 'ui.buttons';\nimport { Guide } from 'sign.tour';\nimport 'ui.info-helper';\nimport 'spotlight';\nimport { BaseEvent, EventEmitter } from 'main.core.events';\n\nconst marginTop = 0;\nconst gapBetweenPages = 20;\n\nexport class BlocksManager\n{\n\t#documentId: number;\n\t#documentUid: string;\n\t#companyId: number;\n\t#initiatorName: string;\n\t#entityId: number;\n\t#blankId: number;\n\t#pagesMinHeight: number = 0;\n\t#disableEdit: boolean;\n\t#closeDemoContent: boolean = false;\n\t#members: Array<MemberItem>;\n\t#documentLayout: HTMLElement;\n\tresizeArea: Resize;\n\t#blocks: Array<Block> = [];\n\t#blocksColorChangeListeners: Map<Block, (Block) => void> = new Map();\n\t#pagesRects: Array<DOMRect> = [];\n\t#seams: Array<Array<number, number>> = [];\n\t#config: Config;\n\t#helpBtnElementId = 'sign-editor-help-btn';\n\t#helpBtnHelperArticleCode = '16571388';\n\t#api: Api;\n\t#lastContainerSize;\n\n\t/**\n\t * Constructor.\n\t * @param {DocumentOptions} options\n\t */\n\tconstructor(options: DocumentOptions)\n\t{\n\t\tconst { documentLayout, disableEdit } = options;\n\t\tthis.#documentLayout = documentLayout;\n\t\tthis.#disableEdit = disableEdit;\n\t\tif (!this.#disableEdit)\n\t\t{\n\t\t\tthis.resizeArea = new Resize({ wrapperLayout: this.#documentLayout });\n\t\t\tDom.append(this.resizeArea.getLayout(), this.#documentLayout);\n\t\t}\n\n\t\tEvent.bind(documentLayout, 'click', ({ target }) => {\n\t\t\tconst preventClickOut = target.closest('.sign-document__block-wrapper') ||\n\t\t\t\ttarget.closest('.sign-document__resize-area');\n\t\t\tif (preventClickOut)\n\t\t\t{\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\tconst activeBlock = this.resizeArea.getLinkedBlock();\n\t\t\tactiveBlock?.onClickOut();\n\t\t});\n\t\tthis.#api = new Api();\n\t\tthis.#lastContainerSize = {\n\t\t\twidth: 0,\n\t\t\theight: 0,\n\t\t};\n\t}\n\n\tinitPagesRect()\n\t{\n\t\tlet top = 0;\n\t\tconst pages = [...this.#documentLayout.querySelectorAll('.sign-editor__document_page img')];\n\t\tthis.#pagesRects = [];\n\t\tthis.#seams = [];\n\t\tconst content = document.querySelector('.sign-editor__content');\n\t\tpages.forEach(page => {\n\t\t\tconst pageRect = page.getBoundingClientRect();\n\t\t\tconst pageRectToMath = {};\n\n\t\t\t// round getBoundingClientRect\n\t\t\tfor (let pageRectKey in pageRect)\n\t\t\t{\n\t\t\t\tif (Type.isNumber(pageRect[pageRectKey]))\n\t\t\t\t{\n\t\t\t\t\tpageRectToMath[pageRectKey] = Math.round(pageRect[pageRectKey]);\n\t\t\t\t}\n\t\t\t\telse\n\t\t\t\t{\n\t\t\t\t\tpageRectToMath[pageRectKey] = pageRect[pageRectKey];\n\t\t\t\t}\n\t\t\t}\n\n\t\t\tconst topBound = top === 0 ? 0 : pageRectToMath.top - gapBetweenPages + content.scrollTop;\n\t\t\tconst bottomBound = pageRectToMath.top + marginTop + content.scrollTop;\n\t\t\t// collect seam's gaps\n\t\t\tthis.#seams.push([topBound, bottomBound]);\n\n\t\t\t// correct top after rounding\n\t\t\tif (top === 0)\n\t\t\t{\n\t\t\t\ttop = pageRectToMath.top;\n\t\t\t}\n\t\t\telse\n\t\t\t{\n\t\t\t\ttop += gapBetweenPages;\n\t\t\t\tpageRectToMath.top = top;\n\t\t\t}\n\n\t\t\t// collect pages rects\n\t\t\tthis.#pagesRects.push(pageRectToMath);\n\n\t\t\t// remember min page height\n\t\t\tif (!this.#pagesMinHeight || pageRect.height < this.#pagesMinHeight)\n\t\t\t{\n\t\t\t\tthis.#pagesMinHeight = pageRect.height;\n\t\t\t}\n\t\t});\n\t\tthis.#documentLayout.style.width = `${this.#documentLayout.offsetWidth}px`;\n\t}\n\n\t/**\n\t * Transfers absolute position to page position and sets page number.\n\t * @param {PositionType} position\n\t * @return {PositionType}\n\t */\n\ttransferPositionToPage(position: PositionType): PositionType\n\t{\n\t\tposition.page = 1;\n\n\t\tfor (\n\t\t\tlet i = 0,\n\t\t\t\tc = this.#pagesRects.length; i < c; i++\n\t\t)\n\t\t{\n\t\t\tconst height = this.#pagesRects[i].height;\n\n\t\t\tif (i !== 0) // skip gap for first page\n\t\t\t{\n\t\t\t\tposition.top -= gapBetweenPages;\n\t\t\t}\n\n\t\t\tposition.top -= height;\n\t\t\tif (position.top < 0)\n\t\t\t{\n\t\t\t\tposition.top += height;\n\t\t\t\tbreak;\n\t\t\t}\n\t\t\telse\n\t\t\t{\n\t\t\t\tposition.page++;\n\t\t\t}\n\t\t}\n\n\t\treturn position;\n\t}\n\n\t/**\n\t * Transfers pixel of position to percent.\n\t * @param {PositionType} position\n\t * @return {PositionType}\n\t */\n\t#pixelToPercent(position: PositionType, pageRect): PositionType\n\t{\n\t\tposition.widthPx = position.width;\n\t\tposition.heightPx = position.height;\n\t\tposition.left = position.left * 100 / pageRect.width;\n\t\tposition.top = position.top * 100 / pageRect.height;\n\t\tposition.width = position.width / pageRect.width * 100;\n\t\tposition.height = position.height / pageRect.height * 100;\n\n\t\treturn position;\n\t}\n\n\t/**\n\t * Transfers percent of position to pixel.\n\t * @param {PositionType} position\n\t * @return {PositionType}\n\t */\n\t#percentToPixel(position: PositionType): PositionType\n\t{\n\t\tif (!position.page || typeof this.#pagesRects[position.page - 1] === 'undefined')\n\t\t{\n\t\t\treturn position;\n\t\t}\n\n\t\tconst pageImageRect = this.#pagesRects[position.page - 1];\n\t\tconst pixelPosition = {};\n\n\t\tif (typeof position.left === 'number')\n\t\t{\n\t\t\tpixelPosition.left = position.left * pageImageRect.width / 100;\n\t\t}\n\t\tif (typeof position.top === 'number')\n\t\t{\n\t\t\tlet top = position.top * pageImageRect.height / 100;\n\t\t\tlet pageNum = 0;\n\t\t\twhile (pageNum < position.page - 1)\n\t\t\t{\n\t\t\t\ttop += this.#pagesRects[pageNum].height + gapBetweenPages;\n\t\t\t\tpageNum++;\n\t\t\t}\n\n\t\t\tpixelPosition.top = top;\n\t\t}\n\t\tif (typeof position.width === 'number')\n\t\t{\n\t\t\tpixelPosition.width = position.width * pageImageRect.width / 100;\n\t\t}\n\t\tif (typeof position.height === 'number')\n\t\t{\n\t\t\tpixelPosition.height = position.height * pageImageRect.height / 100;\n\t\t}\n\n\t\treturn pixelPosition;\n\t}\n\n\t/**\n\t * Returns minimal pages height.\n\t * @return {number}\n\t */\n\tgetMinPageHeight(): number\n\t{\n\t\treturn this.#pagesMinHeight - marginTop;\n\t}\n\n\t/**\n\t * Returns document id.\n\t * @return {number}\n\t */\n\tgetDocumentId(): number\n\t{\n\t\treturn this.#documentId;\n\t}\n\n\tgetDocumentUid(): string\n\t{\n\t\treturn this.#documentUid;\n\t}\n\n\tsetEditorContent(editorContent: HTMLElement)\n\t{\n\t\tthis.resizeArea.setFullEditorContent(editorContent);\n\t}\n\n\tsetDocumentUid(documentUid: string): BlocksManager\n\t{\n\t\tthis.#documentUid = documentUid;\n\t\treturn this;\n\t}\n\n\t/**\n\t * Returns document entity id.\n\t * @return {number}\n\t */\n\tgetEntityId(): number\n\t{\n\t\treturn this.#entityId;\n\t}\n\n\t/**\n\t * Returns document's layout.\n\t * @return {HTMLElement}\n\t */\n\tgetLayout(): HTMLElement\n\t{\n\t\treturn this.#documentLayout;\n\t}\n\n\t/**\n\t * Returns number pairs (seams between pages).\n\t * @return {Array<Array<number, number>>}\n\t */\n\tgetSeams(): Array<Array<number, number>>\n\t{\n\t\treturn this.#seams;\n\t}\n\n\t/**\n\t * Returns gap between pages.\n\t * @return {number}\n\t */\n\tgetPagesGap(): number\n\t{\n\t\treturn gapBetweenPages + marginTop;\n\t}\n\n\taddMembers(members: Array<MemberItem>)\n\t{\n\t\tthis.#members = members;\n\t}\n\n\t/**\n\t * Returns document's members\n\t * @return {Array<MemberItem>}\n\t */\n\tgetMembers(): Array<MemberItem>\n\t{\n\t\treturn this.#members;\n\t}\n\n\t/**\n\t * Returns member item by member part.\n\t * @param {number} part\n\t * @return {null}\n\t */\n\tgetMemberByPart(part: number): ?MemberItem\n\t{\n\t\tlet returnMember = null;\n\n\t\tthis.#members.map((member: MemberItem) => {\n\t\t\tif (member.part === part)\n\t\t\t{\n\t\t\t\treturnMember = member;\n\t\t\t}\n\t\t});\n\n\t\treturn returnMember;\n\t}\n\n\t/**\n\t * Returns company id.\n\t * @return {number}\n\t */\n\tgetCompanyId(): number\n\t{\n\t\treturn this.#companyId;\n\t}\n\n\t/**\n\t * @return {string}\n\t */\n\tgetInitiatorName(): string\n\t{\n\t\treturn this.#initiatorName;\n\t}\n\n\t/**\n\t * Returns Config object.\n\t * @return {Config}\n\t */\n\tgetConfig(): Config\n\t{\n\t\treturn this.#config;\n\t}\n\n\t/**\n\t * Hides resizing area.\n\t */\n\thideResizeArea()\n\t{\n\t\tthis.resizeArea.hide();\n\t}\n\n\t/**\n\t * Shows resizing area over the block.\n\t * @param {Block} block\n\t */\n\tshowResizeArea(block: Block)\n\t{\n\t\tthis.resizeArea.show(block);\n\t}\n\n\t/**\n\t * Mutes resizing area.\n\t */\n\tmuteResizeArea()\n\t{\n\t\tthis.resizeArea.getLayout().setAttribute('data-disable', 1);\n\t}\n\n\t/**\n\t * Unmutes resizing area.\n\t */\n\tunMuteResizeArea()\n\t{\n\t\tthis.resizeArea.getLayout().removeAttribute('data-disable');\n\t}\n\n\t/**\n\t * Adds block to the document.\n\t * @param {BlockItem} data Block data.\n\t * @param {boolean} seamShift If true, will be added seam shift to top's position.\n\t * @return {Block}\n\t */\n\t#addBlock(data: BlockItem, seamShift: boolean): Block\n\t{\n\t\tconst position = data.position ? this.#percentToPixel(data.position) : null;\n\t\tconst newBlock = new Block({\n\t\t\tid: data.id,\n\t\t\tcode: data.code,\n\t\t\tparty: data.party,\n\t\t\tblocksManager: this,\n\t\t\tdata: data.data,\n\t\t\tposition,\n\t\t\tstyle: data.style,\n\t\t\tonClick: (block: Block) => {\n\t\t\t\tif (this.#disableEdit)\n\t\t\t\t{\n\t\t\t\t\treturn;\n\t\t\t\t}\n\t\t\t\tthis.resizeArea.show(block);\n\t\t\t\tthis.unMuteResizeArea();\n\t\t\t\tblock.adjustActionsPanel();\n\t\t\t},\n\t\t\tonRemove: (block: Block) => {\n\t\t\t\tthis.resizeArea.hide();\n\t\t\t},\n\t\t});\n\t\tconst blockLayout = newBlock.getLayout();\n\n\t\tif (['sign', 'mysign'].includes(newBlock.getCode()))\n\t\t{\n\t\t\tconst colorChangeListener = (event) => this.#onBlockColorStyleChange(newBlock, event);\n\t\t\tthis.#blocksColorChangeListeners.set(newBlock, colorChangeListener);\n\n\t\t\tnewBlock.subscribe(\n\t\t\t\tnewBlock.events.onColorStyleChange,\n\t\t\t\tcolorChangeListener,\n\t\t\t);\n\t\t\tconst existedSignBlock: Block | undefined = this.#blocks.find(block => block.getCode() === newBlock.getCode());\n\t\t\tconst signColor: string | undefined = existedSignBlock?.getStyle?.()?.color;\n\t\t\tif (!Type.isNil(signColor))\n\t\t\t{\n\t\t\t\tnewBlock.updateColor(signColor, false);\n\t\t\t}\n\t\t}\n\n\t\tthis.#blocks.push(newBlock);\n\n\t\tDom.append(blockLayout, this.#documentLayout);\n\n\t\treturn newBlock;\n\t}\n\n\t/**\n\t * Fires on click repository item.\n\t * @param {string} code Block code.\n\t * @param {string} part Member part (base - my company, other - third part).\n\t */\n\t#onRepositoryItemClick(code: string, party: number)\n\t{\n\t\tparty = parseInt(party);\n\t\tthis.setSavingMark(false);\n\n\t\tconst block = this.#addBlock({ code, party });\n\t\tblock.assign();\n\t\tblock.onPlaced();\n\t}\n\n\t/**\n\t * Sets exists blocks to the document.\n\t * @param blocks\n\t */\n\tinitBlocks(blocks: Array<BlockItem>)\n\t{\n\t\tthis.#blocks = [];\n\t\tfor (const [block, subscription] of this.#blocksColorChangeListeners.entries())\n\t\t{\n\t\t\tblock.unsubscribe(block.events.onColorStyleChange, subscription);\n\t\t}\n\t\tthis.#blocksColorChangeListeners.clear();\n\n\t\tthis.hideResizeArea();\n\t\tblocks.map(block => this.#addBlock(block, true));\n\t}\n\n\tinitRepository(repositoryItems: NodeList)\n\t{\n\t\t[...repositoryItems].forEach((item: HTMLElement) => {\n\n\t\t\tconst code = item.getAttribute('data-code');\n\t\t\tconst part = item.getAttribute('data-part');\n\n\t\t\tEvent.bind(item, 'click', e => {\n\t\t\t\tthis.#onRepositoryItemClick(code, part);\n\t\t\t\te.preventDefault();\n\t\t\t});\n\t\t});\n\t}\n\n\t/**\n\t * Returns blocks collection.\n\t * @return {Array<Block>}\n\t */\n\tgetBlocks(): Array<Block>\n\t{\n\t\treturn this.#blocks;\n\t}\n\n\t/**\n\t * Saves document and closes slider.\n\t * @return {Promise}\n\t */\n\tsave(): Promise<any, any>\n\t{\n\t\tconst postData = [];\n\n\t\tconst realDocumentWidth = document.querySelector('.sign-editor__document').offsetWidth;\n\n\t\tthis.#blocks.map(block => {\n\n\t\t\tif (block.isRemoved())\n\t\t\t{\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\tconst blockLayout = block.getLayout();\n\t\t\tconst blockRect = blockLayout.getBoundingClientRect();\n\t\t\tconst pages = [...this.#documentLayout.querySelectorAll('.sign-editor__document_page img')];\n\t\t\tconst pagesRect = pages.map((page) => {\n\t\t\t\tconst { top, left, width, height } = page.getBoundingClientRect();\n\n\t\t\t\treturn {\n\t\t\t\t\ttop,\n\t\t\t\t\tleft,\n\t\t\t\t\twidth,\n\t\t\t\t\theight,\n\t\t\t\t};\n\t\t\t});\n\t\t\tconst nextPageRect = pagesRect.find((pageRect) => {\n\t\t\t\tif (Math.round(blockRect.top) < Math.round(pageRect.top))\n\t\t\t\t{\n\t\t\t\t\treturn true;\n\t\t\t\t}\n\n\t\t\t\treturn false;\n\t\t\t});\n\t\t\tconst pageNum = nextPageRect ? pagesRect.indexOf(nextPageRect) : pagesRect.length;\n\t\t\tconst currentPageRect = pagesRect[pageNum - 1];\n\t\t\tlet position = {\n\t\t\t\ttop: blockRect.top - currentPageRect.top,\n\t\t\t\tleft: blockRect.left - currentPageRect.left,\n\t\t\t\twidth: blockRect.width,\n\t\t\t\theight: blockRect.height,\n\t\t\t\tpage: pageNum,\n\t\t\t};\n\t\t\tposition = this.#pixelToPercent(position, currentPageRect);\n\t\t\tposition.realDocumentWidthPx = realDocumentWidth ? realDocumentWidth : null;\n\t\t\tconst code = block.getCode();\n\t\t\tlet type = 'text';\n\t\t\tswitch (code)\n\t\t\t{\n\t\t\t\tcase 'stamp':\n\t\t\t\tcase 'mystamp':\n\t\t\t\tcase 'sign':\n\t\t\t\tcase 'mysign':\n\t\t\t\t\ttype = 'image';\n\t\t\t}\n\t\t\tpostData.push({\n\t\t\t\tid: block.getId(),\n\t\t\t\tcode: block.getCode(),\n\t\t\t\tdata: block.getData(),\n\t\t\t\tparty: block.getMemberPart(),\n\t\t\t\tstyle: block.getStyle(),\n\t\t\t\tposition,\n\t\t\t\ttype,\n\t\t\t});\n\t\t});\n\n\t\tconst params = {};\n\t\tif (this.#closeDemoContent)\n\t\t{\n\t\t\tparams['closeDemoContent'] = true;\n\t\t}\n\t\tthis.hideResizeArea();\n\n\t\treturn this.#api.saveBlank(\n\t\t\tthis.getDocumentUid(),\n\t\t\tpostData.length > 0 ? postData : [],\n\t\t).then((response) => {\n\n\t\t\tif (!('errors' in response))\n\t\t\t{\n\t\t\t\treturn postData;\n\t\t\t}\n\n\t\t\tif (response.errors[0].customData?.field === 'requisites')\n\t\t\t{\n\t\t\t\tconst popup = new Popup({\n\t\t\t\t\tid: 'sign_document_error_popup',\n\t\t\t\t\ttitleBar: Loc.getMessage('SIGN_JS_DOCUMENT_REQUISITES_RESTORE_TITLE'),\n\t\t\t\t\tcontent: BX.util.htmlspecialchars(response.errors[0]?.message),\n\t\t\t\t\tbuttons: [\n\t\t\t\t\t\tnew Button({\n\t\t\t\t\t\t\ttext: Loc.getMessage('SIGN_JS_DOCUMENT_REQUISITES_RESTORE'),\n\t\t\t\t\t\t\tcolor: ButtonColor.SUCCESS,\n\t\t\t\t\t\t\tonclick: ({ button }) => {\n\t\t\t\t\t\t\t\tconst target = button;\n\t\t\t\t\t\t\t\tDom.addClass(target, 'ui-btn-wait');\n\t\t\t\t\t\t\t\tBackend.controller({\n\t\t\t\t\t\t\t\t\tcommand: 'document.restoreRequisiteFields',\n\t\t\t\t\t\t\t\t\tpostData: {\n\t\t\t\t\t\t\t\t\t\tdocumentId: this.#documentId,\n\t\t\t\t\t\t\t\t\t\tpresetId: response.errors[0]?.customData.presetId,\n\t\t\t\t\t\t\t\t\t\tcode: response.errors[0]?.customData.code,\n\t\t\t\t\t\t\t\t\t},\n\t\t\t\t\t\t\t\t}).then(() => {\n\t\t\t\t\t\t\t\t\tDom.removeClass(target, 'ui-btn-wait');\n\n\t\t\t\t\t\t\t\t\tthis.#blocks.map((block) => {\n\t\t\t\t\t\t\t\t\t\tif (block.isRemoved())\n\t\t\t\t\t\t\t\t\t\t{\n\t\t\t\t\t\t\t\t\t\t\treturn;\n\t\t\t\t\t\t\t\t\t\t}\n\n\t\t\t\t\t\t\t\t\t\tif (block.getCode() === response.errors[0]?.customData.code)\n\t\t\t\t\t\t\t\t\t\t{\n\t\t\t\t\t\t\t\t\t\t\tblock.assign();\n\t\t\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\t\t});\n\t\t\t\t\t\t\t\t\tpopup.destroy();\n\t\t\t\t\t\t\t\t}).catch(() => {\n\t\t\t\t\t\t\t\t\tpopup.destroy();\n\t\t\t\t\t\t\t\t});\n\t\t\t\t\t\t\t},\n\t\t\t\t\t\t}),\n\t\t\t\t\t\tnew Button({\n\t\t\t\t\t\t\ttext: Loc.getMessage('SIGN_JS_DOCUMENT_REQUISITES_RESTORE_BY_HANDS'),\n\t\t\t\t\t\t\tcolor: ButtonColor.INFO,\n\t\t\t\t\t\t\tonclick: () => {\n\t\t\t\t\t\t\t\tthis.#blocks.map((block) => {\n\t\t\t\t\t\t\t\t\tif (block.isRemoved())\n\t\t\t\t\t\t\t\t\t{\n\t\t\t\t\t\t\t\t\t\treturn;\n\t\t\t\t\t\t\t\t\t}\n\n\t\t\t\t\t\t\t\t\tif (block.getCode() === response.errors[0]?.customData.code)\n\t\t\t\t\t\t\t\t\t{\n\t\t\t\t\t\t\t\t\t\tconst blockActionButton = document.querySelector(\n\t\t\t\t\t\t\t\t\t\t\t`button[data-id=\"action-${block.getCode()}]`,\n\t\t\t\t\t\t\t\t\t\t);\n\n\t\t\t\t\t\t\t\t\t\tif (blockActionButton)\n\t\t\t\t\t\t\t\t\t\t{\n\t\t\t\t\t\t\t\t\t\t\tblockActionButton.click();\n\t\t\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\t});\n\t\t\t\t\t\t\t\tpopup.destroy();\n\t\t\t\t\t\t\t},\n\t\t\t\t\t\t}),\n\t\t\t\t\t],\n\t\t\t\t});\n\t\t\t\tpopup.show();\n\n\t\t\t\treturn null;\n\t\t\t}\n\n\t\t\tconst firstError = response.errors[0];\n\t\t\tif (firstError.code === 'REFERENCE_ERROR_FIELD_NOT_SELECTED')\n\t\t\t{\n\t\t\t\tthis.#highlightInvalidBlocks();\n\t\t\t\tconst popup = new Popup({\n\t\t\t\t\tid: 'sign_document_error_popup',\n\t\t\t\t\ttitleBar: Loc.getMessage('SIGN_EDITOR_ERROR_SAVE_REFERENCE_BACK_TITLE'),\n\t\t\t\t\tcontent: BX.util.htmlspecialchars(firstError.message),\n\t\t\t\t\tbuttons: [\n\t\t\t\t\t\tnew Button({\n\t\t\t\t\t\t\ttext: Loc.getMessage('SIGN_EDITOR_ERROR_SAVE_REFERENCE_BACK'),\n\t\t\t\t\t\t\tcolor: ButtonColor.PRIMARY,\n\t\t\t\t\t\t\tonclick: () => {\n\t\t\t\t\t\t\t\tpopup.destroy();\n\t\t\t\t\t\t\t},\n\t\t\t\t\t\t}),\n\t\t\t\t\t],\n\t\t\t\t});\n\t\t\t\tEventEmitter.subscribeOnce('SidePanel.Slider:onCloseComplete', () => {\n\t\t\t\t\tpopup.destroy();\n\t\t\t\t});\n\t\t\t\tpopup.show();\n\n\t\t\t\treturn null;\n\t\t\t}\n\n\t\t\treturn postData;\n\t\t});\n\t}\n\n\t/**\n\t * Registers save button.\n\t * @param {DocumentOptions} options\n\t */\n\tonSave(options: DocumentOptions)\n\t{\n\t\tEvent.bind(options.saveButton, 'click', (e) => {\n\t\t\tif (this.#disableEdit)\n\t\t\t{\n\t\t\t\tif (options.afterSaveCallback)\n\t\t\t\t{\n\t\t\t\t\toptions.afterSaveCallback();\n\t\t\t\t}\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\tthis.save()\n\t\t\t\t.then(result => {\n\t\t\t\t\t//todo: we need to parse response and sets id for each new block\n\t\t\t\t\tif (result === true)\n\t\t\t\t\t{\n\t\t\t\t\t\tthis.setSavingMark(true);\n\n\t\t\t\t\t\tif (options.afterSaveCallback)\n\t\t\t\t\t\t{\n\t\t\t\t\t\t\toptions.afterSaveCallback();\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\n\t\t\t\t\tif (result !== true)\n\t\t\t\t\t{\n\t\t\t\t\t\tif (options.saveErrorCallback)\n\t\t\t\t\t\t{\n\t\t\t\t\t\t\toptions.saveErrorCallback();\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t});\n\t\t});\n\t}\n\n\t/**\n\t * Registers callback on slider close.\n\t */\n\tonCloseSlider()\n\t{\n\t\tBX.addCustomEvent('SidePanel.Slider:onClose', (event) => {\n\t\t\tif (event.slider.url.indexOf('/sign/edit/') === 0)\n\t\t\t{\n\t\t\t\tif (!this.everythingIsSaved())\n\t\t\t\t{\n\t\t\t\t\tevent.denyAction();\n\n\t\t\t\t\tMessageBox.confirm(\n\t\t\t\t\t\tLoc.getMessage('SIGN_JS_DOCUMENT_SAVE_ALERT_MESSAGE'),\n\t\t\t\t\t\tLoc.getMessage('SIGN_JS_DOCUMENT_SAVE_ALERT_TITLE'),\n\t\t\t\t\t\t(messageBox: MessageBox) => {\n\t\t\t\t\t\t\tthis.setSavingMark(true);\n\t\t\t\t\t\t\tmessageBox.close();\n\t\t\t\t\t\t\tevent.slider.close();\n\t\t\t\t\t\t},\n\t\t\t\t\t\tLoc.getMessage('SIGN_JS_DOCUMENT_SAVE_ALERT_APPLY'),\n\t\t\t\t\t\t(messageBox: MessageBox) => {\n\t\t\t\t\t\t\tmessageBox.close();\n\t\t\t\t\t\t},\n\t\t\t\t\t);\n\t\t\t\t}\n\t\t\t}\n\t\t});\n\t}\n\n\t/**\n\t * Sets mark to document that everything was saved or not.\n\t * @param {boolean} mark\n\t */\n\tsetSavingMark(mark: boolean)\n\t{\n\t\tthis.setParam('bxSignEditorAllSaved', mark);\n\t}\n\n\t/**\n\t * Returns true, if everything was saved within editor.\n\t * @return {boolean}\n\t */\n\teverythingIsSaved(): boolean\n\t{\n\t\treturn this.getParam('bxSignEditorAllSaved') === true;\n\t}\n\n\tsetParam(name: string, value: any): void\n\t{\n\t\tconst slider = BX.SidePanel.Instance.getSliderByWindow(window);\n\t\tif (slider)\n\t\t{\n\t\t\tslider.getData().set(name, value);\n\t\t}\n\t}\n\n\tgetParam(name: string): any\n\t{\n\t\tconst slider = BX.SidePanel.Instance.getSliderByWindow(window);\n\t\tif (slider)\n\t\t{\n\t\t\treturn slider.getData().get(name);\n\t\t}\n\n\t\treturn undefined;\n\t}\n\n\t/**\n\t * Returns true if element with specified top & bottom over dead zone.\n\t * @param {number} top\n\t * @param {number} bottom\n\t * @param {boolean} notAddMargin\n\t * @return {boolean}\n\t */\n\tinDeadZone(top: number, bottom: number, notAddMargin: boolean): boolean\n\t{\n\t\tconst seams = this.getSeams();\n\t\tconst content = document.querySelector('.sign-editor__content');\n\t\ttop += content.scrollTop;\n\t\tbottom += content.scrollTop;\n\t\tif (seams.length > 0 && notAddMargin !== true)\n\t\t{\n\t\t\tconst documentLayoutRect = this.#documentLayout.getBoundingClientRect();\n\t\t\ttop += documentLayoutRect.top;\n\t\t\tbottom += documentLayoutRect.top;\n\t\t}\n\n\t\tfor (\n\t\t\tlet ii = 0,\n\t\t\t\tcc = seams.length; ii < cc; ii++\n\t\t)\n\t\t{\n\t\t\tconst seam = seams[ii];\n\n\t\t\t// top on page, bottom on seam\n\t\t\tif (top <= seam[0] && bottom >= seam[0] && bottom <= seam[1])\n\t\t\t{\n\t\t\t\treturn seam[0] - bottom;\n\t\t\t}\n\n\t\t\t// top on one page, bottom on another (seam in a middle)\n\t\t\tif (top <= seam[0] && bottom >= seam[1])\n\t\t\t{\n\t\t\t\t//seam[0] - bottom >> shift top\n\t\t\t\t//seam[1] - top >> shift bottom\n\t\t\t\treturn seam[0] - bottom;\n\t\t\t}\n\n\t\t\t// block into a seam\n\t\t\tif (top >= seam[0] && bottom <= seam[1])\n\t\t\t{\n\t\t\t\treturn seam[0] - bottom;\n\t\t\t}\n\n\t\t\t// top on seam, bottom on page\n\t\t\tif (top >= seam[0] && top <= seam[1] && bottom >= seam[1])\n\t\t\t{\n\t\t\t\treturn seam[1] - top;\n\t\t\t}\n\n\t\t}\n\n\t\treturn 0;\n\t}\n\n\t#startDisabledEditDocumentTour()\n\t{\n\t\tconst guide = new Guide({\n\t\t\tsteps: [\n\t\t\t\t{\n\t\t\t\t\ttarget: document.getElementById('sign-editor-btn-edit'),\n\t\t\t\t\ttitle: Loc.getMessage('SIGN_JS_DOCUMENT_TOUR_BTN_EDIT_TITLE'),\n\t\t\t\t\ttext: Loc.getMessage('SIGN_JS_DOCUMENT_TOUR_BTN_EDIT_TEXT'),\n\t\t\t\t},\n\t\t\t],\n\t\t\tid: 'sign-tour-guide-onboarding-master-document-edit-disabled',\n\t\t\tautoSave: true,\n\t\t\tsimpleMode: true,\n\t\t});\n\t\tguide.startOnce();\n\t}\n\n\t#startEditDocumentTour()\n\t{\n\t\tconst helpBtnSpotlight = new BX.SpotLight({\n\t\t\ttargetElement: document.getElementById(this.#helpBtnElementId),\n\t\t\ttargetVertex: 'middle-center',\n\t\t\tautoSave: true,\n\t\t\tid: 'sign-spotlight-onboarding-master-document-edit',\n\t\t});\n\n\t\tconst guide = new Guide({\n\t\t\tsteps: [\n\t\t\t\t{\n\t\t\t\t\ttarget: document.getElementById('sign-editor-bar-content'),\n\t\t\t\t\ttitle: Loc.getMessage('SIGN_JS_DOCUMENT_TOUR_BTN_BLOCKS_TITLE'),\n\t\t\t\t\ttext: Loc.getMessage('SIGN_JS_DOCUMENT_TOUR_BTN_BLOCKS_TEXT'),\n\t\t\t\t\tposition: 'left',\n\t\t\t\t},\n\t\t\t\t{\n\t\t\t\t\ttarget: document.getElementById(this.#helpBtnElementId),\n\t\t\t\t\ttitle: Loc.getMessage('SIGN_JS_DOCUMENT_TOUR_BTN_HELP_TITLE'),\n\t\t\t\t\ttext: Loc.getMessage('SIGN_JS_DOCUMENT_TOUR_BTN_HELP_TEXT'),\n\t\t\t\t\trounded: true,\n\t\t\t\t\tarticle: this.#helpBtnHelperArticleCode,\n\t\t\t\t\tevents: {\n\t\t\t\t\t\tonShow: () => helpBtnSpotlight.show(),\n\t\t\t\t\t\tonClose: () => helpBtnSpotlight.close(),\n\t\t\t\t\t},\n\t\t\t\t},\n\t\t\t],\n\t\t\tid: 'sign-tour-guide-onboarding-master-document-edit',\n\t\t\tautoSave: true,\n\t\t\tsimpleMode: true,\n\t\t});\n\t\tguide.startOnce();\n\t}\n\n\t#highlightInvalidBlocks()\n\t{\n\t\tthis.#blocks.forEach((block) => {\n\t\t\tif (block.isRemoved())\n\t\t\t{\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\tconst code = block.getCode();\n\t\t\tconst isCRM = code === 'reference' || code === 'myreference';\n\t\t\tif (isCRM && Type.isArray(block.getData()))\n\t\t\t{\n\t\t\t\tDom.addClass(block.getLayout(), '--invalid');\n\t\t\t}\n\t\t});\n\t}\n\n\t#onBlockColorStyleChange(updatedBlock: Block, event: BaseEvent)\n\t{\n\t\tif (!['sign', 'mysign'].includes(updatedBlock.getCode()))\n\t\t{\n\t\t\treturn;\n\t\t}\n\n\t\tconst newColor: string | null = event.getData().color ?? null;\n\t\tif (Type.isNull(newColor))\n\t\t{\n\t\t\treturn;\n\t\t}\n\n\t\tthis.#blocks\n\t\t\t.filter((block) => updatedBlock.getCode() === block.getCode())\n\t\t\t.forEach((block) => {\n\t\t\t\tif (updatedBlock === block)\n\t\t\t\t{\n\t\t\t\t\treturn;\n\t\t\t\t}\n\n\t\t\t\tblock.updateColor(newColor, false);\n\t\t\t})\n\t\t;\n\t}\n}\n","import { Tag, Reflection, Loc, Dom } from 'main.core';\nimport { BlocksManager } from './blocks/blocksManager';\nimport { EventEmitter } from 'main.core.events';\nimport './style.css';\n\nconst buttonClassList = [\n\t'ui-btn',\n\t'ui-btn-sm',\n\t'ui-btn-round',\n\t'ui-btn-light-border'\n];\nconst firstPartyBlocks = {\n\tmyreference: {\n\t\ttitle: 'SIGN_EDITOR_BLOCK_CRM',\n\t\thint: 'SIGN_EDITOR_BLOCK_CRM_HINT'\n\t},\n\tmyrequisites: {\n\t\ttitle: 'SIGN_EDITOR_BLOCK_REQUISITES',\n\t\thint: 'SIGN_EDITOR_BLOCK_FIRST_PARTY_REQUISITES_HINT'\n\t},\n\tmysign: {\n\t\ttitle: 'SIGN_EDITOR_BLOCK_SIGNATURE',\n\t\thint: 'SIGN_EDITOR_BLOCK_FIRST_PARTY_SIGNATURE_HINT'\n\t},\n\tmystamp: {\n\t\ttitle: 'SIGN_EDITOR_BLOCK_STAMP_MSGVER_1',\n\t\thint: 'SIGN_EDITOR_BLOCK_FIRST_PARTY_STAMP_HINT'\n\t}\n};\nconst partnerBlocks = {\n\treference: { ...firstPartyBlocks.myreference },\n\trequisites: {\n\t\t...firstPartyBlocks.myrequisites,\n\t\thint: 'SIGN_EDITOR_BLOCK_PARTNER_REQUISITES_HINT'\n\t},\n\tsign: {\n\t\t...firstPartyBlocks.mysign,\n\t\thint: 'SIGN_EDITOR_BLOCK_PARTNER_SIGNATURE_HINT'\n\t},\n\tstamp: {\n\t\t...firstPartyBlocks.mystamp,\n\t\thint: 'SIGN_EDITOR_BLOCK_PARTNER_STAMP_HINT'\n\t}\n};\nconst generalBlocks = {\n\ttext: {\n\t\ttitle: 'SIGN_EDITOR_BLOCK_TEXT',\n\t\thint: 'SIGN_EDITOR_BLOCK_TEXT_HINT'\n\t},\n\tdate: {\n\t\ttitle: 'SIGN_EDITOR_BLOCK_DATE',\n\t\thint: 'SIGN_EDITOR_BLOCK_DATE_HINT'\n\t},\n\tnumber: {\n\t\ttitle: 'SIGN_EDITOR_BLOCK_NUMBER',\n\t\thint: 'SIGN_EDITOR_BLOCK_NUMBER_HINT'\n\t}\n};\nconst sections = [\n\t{\n\t\ttitle: 'SIGN_EDITOR_BLOCKS_FIRST_PARTY',\n\t\tblocks: firstPartyBlocks,\n\t\tpart: 1\n\t},\n\t{\n\t\ttitle: 'SIGN_EDITOR_BLOCKS_PARTNER',\n\t\tblocks: partnerBlocks,\n\t\tpart: 2\n\t},\n\t{\n\t\ttitle: 'SIGN_EDITOR_BLOCKS_GENERAL',\n\t\tblocks: generalBlocks,\n\t\tpart: 0\n\t}\n];\nconst helpArticleCode = '16571388';\n\nexport class Editor extends EventEmitter\n{\n\t#sidePanel: BX.SidePanel;\n\t#closeSidePanel: Function;\n\t#dom: HTMLElement;\n\t#documentLayout: HTMLElement;\n\t#blocksManager: BlocksManager;\n\turls: string[];\n\t#popupHint: BX.UI.Hint;\n\n\tconstructor()\n\t{\n\t\tsuper();\n\t\tthis.setEventNamespace('BX.Sign.V2.Editor');\n\t\tconst { Instance } = Reflection.getClass('BX.SidePanel');\n\t\tthis.#sidePanel = Instance;\n\t\tthis.#dom = Tag.render`<div class=\"sign-wizard__scope sign-editor\"></div>`;\n\t\tthis.#documentLayout = Tag.render`\n\t\t\t<div class=\"sign-editor__document\"></div>\n\t\t`;\n\t\tthis.#blocksManager = new BlocksManager({\n\t\t\tdocumentLayout: this.#documentLayout,\n\t\t\tdisableEdit: false\n\t\t});\n\t\tconst Hint = Reflection.getClass('BX.UI.Hint');\n\t\tthis.#popupHint = Hint?.createInstance({\n\t\t\tpopupParameters: {\n\t\t\t\tautoHide: true,\n\t\t\t\tbindOptions: { position: 'top' },\n\t\t\t\tangle: { position: 'bottom' }\n\t\t\t}\n\t\t});\n\t}\n\n\tset entityData(entityData)\n\t{\n\t\tconst members = Object.values(entityData).map((member) => {\n\t\t\tconst {\n\t\t\t\tid: cid,\n\t\t\t\ttitle: name,\n\t\t\t\tpart,\n\t\t\t\tpresetId,\n\t\t\t\tentityTypeId,\n\t\t\t\tuid\n\t\t\t} = member;\n\n\t\t\treturn {\n\t\t\t\tcid,\n\t\t\t\tname,\n\t\t\t\tpart,\n\t\t\t\tpresetId,\n\t\t\t\tentityTypeId,\n\t\t\t\tuid\n\t\t\t};\n\t\t});\n\t\tthis.#blocksManager.addMembers(members);\n\t}\n\n\tasync renderDocument()\n\t{\n\t\tDom.clean(this.#documentLayout);\n\t\tif (this.urls.length === 0)\n\t\t{\n\t\t\treturn;\n\t\t}\n\n\t\tconst { uid = '', isTemplate } = this.documentData;\n\t\t!isTemplate ? this.#toggleEditMode(true) : this.#toggleEditMode(false);\n\t\tthis.#blocksManager.setDocumentUid(uid);\n\t\tconst { promises, fragment } = this.urls.reduce((acc, url) => {\n\t\t\tconst { fragment, promises } = acc;\n\t\t\tconst promise = new Promise((resolve) => {\n\t\t\t\tconst page = Tag.render`\n\t\t\t\t\t<div class=\"sign-editor__document_page\">\n\t\t\t\t\t\t<img src=\"${url}\" onload=\"${resolve}\" />\n\t\t\t\t\t</div>\n\t\t\t\t`;\n\t\t\t\tDom.append(page, fragment);\n\t\t\t});\n\t\t\tpromises.push(promise);\n\n\t\t\treturn acc;\n\t\t}, {\n\t\t\tfragment: new DocumentFragment(),\n\t\t\tpromises: []\n\t\t});\n\t\tDom.append(fragment, this.#documentLayout);\n\t\tconst { resizeArea } = this.#blocksManager;\n\t\tDom.append(resizeArea.getLayout(), this.#documentLayout);\n\t\tawait Promise.all(promises);\n\t\tEventEmitter.unsubscribeAll('SidePanel.Slider:onOpenComplete');\n\t\tEventEmitter.subscribeOnce('SidePanel.Slider:onOpenComplete', (event) => {\n\t\t\tconst editorContent = this.#dom.querySelector('.sign-editor__content');\n\t\t\tif (editorContent)\n\t\t\t{\n\t\t\t\teditorContent.scrollTop = 0;\n\t\t\t}\n\t\t\tthis.#blocksManager.initPagesRect();\n\t\t\tthis.#blocksManager.initBlocks(this.documentData.blocks);\n\t\t});\n\t}\n\n\tshow()\n\t{\n\t\treturn new Promise((resolve) => {\n\t\t\tthis.#closeSidePanel = resolve;\n\t\t\tthis.#sidePanel.open('editor', {\n\t\t\t\tcontentCallback: () => {\n\t\t\t\t\tthis.#render();\n\t\t\t\t\treturn this.#dom;\n\t\t\t\t},\n\t\t\t\tevents: {\n\t\t\t\t\tonCloseComplete: () => this.#closeSidePanel()\n\t\t\t\t}\n\t\t\t});\n\t\t});\n\n\t\treturn this.promise;\n\t}\n\n\t#render()\n\t{\n\t\tDom.clean(this.#dom);\n\t\tDom.append(this.#createHeader(), this.#dom);\n\t\tDom.append(this.#createContent(), this.#dom);\n\t}\n\n\t#createHeader(): HTMLElement\n\t{\n\t\tconst editButtonClassName = [\n\t\t\t'sign-editor__header_edit-btn',\n\t\t\t...buttonClassList\n\t\t].join(' ');\n\t\tconst saveButtonClassName = [\n\t\t\t'ui-btn-success',\n\t\t\t...buttonClassList.slice(0, -1)\n\t\t].join(' ');\n\t\tconst editButtonTitle = Loc.getMessage('SIGN_EDITOR_EDIT');\n\t\tconst saveButtonTitle = Loc.getMessage('SIGN_EDITOR_SAVE');\n\n\t\treturn Tag.render`\n\t\t\t<div class=\"sign-editor__header\">\n\t\t\t\t<p class=\"sign-editor__header_title\">\n\t\t\t\t\t${Loc.getMessage('SIGN_EDITOR_EDITING')}\n\t\t\t\t</p>\n\t\t\t\t<div class=\"sign-editor__header_right\">\n\t\t\t\t\t<span\n\t\t\t\t\t\tonclick=\"${(event: PointerEvent) => {\n\t\t\t\t\t\t\tconst Helper = Reflection.getClass('BX.Helper');\n\t\t\t\t\t\t\tHelper.show('redirect=detail&code=' + helpArticleCode);\n\t\t\t\t\t\t}}\"\n\t\t\t\t\t\tclass=\"sign-editor__header_help\"\n\t\t\t\t\t></span>\n\t\t\t\t\t<span\n\t\t\t\t\t\tclass=\"${editButtonClassName}\"\n\t\t\t\t\t\ttitle=\"${editButtonTitle}\"\n\t\t\t\t\t\tonclick=\"${() => {\n\t\t\t\t\t\t\tthis.#toggleEditMode(true);\n\t\t\t\t\t\t}}\"\n\t\t\t\t\t>\n\t\t\t\t\t\t${editButtonTitle}\n\t\t\t\t\t</span>\n\t\t\t\t\t<span\n\t\t\t\t\t\tclass=\"${saveButtonClassName}\"\n\t\t\t\t\t\ttitle=\"${saveButtonTitle}\"\n\t\t\t\t\t\tonclick=\"${async ({ target }) => {\n\t\t\t\t\t\t\tDom.addClass(target, 'ui-btn-wait');\n\t\t\t\t\t\t\tconst blocks = await this.#blocksManager.save();\n\t\t\t\t\t\t\tDom.removeClass(target, 'ui-btn-wait');\n\t\t\t\t\t\t\tif (!blocks)\n\t\t\t\t\t\t\t{\n\t\t\t\t\t\t\t\treturn;\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\tEventEmitter.subscribeOnce('SidePanel.Slider:onCloseComplete', () => {\n\t\t\t\t\t\t\t\tthis.emit('save', { blocks });\n\t\t\t\t\t\t\t});\n\t\t\t\t\t\t\tthis.#sidePanel.close();\n\t\t\t\t\t\t\tthis.#toggleEditMode(false);\n\t\t\t\t\t\t}}\"\n\t\t\t\t\t>\n\t\t\t\t\t\t${saveButtonTitle}\n\t\t\t\t\t</span>\n\t\t\t\t</div>\n\t\t\t</div>\n\t\t`;\n\t}\n\n\t#createContent(): HTMLElement\n\t{\n\t\tconst editorContent = Tag.render`\n\t\t\t<div class=\"sign-editor__content\">\n\t\t\t\t<div class=\"sign-editor__document-container\">\n\t\t\t\t\t${this.#documentLayout}\n\t\t\t\t</div>\n\t\t\t\t${this.#createSections()}\n\t\t\t</div>\n\t\t`;\n\t\tthis.#blocksManager.setEditorContent(editorContent);\n\t\tthis.#popupHint.popupParameters = {\n\t\t\t...this.#popupHint.popupParameters,\n\t\t\ttargetContainer: editorContent\n\t\t};\n\n\t\treturn editorContent;\n\t}\n\n\t#createSections(): HTMLElement\n\t{\n\t\tconst sectionsNodes = sections.map((section) => {\n\t\t\tconst entries = Object.entries(section.blocks);\n\t\t\tconst blocks = entries.map(([code, block]) => {\n\t\t\t\tconst { title, hint } = block;\n\n\t\t\t\treturn Tag.render`\n\t\t\t\t\t<div\n\t\t\t\t\t\tclass=\"sign-editor__section_block\"\n\t\t\t\t\t\tdata-code=\"${code}\"\n\t\t\t\t\t\tdata-part=\"${section.part}\"\n\t\t\t\t\t>\n\t\t\t\t\t\t<span>\n\t\t\t\t\t\t\t<span>${Loc.getMessage(title)}</span>\n\t\t\t\t\t\t\t<span data-hint=\"${Loc.getMessage(hint)}\"></span>\n\t\t\t\t\t\t</span>\n\t\t\t\t\t\t<span class=\"sign-editor__section_add-block-btn\">\n\t\t\t\t\t\t\t${Loc.getMessage('SIGN_EDITOR_BLOCK_ADD_TO_DOCUMENT')}\n\t\t\t\t\t\t</span>\n\t\t\t\t\t</div>\n\t\t\t\t`;\n\t\t\t});\n\t\t\tthis.#blocksManager.initRepository(blocks);\n\n\t\t\treturn Tag.render`\n\t\t\t\t<div class=\"sign-editor__section\">\n\t\t\t\t\t<p class=\"sign-editor__section_title\">\n\t\t\t\t\t\t${Loc.getMessage(section.title)}\n\t\t\t\t\t</p>\n\t\t\t\t\t${blocks}\n\t\t\t\t</div>\n\t\t\t`;\n\t\t});\n\t\tconst layout = Tag.render`\n\t\t\t<div class=\"sign-editor__sections\">\n\t\t\t\t${sectionsNodes}\n\t\t\t</div>\n\t\t`;\n\t\tthis.#popupHint.init(layout);\n\n\t\treturn layout;\n\t}\n\n\t#toggleEditMode(isEdit: boolean)\n\t{\n\t\tif (isEdit)\n\t\t{\n\t\t\tDom.addClass(this.#dom, '--editable');\n\t\t\treturn;\n\t\t}\n\n\t\tDom.removeClass(this.#dom, '--editable');\n\t}\n}"],"names":["Dummy","EventEmitter","constructor","block","data","events","onChange","onColorStyleChange","setEventNamespace","isSingleton","isStyleAllowed","setData","setText","text","getInitDimension","width","height","getData","getActionButton","getBlockCaption","getViewContent","Tag","render","TextFormat","encode","toString","replaceAll","onStartChangePosition","onPlaced","onSave","onRemove","onClickOut","forceSave","emit","getStyles","changeStyleColor","color","defaultTextBlockPaddingStyles","padding","Date","onActionClick","BX","calendar","node","getLayout","field","value","bTime","callback_after","date","format","convertBitrixFormat","message","renderView","targetContainer","document","querySelector","popup","popupContainer","parentElement","Dom","append","adjustPosition","bind","Loc","getMessage","Close","MyRequisites","getCode","event","blocksManager","config","getConfig","stopPropagation","member","getMemberByPart","cid","entityTypeId","presetId","FieldsetViewer","entityId","onClose","assign","fieldListEditorOptions","fieldsPanelOptions","filter","controllerOptions","hideVirtual","hideRequisites","hideSmartDocument","show","ColorPicker","Reflection","getClass","UI","setRect","element","rect","Object","keys","map","key","parseInt","style","getBlockLayout","options","getMemberSelector","members","selectedValue","menuItems","selectedName","name","part","memberSelector","length","SignUI","bindSimpleMenu","bindElement","items","actionHandler","innerHTML","getResizeArea","getStylePanel","collectStyles","fonts","fontFamily","fontSizereal","fontSizeValue","fontSize","currentValue","layout","fontColor","getColorSelectorBtn","defaultColorPickerColor","onColorSelect","colorPickerOptions","updateColorSelectorBtnColor","updatedColorPickerOptions","onColorSelected","picker","Event","open","colorPicker","circleColor","Type","isNil","MySign","Cache","MemoryCache","getPosition","src","dataSrc","base64","getPlaceholderLabel","backgroundPosition","emitEvent","setSelectedColor","colorSelectorBtnLayout","close","remember","colors","allowCustomColor","selectedColor","colorPreview","MyStamp","Uploader","controller","upload","contact","id","label","subscribe","currentBlock","await","eventData","file","serverId","serverPreviewUrl","Api","__view","fileId","memberPart","getMemberPart","saveStamp","uid","Number","sliderOnMessageBind","addCustomEvent","window","isEditor","slider","url","getEventId","numeratorData","sender","type","api","getDocumentUid","refreshEntityNumber","crmNumeratorUrl","SidePanel","Instance","cacheable","Reference","isUndefined","Selector","className","then","removeClass","setTimeout","actionButton","defaultCaption","textContent","fieldSelector","get","fieldsList","getFieldsList","fields","CONTACT","FIELDS","SMART_DOCUMENT","find","caption","multiple","MyReference","COMPANY","blackList","some","blankListFieldName","Requisites","tagBody","Stamp","Sign","updateColor","Text","contentEditable","focus","getText","getContainer","content","innerText","range","createRange","selectNodeContents","collapse","selection","getSelection","removeAllRanges","addRange","Style","family","property","size","bold","button","state","italic","underline","through","left","group","center","right","justify","buttonPressed","applyStyles","removeAttribute","updateFontSize","styles","code","renderStyle","querySelectorAll","action","getAttribute","addClass","indexOf","Block","myrequisites","mysign","mystamp","number","reference","myreference","requisites","sign","stamp","blockContent","blockPanel","blockLoading","blockEditing","pageWithNotAllowed","party","onClick","Error","includes","isString","setPosition","position","top","getBoundingClientRect","Math","round","documentRect","getStyle","getId","showNotAllowedArea","page","transferPositionToPage","pageElement","hideNotAllowedArea","fireAction","onMemberSelect","flag","blockLayouts","push","currentCode","getBlocks","blockLayout","blocksData","blocksInstance","loadBlocksData","result","isArray","forEach","i","showResizeArea","catch","response","remove","contentTag","clean","toLowerCase","resizeNode","setProperty","observerReady","maxTextSize","parseFloat","isOverflownX","clientHeight","scrollHeight","parentNode","param","resizeText","target","step","minSize","unit","intervalTextResize","clearTimeout","overflow","parent","removeProperty","panelTag","allMembers","getMembers","selectedMembers","getCurrentFontSize","adjustActionsPanel","actionsPanel","actionsPanelRect","blockRect","a","b","detectBorder","marginLeft","click","isRemoved","hidden","unMuteResizeArea","hideResizeArea","setSavingMark","nodeForPosition","body","documentLayout","documentLayoutRect","blockInitDim","min","scrollTop","offsetHeight","inDeadZone","getPagesGap","Resize","resizeContainer","moveContainer","isDomNode","wrapperLayout","pointRect","display","setAttribute","wrapperLayoutRect","borderDelta","setFullEditorContent","editorContent","hide","getLinkedBlock","e","moving","resizing","initialRect","draggable","Draggable","container","DragAndDrop","HEADLESS","textResize","wrapper","positionLast","bottomResize","areaRect","wrapperRect","hasClass","max","offsetX","offsetY","newPosition","calcDeathTop","notAddDeathMargin","newPositionLinked","dragArea","widthInProcess","source","moveTopDelta","y","x","marginTop","gapBetweenPages","BlocksManager","Map","disableEdit","resizeArea","preventClickOut","closest","activeBlock","initPagesRect","pages","pageRect","pageRectToMath","pageRectKey","isNumber","topBound","bottomBound","offsetWidth","c","getMinPageHeight","getDocumentId","setEditorContent","setDocumentUid","documentUid","getEntityId","getSeams","addMembers","returnMember","getCompanyId","getInitiatorName","muteResizeArea","initBlocks","blocks","subscription","entries","unsubscribe","clear","initRepository","repositoryItems","item","preventDefault","save","postData","realDocumentWidth","pagesRect","nextPageRect","pageNum","currentPageRect","realDocumentWidthPx","saveBlank","errors","customData","Popup","titleBar","util","htmlspecialchars","buttons","Button","ButtonColor","SUCCESS","onclick","Backend","command","documentId","destroy","INFO","blockActionButton","firstError","PRIMARY","subscribeOnce","saveButton","afterSaveCallback","saveErrorCallback","onCloseSlider","everythingIsSaved","denyAction","MessageBox","confirm","messageBox","mark","setParam","getParam","getSliderByWindow","set","undefined","bottom","notAddMargin","seams","ii","cc","seam","widthPx","heightPx","pageImageRect","pixelPosition","seamShift","newBlock","colorChangeListener","existedSignBlock","signColor","guide","Guide","steps","getElementById","title","autoSave","simpleMode","startOnce","helpBtnSpotlight","SpotLight","targetElement","targetVertex","rounded","article","onShow","isCRM","updatedBlock","newColor","isNull","buttonClassList","firstPartyBlocks","hint","partnerBlocks","generalBlocks","sections","helpArticleCode","Editor","Hint","createInstance","popupParameters","autoHide","bindOptions","angle","entityData","values","renderDocument","urls","isTemplate","documentData","promises","fragment","reduce","acc","promise","Promise","resolve","DocumentFragment","all","unsubscribeAll","contentCallback","onCloseComplete","editButtonClassName","join","saveButtonClassName","slice","editButtonTitle","saveButtonTitle","Helper","sectionsNodes","section","init","isEdit"],"mappings":"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"}