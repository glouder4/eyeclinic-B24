this.BX=this.BX||{};this.BX.Sign=this.BX.Sign||{};(function(e,s,a,t,l,i,o){"use strict";let r=e=>e,b,d,c,n,v,p,h;var u=babelHelpers.classPrivateFieldLooseKey("documentSetup");var P=babelHelpers.classPrivateFieldLooseKey("uid");var L=babelHelpers.classPrivateFieldLooseKey("containerId");var F=babelHelpers.classPrivateFieldLooseKey("requisites");var H=babelHelpers.classPrivateFieldLooseKey("documentSummary");var B=babelHelpers.classPrivateFieldLooseKey("preview");var m=babelHelpers.classPrivateFieldLooseKey("editor");var y=babelHelpers.classPrivateFieldLooseKey("api");var g=babelHelpers.classPrivateFieldLooseKey("stepNode");var f=babelHelpers.classPrivateFieldLooseKey("stepsMetadata");var D=babelHelpers.classPrivateFieldLooseKey("stepIndex");var w=babelHelpers.classPrivateFieldLooseKey("order");var _=babelHelpers.classPrivateFieldLooseKey("stages");var O=babelHelpers.classPrivateFieldLooseKey("navigationButtons");var S=babelHelpers.classPrivateFieldLooseKey("loadData");var C=babelHelpers.classPrivateFieldLooseKey("subscribeOnDocumentEvents");var I=babelHelpers.classPrivateFieldLooseKey("createNavigationButtons");var j=babelHelpers.classPrivateFieldLooseKey("createStages");var K=babelHelpers.classPrivateFieldLooseKey("renderNavigationButtons");var T=babelHelpers.classPrivateFieldLooseKey("renderActiveStage");var E=babelHelpers.classPrivateFieldLooseKey("renderStep");var N=babelHelpers.classPrivateFieldLooseKey("onPrevStep");var R=babelHelpers.classPrivateFieldLooseKey("onNextStep");var k=babelHelpers.classPrivateFieldLooseKey("moveOnStep");var X=babelHelpers.classPrivateFieldLooseKey("sendForSign");var A=babelHelpers.classPrivateFieldLooseKey("getLayout");var $=babelHelpers.classPrivateFieldLooseKey("complete");class M{constructor(e){Object.defineProperty(this,$,{value:se});Object.defineProperty(this,A,{value:ee});Object.defineProperty(this,X,{value:Y});Object.defineProperty(this,k,{value:Q});Object.defineProperty(this,R,{value:J});Object.defineProperty(this,N,{value:x});Object.defineProperty(this,E,{value:q});Object.defineProperty(this,T,{value:Z});Object.defineProperty(this,K,{value:W});Object.defineProperty(this,j,{value:V});Object.defineProperty(this,I,{value:U});Object.defineProperty(this,C,{value:G});Object.defineProperty(this,S,{value:z});Object.defineProperty(this,u,{writable:true,value:void 0});Object.defineProperty(this,P,{writable:true,value:void 0});Object.defineProperty(this,L,{writable:true,value:void 0});Object.defineProperty(this,F,{writable:true,value:void 0});Object.defineProperty(this,H,{writable:true,value:void 0});Object.defineProperty(this,B,{writable:true,value:void 0});Object.defineProperty(this,m,{writable:true,value:void 0});Object.defineProperty(this,y,{writable:true,value:void 0});Object.defineProperty(this,g,{writable:true,value:void 0});Object.defineProperty(this,f,{writable:true,value:void 0});Object.defineProperty(this,D,{writable:true,value:void 0});Object.defineProperty(this,w,{writable:true,value:void 0});Object.defineProperty(this,_,{writable:true,value:void 0});Object.defineProperty(this,O,{writable:true,value:void 0});const{uid:d=null,containerId:c,config:n={}}=e;babelHelpers.classPrivateFieldLooseBase(this,P)[P]=d;babelHelpers.classPrivateFieldLooseBase(this,L)[L]=c;babelHelpers.classPrivateFieldLooseBase(this,u)[u]=new a.DocumentSetup(n.blankSelectorConfig);babelHelpers.classPrivateFieldLooseBase(this,F)[F]=new t.Requisites;babelHelpers.classPrivateFieldLooseBase(this,H)[H]=new l.DocumentSummary;babelHelpers.classPrivateFieldLooseBase(this,B)[B]=new i.Preview;babelHelpers.classPrivateFieldLooseBase(this,y)[y]=new o.Api;babelHelpers.classPrivateFieldLooseBase(this,f)[f]={setup:{step:babelHelpers.classPrivateFieldLooseBase(this,u)[u],title:s.Loc.getMessage("SIGN_WIZARD_LOAD_DOCUMENT"),beforeCompletion:async()=>{const[,e]=babelHelpers.classPrivateFieldLooseBase(this,O)[O];const a=(e=[],s=[])=>{babelHelpers.classPrivateFieldLooseBase(this,m)[m].urls=e;babelHelpers.classPrivateFieldLooseBase(this,B)[B].urls=e;babelHelpers.classPrivateFieldLooseBase(this,B)[B].setBlocks(s)};a();s.Dom.addClass(e,"ui-btn-wait");const t=await babelHelpers.classPrivateFieldLooseBase(this,u)[u].setup();s.Dom.removeClass(e,"ui-btn-wait");if(!t){return false}const{uid:l,entityId:i,blocks:o,initiator:r}=t;babelHelpers.classPrivateFieldLooseBase(this,B)[B].ready=false;babelHelpers.classPrivateFieldLooseBase(this,u)[u].waitForPagesList(30*1e3,(e=>{a(e,o);babelHelpers.classPrivateFieldLooseBase(this,B)[B].ready=true}));babelHelpers.classPrivateFieldLooseBase(this,F)[F].documentData={uid:l,entityId:i,initiator:r};return true}},requisites:{step:babelHelpers.classPrivateFieldLooseBase(this,F)[F],title:s.Loc.getMessage("SIGN_WIZARD_PREPARING_DOCUMENT"),beforeCompletion:async()=>{const[,e]=babelHelpers.classPrivateFieldLooseBase(this,O)[O];s.Dom.addClass(e,"ui-btn-wait");const a=await babelHelpers.classPrivateFieldLooseBase(this,F)[F].processMembers();if(!a){s.Dom.removeClass(e,"ui-btn-wait");return false}const{uid:t,isTemplate:l,title:i}=babelHelpers.classPrivateFieldLooseBase(this,u)[u].setupData;const o=await babelHelpers.classPrivateFieldLooseBase(this,u)[u].loadBlocks(t);babelHelpers.classPrivateFieldLooseBase(this,m)[m].documentData={isTemplate:l,uid:t,blocks:o};babelHelpers.classPrivateFieldLooseBase(this,m)[m].entityData=a;babelHelpers.classPrivateFieldLooseBase(this,H)[H].documentData={uid:t,title:i,blocks:o};babelHelpers.classPrivateFieldLooseBase(this,H)[H].entityData=a;await babelHelpers.classPrivateFieldLooseBase(this,m)[m].renderDocument();s.Dom.removeClass(e,"ui-btn-wait");await babelHelpers.classPrivateFieldLooseBase(this,m)[m].show();return true}},send:{step:babelHelpers.classPrivateFieldLooseBase(this,H)[H],title:s.Loc.getMessage("SIGN_WIZARD_SEND_DOCUMENT")}};babelHelpers.classPrivateFieldLooseBase(this,D)[D]=0;babelHelpers.classPrivateFieldLooseBase(this,w)[w]=["setup","requisites","send"];babelHelpers.classPrivateFieldLooseBase(this,_)[_]=babelHelpers.classPrivateFieldLooseBase(this,j)[j]();babelHelpers.classPrivateFieldLooseBase(this,O)[O]=babelHelpers.classPrivateFieldLooseBase(this,I)[I]();babelHelpers.classPrivateFieldLooseBase(this,g)[g]=s.Tag.render(b||(b=r`<div class="sign-wizard__step"></div>`));const v=s.Reflection.getClass("top.BX.Sign.V2.Editor");babelHelpers.classPrivateFieldLooseBase(this,m)[m]=new v;babelHelpers.classPrivateFieldLooseBase(this,C)[C]()}async show(){try{await babelHelpers.classPrivateFieldLooseBase(this,S)[S]();babelHelpers.classPrivateFieldLooseBase(this,k)[k](babelHelpers.classPrivateFieldLooseBase(this,D)[D]);const e=document.getElementById(babelHelpers.classPrivateFieldLooseBase(this,L)[L]);s.Dom.append(babelHelpers.classPrivateFieldLooseBase(this,A)[A](),e)}catch(e){console.log(e)}}}async function z(){const e=babelHelpers.classPrivateFieldLooseBase(this,P)[P]?await babelHelpers.classPrivateFieldLooseBase(this,y)[y].loadDocument(babelHelpers.classPrivateFieldLooseBase(this,P)[P]):null;if(!e){return}babelHelpers.classPrivateFieldLooseBase(this,u)[u].finishSetup(e,e.blankId);babelHelpers.classPrivateFieldLooseBase(this,F)[F].documentData=e;babelHelpers.classPrivateFieldLooseBase(this,m)[m].documentData=e;babelHelpers.classPrivateFieldLooseBase(this,H)[H].documentData=e;if(e.status==="uploading"||e.status==="uploaded"||e.status==="ready"){babelHelpers.classPrivateFieldLooseBase(this,u)[u].waitForPagesList(30*1e3,(s=>{babelHelpers.classPrivateFieldLooseBase(this,m)[m].urls=s;babelHelpers.classPrivateFieldLooseBase(this,B)[B].urls=s;babelHelpers.classPrivateFieldLooseBase(this,B)[B].setBlocks(e.blocks)}));babelHelpers.classPrivateFieldLooseBase(this,D)[D]=1}}function G(){const[,e]=babelHelpers.classPrivateFieldLooseBase(this,O)[O];const a=[{type:"toggleSelection",stage:"setup",method:({data:a})=>{const{relatedTarget:t,selected:l,blankId:i}=a;if(l){s.Dom.removeClass(e,"ui-btn-disabled");return}if(t!==e){s.Dom.addClass(e,"ui-btn-disabled");return}babelHelpers.classPrivateFieldLooseBase(this,u)[u].blankSelector.selectBlank(i)}},{type:"addFile",stage:"setup",method:()=>{if(babelHelpers.classPrivateFieldLooseBase(this,u)[u].blankSelector.isFilesReadyForUpload()){s.Dom.removeClass(e,"ui-btn-disabled")}else{s.Dom.addClass(e,"ui-btn-disabled")}}},{type:"removeFile",stage:"setup",method:()=>{if(babelHelpers.classPrivateFieldLooseBase(this,u)[u].blankSelector.isFilesReadyForUpload()){s.Dom.removeClass(e,"ui-btn-disabled")}else{s.Dom.addClass(e,"ui-btn-disabled")}}},{type:"clearFiles",stage:"setup",method:()=>s.Dom.addClass(e,"ui-btn-disabled")},{type:"changeInitiator",stage:"requisites",method:({data:e})=>{babelHelpers.classPrivateFieldLooseBase(this,u)[u].setupData={...babelHelpers.classPrivateFieldLooseBase(this,u)[u].setupData,initiator:e.initiator}}},{type:"showEditor",stage:"send",method:()=>babelHelpers.classPrivateFieldLooseBase(this,m)[m].show()},{type:"changeTitle",stage:"send",method:({data:e})=>{babelHelpers.classPrivateFieldLooseBase(this,u)[u].setupData={...babelHelpers.classPrivateFieldLooseBase(this,u)[u].setupData,title:e.newValue}}}];a.forEach((({type:e,method:s,stage:a})=>{const{step:t}=babelHelpers.classPrivateFieldLooseBase(this,f)[f][a];t.subscribe(e,s)}));babelHelpers.classPrivateFieldLooseBase(this,m)[m].subscribe("save",(({data:e})=>{const s=e.blocks;babelHelpers.classPrivateFieldLooseBase(this,B)[B].setBlocks(s);babelHelpers.classPrivateFieldLooseBase(this,u)[u].setupData={...babelHelpers.classPrivateFieldLooseBase(this,u)[u].setupData,blocks:s};babelHelpers.classPrivateFieldLooseBase(this,H)[H].documentData={...babelHelpers.classPrivateFieldLooseBase(this,H)[H].documentData,blocks:s};babelHelpers.classPrivateFieldLooseBase(this,H)[H].renderDocumentDetails()}))}function U(){const e=["ui-btn-primary","ui-btn","ui-btn-lg","ui-btn-round","sign-wizard__footer_button"];const a=[{title:s.Loc.getMessage("SIGN_WIZARD_FOOTER_BUTTON_BACK"),method:()=>babelHelpers.classPrivateFieldLooseBase(this,N)[N](),buttonClassList:[...e.slice(1),"ui-btn-light-border"]},{title:s.Loc.getMessage("SIGN_WIZARD_FOOTER_BUTTON_NEXT"),method:()=>babelHelpers.classPrivateFieldLooseBase(this,R)[R]()},{title:s.Loc.getMessage("SIGN_WIZARD_FOOTER_SEND_FOR_SIGN"),method:()=>babelHelpers.classPrivateFieldLooseBase(this,X)[X]()}];return a.map((a=>{const{title:t,method:l,buttonClassList:i=e}=a;return s.Tag.render(d||(d=r`
				<button
					class="${0}"
					title="${0}"
					onclick="${0}"
				>
					${0}
				</button>
			`),i.join(" "),t,l,t)}))}function V(){const e=Object.entries(babelHelpers.classPrivateFieldLooseBase(this,f)[f]);const a=new Map;e.forEach((([e,t])=>{const l=s.Tag.render(c||(c=r`
				<span class="sign-wizard__stages_item">
					${0}
				</span>
			`),t.title);a.set(e,l)}));return a}function W(){const[e,a,t]=babelHelpers.classPrivateFieldLooseBase(this,O)[O];const l=babelHelpers.classPrivateFieldLooseBase(this,D)[D]===0;const i=babelHelpers.classPrivateFieldLooseBase(this,D)[D]+1===babelHelpers.classPrivateFieldLooseBase(this,w)[w].length;const o=babelHelpers.classPrivateFieldLooseBase(this,w)[w][babelHelpers.classPrivateFieldLooseBase(this,D)[D]]==="setup";s.Dom.removeClass(e,"--hide");s.Dom.removeClass(a,"--hide");s.Dom.addClass(t,"--hide");if(o){s.Dom.addClass(a,"ui-btn-disabled")}if(l){s.Dom.addClass(e,"--hide")}if(i){s.Dom.addClass(a,"--hide");s.Dom.removeClass(t,"--hide")}}function Z(){babelHelpers.classPrivateFieldLooseBase(this,_)[_].forEach((e=>{s.Dom.removeClass(e,"--active")}));const e=babelHelpers.classPrivateFieldLooseBase(this,w)[w][babelHelpers.classPrivateFieldLooseBase(this,D)[D]];const a=babelHelpers.classPrivateFieldLooseBase(this,_)[_].get(e);s.Dom.addClass(a,"--active")}function q(){const e=babelHelpers.classPrivateFieldLooseBase(this,w)[w][babelHelpers.classPrivateFieldLooseBase(this,D)[D]];const{step:a}=babelHelpers.classPrivateFieldLooseBase(this,f)[f][e];s.Dom.clean(babelHelpers.classPrivateFieldLooseBase(this,g)[g]);s.Dom.append(a.getLayout(),babelHelpers.classPrivateFieldLooseBase(this,g)[g])}function x(){babelHelpers.classPrivateFieldLooseBase(this,D)[D]-=1;babelHelpers.classPrivateFieldLooseBase(this,k)[k](babelHelpers.classPrivateFieldLooseBase(this,D)[D])}async function J(){var e;const s=babelHelpers.classPrivateFieldLooseBase(this,w)[w][babelHelpers.classPrivateFieldLooseBase(this,D)[D]];const{step:a,beforeCompletion:t}=babelHelpers.classPrivateFieldLooseBase(this,f)[f][s];const l=(e=await(t==null?void 0:t()))!=null?e:true;if(!l){return}babelHelpers.classPrivateFieldLooseBase(this,D)[D]+=1;babelHelpers.classPrivateFieldLooseBase(this,k)[k](babelHelpers.classPrivateFieldLooseBase(this,D)[D])}function Q(e){babelHelpers.classPrivateFieldLooseBase(this,D)[D]=e;babelHelpers.classPrivateFieldLooseBase(this,T)[T]();babelHelpers.classPrivateFieldLooseBase(this,K)[K]();babelHelpers.classPrivateFieldLooseBase(this,E)[E]()}async function Y(){const e=babelHelpers.classPrivateFieldLooseBase(this,O)[O][2];try{const{communications:a,entityData:t}=babelHelpers.classPrivateFieldLooseBase(this,H)[H];s.Dom.addClass(e,"ui-btn-wait");const l=Object.entries(a);let i=true;const o=await babelHelpers.classPrivateFieldLooseBase(this,y)[y].loadRestrictions();for(const[e,s]of l){const{type:a,value:l}=s;const{uid:r}=t[e];if(!o.smsAllowed&&a==="PHONE"){top.BX.UI.InfoHelper.show("limit_crm_sign_messenger_identification");i=false;continue}babelHelpers.classPrivateFieldLooseBase(this,y)[y].modifyCommunicationChannel(r,a,l)}const{uid:r,initiator:b}=babelHelpers.classPrivateFieldLooseBase(this,u)[u].setupData;await babelHelpers.classPrivateFieldLooseBase(this,y)[y].modifyInitiator(r,b);if(!i){return}await babelHelpers.classPrivateFieldLooseBase(this,y)[y].configureDocument(r);await babelHelpers.classPrivateFieldLooseBase(this,y)[y].startSigning(r);babelHelpers.classPrivateFieldLooseBase(this,$)[$]()}finally{s.Dom.removeClass(e,"ui-btn-wait")}}function ee(){const e=s.Loc.getMessage("SIGN_WIZARD_HEADER_TITLE");const a=s.Loc.getMessage("SIGN_WIZARD_HEADER_TITLE_SUB");const t=s.Tag.render(n||(n=r`
			<div class="sign-wizard__head">
				<div>
					<p class="sign-wizard__head_title">${0}</p>
					<p class="sign-wizard__head_title --sub">
						${0}
					</p>
				</div>
			</div>
		`),e,a);const l=s.Tag.render(v||(v=r`
			<div class="sign-wizard__content">
				<div class="sign-wizard__stages">
					${0}
				</div>
				${0}
			</div>
		`),[...babelHelpers.classPrivateFieldLooseBase(this,_)[_].values()],babelHelpers.classPrivateFieldLooseBase(this,g)[g]);const i=s.Tag.render(p||(p=r`
			<div class="sign-wizard__footer">
				${0}
			</div>
		`),babelHelpers.classPrivateFieldLooseBase(this,O)[O]);return s.Tag.render(h||(h=r`
			<div class="sign-wizard sign-wizard__scope">
				<div class="sign-wizard__sidebar">
					${0}
					${0}
					${0}
				</div>
				${0}
			</div>
		`),t,l,i,babelHelpers.classPrivateFieldLooseBase(this,B)[B].getLayout())}function se(){const e=window.location.search;const s=new URLSearchParams(e);BX.SidePanel.Instance.close();if(!s.has("noRedirect")){const{entityTypeId:e,entityId:s}=babelHelpers.classPrivateFieldLooseBase(this,u)[u].setupData;const a=`/crm/type/${e}/details/${s}/`;BX.SidePanel.Instance.open(a)}}e.Wizard=M})(this.BX.Sign.V2=this.BX.Sign.V2||{},BX,BX.Sign.V2,BX.Sign.V2,BX.Sign.V2,BX.Sign.V2,BX.Sign.V2);
//# sourceMappingURL=wizard.bundle.map.js