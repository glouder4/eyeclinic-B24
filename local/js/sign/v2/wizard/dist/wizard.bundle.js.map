{"version":3,"file":"wizard.bundle.js","sources":["../src/index.js"],"sourcesContent":["import { Tag, Loc, Dom, Reflection, Event, Type } from 'main.core';\nimport { DocumentSetup } from 'sign.v2.document-setup';\nimport { Requisites } from 'sign.v2.requisites';\nimport { DocumentSummary } from 'sign.v2.document-summary';\nimport { Preview } from 'sign.v2.preview';\nimport { Api } from 'sign.v2.api';\nimport './style.css';\nimport type { WizardConfig } from './types/config';\n\ntype StepsMetadata = {\n\tsetup: {\n\t\tstep: DocumentSetup;\n\t\ttitle: string;\n\t\tbeforeCompletion: Function;\n\t},\n\trequisites: {\n\t\tstep: Requisites;\n\t\ttitle: string;\n\t\tbeforeCompletion: Function;\n\t},\n\tsend: {\n\t\tstep: DocumentSummary;\n\t\ttitle: string;\n\t}\n};\ntype WizardOptions = {\n\tuid: ?string;\n\tcontainerId: string;\n};\n\nexport class Wizard\n{\n\t#documentSetup: DocumentSetup;\n\t#uid: ?string;\n\t#containerId: string;\n\t#requisites: Requisites;\n\t#documentSummary: DocumentSummary;\n\t#preview: Preview;\n\t#editor: Editor;\n\t#api: Api;\n\t#stepNode: HTMLElement;\n\t#stepsMetadata: StepsMetadata;\n\t#stepIndex: number;\n\t#order: Array<string>;\n\t#stages: Map<string, HTMLElement>;\n\t#navigationButtons: Array<HTMLElement>;\n\n\tconstructor(options: WizardOptions)\n\t{\n\t\tconst { uid = null, containerId, config = {} } = options;\n\n\t\tthis.#uid = uid;\n\t\tthis.#containerId = containerId;\n\t\tthis.#documentSetup = new DocumentSetup(config.blankSelectorConfig);\n\t\tthis.#requisites = new Requisites();\n\t\tthis.#documentSummary = new DocumentSummary();\n\t\tthis.#preview = new Preview();\n\t\tthis.#api = new Api();\n\t\tthis.#stepsMetadata = {\n\t\t\tsetup: {\n\t\t\t\tstep: this.#documentSetup,\n\t\t\t\ttitle: Loc.getMessage('SIGN_WIZARD_LOAD_DOCUMENT'),\n\t\t\t\tbeforeCompletion: async () => {\n\t\t\t\t\tconst [, nextButton] = this.#navigationButtons;\n\t\t\t\t\tconst renderPages = (urls = [], blocks = []) => {\n\t\t\t\t\t\tthis.#editor.urls = urls;\n\t\t\t\t\t\tthis.#preview.urls = urls;\n\t\t\t\t\t\tthis.#preview.setBlocks(blocks);\n\t\t\t\t\t};\n\t\t\t\t\trenderPages();\n\t\t\t\t\tDom.addClass(nextButton, 'ui-btn-wait');\n\t\t\t\t\tconst setupData = await this.#documentSetup.setup();\n\t\t\t\t\tDom.removeClass(nextButton, 'ui-btn-wait');\n\t\t\t\t\tif (!setupData)\n\t\t\t\t\t{\n\t\t\t\t\t\treturn false;\n\t\t\t\t\t}\n\n\t\t\t\t\tconst { uid, entityId, blocks, initiator } = setupData;\n\t\t\t\t\tthis.#preview.ready = false;\n\t\t\t\t\tthis.#documentSetup.waitForPagesList(30 * 1000, (urls) => {\n\t\t\t\t\t\trenderPages(urls, blocks);\n\t\t\t\t\t\tthis.#preview.ready = true;\n\t\t\t\t\t});\n\t\t\t\t\tthis.#requisites.documentData = { uid, entityId, initiator };\n\n\t\t\t\t\treturn true;\n\t\t\t\t},\n\t\t\t},\n\t\t\trequisites: {\n\t\t\t\tstep: this.#requisites,\n\t\t\t\ttitle: Loc.getMessage('SIGN_WIZARD_PREPARING_DOCUMENT'),\n\t\t\t\tbeforeCompletion: async () => {\n\t\t\t\t\tconst [, nextButton] = this.#navigationButtons;\n\t\t\t\t\tDom.addClass(nextButton, 'ui-btn-wait');\n\t\t\t\t\tconst entityData = await this.#requisites.processMembers();\n\t\t\t\t\tif (!entityData)\n\t\t\t\t\t{\n\t\t\t\t\t\tDom.removeClass(nextButton, 'ui-btn-wait');\n\t\t\t\t\t\treturn false;\n\t\t\t\t\t}\n\n\t\t\t\t\tconst { uid, isTemplate, title } = this.#documentSetup.setupData;\n\t\t\t\t\tconst blocks = await this.#documentSetup.loadBlocks(uid);\n\t\t\t\t\tthis.#editor.documentData = { isTemplate, uid, blocks };\n\t\t\t\t\tthis.#editor.entityData = entityData;\n\t\t\t\t\tthis.#documentSummary.documentData = { uid, title, blocks };\n\t\t\t\t\tthis.#documentSummary.entityData = entityData;\n\t\t\t\t\tawait this.#editor.renderDocument();\n\t\t\t\t\tDom.removeClass(nextButton, 'ui-btn-wait');\n\t\t\t\t\tawait this.#editor.show();\n\n\t\t\t\t\treturn true;\n\t\t\t\t},\n\t\t\t},\n\t\t\tsend: {\n\t\t\t\tstep: this.#documentSummary,\n\t\t\t\ttitle: Loc.getMessage('SIGN_WIZARD_SEND_DOCUMENT'),\n\t\t\t},\n\t\t};\n\t\tthis.#stepIndex = 0;\n\t\tthis.#order = ['setup', 'requisites', 'send'];\n\t\tthis.#stages = this.#createStages();\n\t\tthis.#navigationButtons = this.#createNavigationButtons();\n\t\tthis.#stepNode = Tag.render`<div class=\"sign-wizard__step\"></div>`;\n\t\t// eslint-disable-next-line no-shadow\n\t\tconst Editor = Reflection.getClass('top.BX.Sign.V2.Editor');\n\t\tthis.#editor = new Editor();\n\t\tthis.#subscribeOnDocumentEvents();\n\t}\n\n\tasync #loadData()\n\t{\n\t\tconst loadedData = this.#uid ? await this.#api.loadDocument(this.#uid) : null;\n\t\tif (!loadedData)\n\t\t{\n\t\t\treturn;\n\t\t}\n\n\t\tthis.#documentSetup.finishSetup(loadedData, loadedData.blankId);\n\t\tthis.#requisites.documentData = loadedData;\n\t\tthis.#editor.documentData = loadedData;\n\t\tthis.#documentSummary.documentData = loadedData;\n\t\tif (\n\t\t\tloadedData.status === 'uploading'\n\t\t\t|| loadedData.status === 'uploaded'\n\t\t\t|| loadedData.status === 'ready'\n\t\t)\n\t\t{\n\t\t\tthis.#documentSetup.waitForPagesList(30 * 1000, (urls) => {\n\t\t\t\tthis.#editor.urls = urls;\n\t\t\t\tthis.#preview.urls = urls;\n\t\t\t\tthis.#preview.setBlocks(loadedData.blocks);\n\t\t\t});\n\t\t\tthis.#stepIndex = 1;\n\t\t}\n\t}\n\n\tasync show()\n\t{\n\t\ttry\n\t\t{\n\t\t\tawait this.#loadData();\n\t\t\tthis.#moveOnStep(this.#stepIndex);\n\t\t\tconst container = document.getElementById(this.#containerId);\n\t\t\tDom.append(this.#getLayout(), container);\n\t\t}\n\t\tcatch (ex)\n\t\t{\n\t\t\t// eslint-disable-next-line no-console\n\t\t\tconsole.log(ex);\n\t\t}\n\t}\n\n\t#subscribeOnDocumentEvents()\n\t{\n\t\tconst [, nextButton] = this.#navigationButtons;\n\t\tconst events = [\n\t\t\t{\n\t\t\t\ttype: 'toggleSelection',\n\t\t\t\tstage: 'setup',\n\t\t\t\tmethod: ({ data }) => {\n\t\t\t\t\tconst { relatedTarget, selected, blankId } = data;\n\t\t\t\t\tif (selected)\n\t\t\t\t\t{\n\t\t\t\t\t\tDom.removeClass(nextButton, 'ui-btn-disabled');\n\n\t\t\t\t\t\treturn;\n\t\t\t\t\t}\n\n\t\t\t\t\tif (relatedTarget !== nextButton)\n\t\t\t\t\t{\n\t\t\t\t\t\tDom.addClass(nextButton, 'ui-btn-disabled');\n\n\t\t\t\t\t\treturn;\n\t\t\t\t\t}\n\n\t\t\t\t\tthis.#documentSetup.blankSelector.selectBlank(blankId);\n\t\t\t\t},\n\t\t\t},\n\t\t\t{\n\t\t\t\ttype: 'addFile',\n\t\t\t\tstage: 'setup',\n\t\t\t\tmethod: () => {\n\t\t\t\t\tif (this.#documentSetup.blankSelector.isFilesReadyForUpload())\n\t\t\t\t\t{\n\t\t\t\t\t\tDom.removeClass(nextButton, 'ui-btn-disabled');\n\t\t\t\t\t}\n\t\t\t\t\telse\n\t\t\t\t\t{\n\t\t\t\t\t\tDom.addClass(nextButton, 'ui-btn-disabled');\n\t\t\t\t\t}\n\t\t\t\t},\n\t\t\t},\n\t\t\t{\n\t\t\t\ttype: 'removeFile',\n\t\t\t\tstage: 'setup',\n\t\t\t\tmethod: () => {\n\t\t\t\t\tif (this.#documentSetup.blankSelector.isFilesReadyForUpload())\n\t\t\t\t\t{\n\t\t\t\t\t\tDom.removeClass(nextButton, 'ui-btn-disabled');\n\t\t\t\t\t}\n\t\t\t\t\telse\n\t\t\t\t\t{\n\t\t\t\t\t\tDom.addClass(nextButton, 'ui-btn-disabled');\n\t\t\t\t\t}\n\t\t\t\t},\n\t\t\t},\n\t\t\t{\n\t\t\t\ttype: 'clearFiles',\n\t\t\t\tstage: 'setup',\n\t\t\t\tmethod: () => Dom.addClass(nextButton, 'ui-btn-disabled')\n\t\t\t},\n\t\t\t{\n\t\t\t\ttype: 'changeInitiator',\n\t\t\t\tstage: 'requisites',\n\t\t\t\tmethod: ({ data }) => {\n\t\t\t\t\tthis.#documentSetup.setupData = {\n\t\t\t\t\t\t...this.#documentSetup.setupData,\n\t\t\t\t\t\tinitiator: data.initiator\n\t\t\t\t\t};\n\t\t\t\t}\n\t\t\t},\n\t\t\t{\n\t\t\t\ttype: 'showEditor',\n\t\t\t\tstage: 'send',\n\t\t\t\tmethod: () => this.#editor.show()\n\t\t\t},\n\t\t\t{\n\t\t\t\ttype: 'changeTitle',\n\t\t\t\tstage: 'send',\n\t\t\t\tmethod: ({ data }) => {\n\t\t\t\t\tthis.#documentSetup.setupData = {\n\t\t\t\t\t\t...this.#documentSetup.setupData,\n\t\t\t\t\t\ttitle: data.newValue\n\t\t\t\t\t};\n\t\t\t\t}\n\t\t\t}\n\t\t];\n\t\tevents.forEach(({ type, method, stage }) => {\n\t\t\tconst { step } = this.#stepsMetadata[stage];\n\t\t\tstep.subscribe(type, method);\n\t\t});\n\t\tthis.#editor.subscribe('save', ({ data }) => {\n\t\t\tconst blocks = data.blocks;\n\t\t\tthis.#preview.setBlocks(blocks);\n\t\t\tthis.#documentSetup.setupData = {\n\t\t\t\t...this.#documentSetup.setupData,\n\t\t\t\tblocks\n\t\t\t};\n\t\t\tthis.#documentSummary.documentData = {\n\t\t\t\t...this.#documentSummary.documentData,\n\t\t\t\tblocks\n\t\t\t};\n\t\t\tthis.#documentSummary.renderDocumentDetails();\n\t\t});\n\t}\n\n\t#createNavigationButtons(): Array<HTMLElement>\n\t{\n\t\tconst classList = [\n\t\t\t'ui-btn-primary',\n\t\t\t'ui-btn',\n\t\t\t'ui-btn-lg',\n\t\t\t'ui-btn-round',\n\t\t\t'sign-wizard__footer_button',\n\t\t];\n\t\tconst buttons = [\n\t\t\t{\n\t\t\t\ttitle: Loc.getMessage('SIGN_WIZARD_FOOTER_BUTTON_BACK'),\n\t\t\t\tmethod: () => this.#onPrevStep(),\n\t\t\t\tbuttonClassList: [\n\t\t\t\t\t...classList.slice(1),\n\t\t\t\t\t'ui-btn-light-border',\n\t\t\t\t],\n\t\t\t},\n\t\t\t{\n\t\t\t\ttitle: Loc.getMessage('SIGN_WIZARD_FOOTER_BUTTON_NEXT'),\n\t\t\t\tmethod: () => this.#onNextStep(),\n\t\t\t},\n\t\t\t{\n\t\t\t\ttitle: Loc.getMessage('SIGN_WIZARD_FOOTER_SEND_FOR_SIGN'),\n\t\t\t\tmethod: () => this.#sendForSign(),\n\t\t\t},\n\t\t];\n\n\t\treturn buttons.map((button) => {\n\t\t\tconst {\n\t\t\t\ttitle,\n\t\t\t\tmethod,\n\t\t\t\tbuttonClassList = classList,\n\t\t\t} = button;\n\n\t\t\treturn Tag.render`\n\t\t\t\t<button\n\t\t\t\t\tclass=\"${buttonClassList.join(' ')}\"\n\t\t\t\t\ttitle=\"${title}\"\n\t\t\t\t\tonclick=\"${method}\"\n\t\t\t\t>\n\t\t\t\t\t${title}\n\t\t\t\t</button>\n\t\t\t`;\n\t\t});\n\t}\n\n\t#createStages(): HTMLElement\n\t{\n\t\tconst entries = Object.entries(this.#stepsMetadata);\n\t\tconst stages = new Map();\n\t\tentries.forEach(([stepName, step]) => {\n\t\t\tconst stage = Tag.render`\n\t\t\t\t<span class=\"sign-wizard__stages_item\">\n\t\t\t\t\t${step.title}\n\t\t\t\t</span>\n\t\t\t`;\n\t\t\tstages.set(stepName, stage);\n\t\t});\n\n\t\treturn stages;\n\t}\n\n\t#renderNavigationButtons()\n\t{\n\t\tconst [\n\t\t\tbackButton,\n\t\t\tnextButton,\n\t\t\tsendForSignButton,\n\t\t] = this.#navigationButtons;\n\t\tconst firstStep = this.#stepIndex === 0;\n\t\tconst lastStep = this.#stepIndex + 1 === this.#order.length;\n\t\tconst nextDisabled = this.#order[this.#stepIndex] === 'setup';\n\t\tDom.removeClass(backButton, '--hide');\n\t\tDom.removeClass(nextButton, '--hide');\n\t\tDom.addClass(sendForSignButton, '--hide');\n\t\tif (nextDisabled)\n\t\t{\n\t\t\tDom.addClass(nextButton, 'ui-btn-disabled');\n\t\t}\n\n\t\tif (firstStep)\n\t\t{\n\t\t\tDom.addClass(backButton, '--hide');\n\t\t}\n\n\t\tif (lastStep)\n\t\t{\n\t\t\tDom.addClass(nextButton, '--hide');\n\t\t\tDom.removeClass(sendForSignButton, '--hide');\n\t\t}\n\t}\n\n\t#renderActiveStage()\n\t{\n\t\tthis.#stages.forEach((stageNode) => {\n\t\t\tDom.removeClass(stageNode, '--active');\n\t\t});\n\t\tconst stepName = this.#order[this.#stepIndex];\n\t\tconst stageNode = this.#stages.get(stepName);\n\t\tDom.addClass(stageNode, '--active');\n\t}\n\n\t#renderStep()\n\t{\n\t\tconst stepName = this.#order[this.#stepIndex];\n\t\tconst { step } = this.#stepsMetadata[stepName];\n\t\tDom.clean(this.#stepNode);\n\t\tDom.append(step.getLayout(), this.#stepNode);\n\t}\n\n\t#onPrevStep()\n\t{\n\t\tthis.#stepIndex -= 1;\n\t\tthis.#moveOnStep(this.#stepIndex);\n\t}\n\n\tasync #onNextStep()\n\t{\n\t\tconst stepName = this.#order[this.#stepIndex];\n\t\tconst { step, beforeCompletion } = this.#stepsMetadata[stepName];\n\t\tconst shouldComplete = await beforeCompletion?.() ?? true;\n\t\tif (!shouldComplete)\n\t\t{\n\t\t\treturn;\n\t\t}\n\n\t\tthis.#stepIndex += 1;\n\t\tthis.#moveOnStep(this.#stepIndex);\n\t}\n\n\t#moveOnStep(step: number)\n\t{\n\t\tthis.#stepIndex = step;\n\t\tthis.#renderActiveStage();\n\t\tthis.#renderNavigationButtons();\n\t\tthis.#renderStep();\n\t}\n\n\tasync #sendForSign()\n\t{\n\t\tconst sendForSignButton = this.#navigationButtons[2];\n\t\ttry\n\t\t{\n\t\t\tconst { communications, entityData } = this.#documentSummary;\n\t\t\tDom.addClass(sendForSignButton, 'ui-btn-wait');\n\t\t\tconst entries = Object.entries(communications);\n\t\t\tlet allowToComplete = true;\n\t\t\tconst restrictions = await this.#api.loadRestrictions();\n\n\t\t\tfor (const [entityType, item] of entries)\n\t\t\t{\n\t\t\t\tconst { type, value } = item;\n\t\t\t\tconst { uid: memberUid } = entityData[entityType];\n\n\t\t\t\tif (!restrictions.smsAllowed && type === 'PHONE')\n\t\t\t\t{\n\t\t\t\t\ttop.BX.UI.InfoHelper.show('limit_crm_sign_messenger_identification');\n\t\t\t\t\tallowToComplete = false;\n\n\t\t\t\t\tcontinue;\n\t\t\t\t}\n\n\t\t\t\tthis.#api.modifyCommunicationChannel(memberUid, type, value);\n\t\t\t}\n\n\t\t\tconst {\n\t\t\t\tuid: documentUid,\n\t\t\t\tinitiator,\n\t\t\t} = this.#documentSetup.setupData;\n\t\t\tawait this.#api.modifyInitiator(documentUid, initiator);\n\n\t\t\tif (!allowToComplete)\n\t\t\t{\n\t\t\t\treturn;\n\t\t\t}\n\t\t\tawait this.#api.configureDocument(documentUid);\n\t\t\tawait this.#api.startSigning(documentUid);\n\t\t\tthis.#complete();\n\t\t}\n\t\tfinally\n\t\t{\n\t\t\tDom.removeClass(sendForSignButton, 'ui-btn-wait');\n\t\t}\n\t}\n\n\t#getLayout(): HTMLElement\n\t{\n\t\tconst headerTitle = Loc.getMessage('SIGN_WIZARD_HEADER_TITLE');\n\t\tconst headerTitleSub = Loc.getMessage('SIGN_WIZARD_HEADER_TITLE_SUB');\n\t\tconst header = Tag.render`\n\t\t\t<div class=\"sign-wizard__head\">\n\t\t\t\t<div>\n\t\t\t\t\t<p class=\"sign-wizard__head_title\">${headerTitle}</p>\n\t\t\t\t\t<p class=\"sign-wizard__head_title --sub\">\n\t\t\t\t\t\t${headerTitleSub}\n\t\t\t\t\t</p>\n\t\t\t\t</div>\n\t\t\t</div>\n\t\t`;\n\t\tconst content = Tag.render`\n\t\t\t<div class=\"sign-wizard__content\">\n\t\t\t\t<div class=\"sign-wizard__stages\">\n\t\t\t\t\t${[...this.#stages.values()]}\n\t\t\t\t</div>\n\t\t\t\t${this.#stepNode}\n\t\t\t</div>\n\t\t`;\n\t\tconst footer = Tag.render`\n\t\t\t<div class=\"sign-wizard__footer\">\n\t\t\t\t${this.#navigationButtons}\n\t\t\t</div>\n\t\t`;\n\n\t\treturn Tag.render`\n\t\t\t<div class=\"sign-wizard sign-wizard__scope\">\n\t\t\t\t<div class=\"sign-wizard__sidebar\">\n\t\t\t\t\t${header}\n\t\t\t\t\t${content}\n\t\t\t\t\t${footer}\n\t\t\t\t</div>\n\t\t\t\t${this.#preview.getLayout()}\n\t\t\t</div>\n\t\t`;\n\t}\n\n\t#complete()\n\t{\n\t\tconst queryString = window.location.search;\n\t\tconst urlParams = new URLSearchParams(queryString);\n\t\tBX.SidePanel.Instance.close();\n\n\t\tif (!urlParams.has('noRedirect'))\n\t\t{\n\t\t\tconst { entityTypeId, entityId } = this.#documentSetup.setupData;\n\t\t\tconst detailsUrl = `/crm/type/${entityTypeId}/details/${entityId}/`;\n\t\t\tBX.SidePanel.Instance.open(detailsUrl);\n\t\t}\n\t}\n}\n"],"names":["Wizard","constructor","options","uid","containerId","config","DocumentSetup","blankSelectorConfig","Requisites","DocumentSummary","Preview","Api","setup","step","title","Loc","getMessage","beforeCompletion","nextButton","renderPages","urls","blocks","setBlocks","Dom","addClass","setupData","removeClass","entityId","initiator","ready","waitForPagesList","documentData","requisites","entityData","processMembers","isTemplate","loadBlocks","renderDocument","show","send","Tag","render","Editor","Reflection","getClass","container","document","getElementById","append","ex","console","log","loadedData","loadDocument","finishSetup","blankId","status","events","type","stage","method","data","relatedTarget","selected","blankSelector","selectBlank","isFilesReadyForUpload","newValue","forEach","subscribe","renderDocumentDetails","classList","buttons","buttonClassList","slice","map","button","join","entries","Object","stages","Map","stepName","set","backButton","sendForSignButton","firstStep","lastStep","length","nextDisabled","stageNode","get","clean","getLayout","shouldComplete","communications","allowToComplete","restrictions","loadRestrictions","entityType","item","value","memberUid","smsAllowed","top","BX","UI","InfoHelper","modifyCommunicationChannel","documentUid","modifyInitiator","configureDocument","startSigning","headerTitle","headerTitleSub","header","content","values","footer","queryString","window","location","search","urlParams","URLSearchParams","SidePanel","Instance","close","has","entityTypeId","detailsUrl","open"],"mappings":"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"}