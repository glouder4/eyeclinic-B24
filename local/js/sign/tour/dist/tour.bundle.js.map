{"version":3,"file":"tour.bundle.js","sources":["../src/backend.js","../src/guide.js"],"sourcesContent":["import { ajax as Ajax, Type } from \"main.core\";\n\nexport class Backend\n{\n\tsaveVisit(tourId: string): Promise<null>\n\t{\n\t\treturn Ajax.runAction('sign.api.tour.saveVisit', { data: { tourId } }).then(({ data }) => data);\n\t}\n\n\tgetLastVisitDate(tourId: string): Promise<{ lastVisitDate: ?Date }>\n\t{\n\t\treturn Ajax\n\t\t\t.runAction('sign.api.tour.getLastVisitDate', { data: { tourId } })\n\t\t\t.then(({ data }) => {\n\t\t\t\tif (!Type.isNil(data?.lastVisitDate))\n\t\t\t\t{\n\t\t\t\t\tdata.lastVisitDate = new Date(data.lastVisitDate);\n\t\t\t\t}\n\n\t\t\t\treturn data;\n\t\t\t});\n\t}\n\n\tisAllToursDisabled(): Promise<boolean>\n\t{\n\t\treturn Ajax\n\t\t\t.runAction('sign.api.tour.isAllToursDisabled', {})\n\t\t\t.then(({ data }) => data)\n\t}\n}","import { Text, Type } from \"main.core\";\nimport { Guide as UiGuide } from \"ui.tour\";\nimport { Backend } from \"./backend\";\n\ntype GuideOption = {\n\tid: ?string;\n\tsteps: Array<StepOption>,\n\t...\n};\n\ntype StepOption = {\n\tid: null | string,\n\tevents: null | {\n\t\tonShow: ?Function,\n\t\tonClose: ?Function,\n\t},\n\t...\n};\n\nexport class Guide extends UiGuide\n{\n\tstatic #isAllTourDisabled: Promise<boolean>;\n\n\t#isIdAutoGenerated: boolean;\n\t#autogeneratedIdPrefix: string = 'sign-tour-guide-';\n\t#backend: Backend = new Backend();\n\n\tconstructor(options: GuideOption)\n\t{\n\t\tsuper(options);\n\t\tif (Type.isStringFilled(options.id))\n\t\t{\n\t\t\tthis.setId(options.id);\n\t\t\tthis.#isIdAutoGenerated = false;\n\t\t}\n\t\telse\n\t\t{\n\t\t\tthis.setId(this.#autogeneratedIdPrefix + Text.getRandom(14));\n\t\t\tthis.#isIdAutoGenerated = true;\n\t\t}\n\n\t\tif (Type.isUndefined(Guide.#isAllTourDisabled))\n\t\t{\n\t\t\tGuide.#isAllTourDisabled = this.#backend.isAllToursDisabled();\n\t\t}\n\t}\n\n\tsave(): void\n\t{\n\t\tthis.#backend.saveVisit(this.getId());\n\t}\n\n\tstart()\n\t{\n\t\tGuide.#isAllTourDisabled.then(isDisabled => {\n\t\t\tif (!isDisabled)\n\t\t\t{\n\t\t\t\tsuper.start();\n\t\t\t}\n\t\t});\n\t}\n\n\tstartOnce(): Promise<null>\n\t{\n\t\tif (this.#isIdAutoGenerated)\n\t\t{\n\t\t\tthrow new Error(\"Cant start guide once if id autogenerated. Set id in constructor\");\n\t\t}\n\t\tif (!this.getAutoSave())\n\t\t{\n\t\t\tthrow new Error(\"Cant start guide once if guide is not auto saved\");\n\t\t}\n\n\t\treturn Promise.all([\n\t\t\t\t\tthis.#backend.getLastVisitDate(this.getId()),\n\t\t\t\t\tGuide.#isAllTourDisabled,\n\t\t\t\t],\n\t\t\t)\n\t\t\t.then(\n\t\t\t\t([{ lastVisitDate }, isTourDisabled]) => {\n\t\t\t\t\tif (!isTourDisabled && Type.isNull(lastVisitDate))\n\t\t\t\t\t{\n\t\t\t\t\t\tthis.start();\n\t\t\t\t\t}\n\t\t\t\t},\n\t\t\t);\n\t}\n}"],"names":["Backend","saveVisit","tourId","Ajax","runAction","data","then","getLastVisitDate","Type","isNil","lastVisitDate","Date","isAllToursDisabled","Guide","UiGuide","constructor","options","isStringFilled","id","setId","Text","getRandom","isUndefined","save","getId","start","isDisabled","startOnce","Error","getAutoSave","Promise","all","isTourDisabled","isNull"],"mappings":";;;;;CAEO,MAAMA,OAAO,CACpB;GACCC,SAAS,CAACC,MAAc,EACxB;KACC,OAAOC,cAAI,CAACC,SAAS,CAAC,yBAAyB,EAAE;OAAEC,IAAI,EAAE;SAAEH;;MAAU,CAAC,CAACI,IAAI,CAAC,CAAC;OAAED;MAAM,KAAKA,IAAI,CAAC;;GAGhGE,gBAAgB,CAACL,MAAc,EAC/B;KACC,OAAOC,cAAI,CACTC,SAAS,CAAC,gCAAgC,EAAE;OAAEC,IAAI,EAAE;SAAEH;;MAAU,CAAC,CACjEI,IAAI,CAAC,CAAC;OAAED;MAAM,KAAK;OACnB,IAAI,CAACG,cAAI,CAACC,KAAK,CAACJ,IAAI,oBAAJA,IAAI,CAAEK,aAAa,CAAC,EACpC;SACCL,IAAI,CAACK,aAAa,GAAG,IAAIC,IAAI,CAACN,IAAI,CAACK,aAAa,CAAC;;OAGlD,OAAOL,IAAI;MACX,CAAC;;GAGJO,kBAAkB,GAClB;KACC,OAAOT,cAAI,CACTC,SAAS,CAAC,kCAAkC,EAAE,EAAE,CAAC,CACjDE,IAAI,CAAC,CAAC;OAAED;MAAM,KAAKA,IAAI,CAAC;;CAE5B;;CC3BoC;CAAA;CAAA;CAAA;AAiBpC,CAAO,MAAMQ,KAAK,SAASC,aAAO,CAClC;GAOCC,WAAW,CAACC,OAAoB,EAChC;KACC,KAAK,CAACA,OAAO,CAAC;KAAC;OAAA;OAAA;;KAAA;OAAA;OAAA,OALiB;;KAAkB;OAAA;OAAA,OAC/B,IAAIhB,OAAO;;KAK9B,IAAIQ,cAAI,CAACS,cAAc,CAACD,OAAO,CAACE,EAAE,CAAC,EACnC;OACC,IAAI,CAACC,KAAK,CAACH,OAAO,CAACE,EAAE,CAAC;OACtB,4CAAI,4CAAsB,KAAK;MAC/B,MAED;OACC,IAAI,CAACC,KAAK,CAAC,4CAAI,oDAA0BC,cAAI,CAACC,SAAS,CAAC,EAAE,CAAC,CAAC;OAC5D,4CAAI,4CAAsB,IAAI;;KAG/B,IAAIb,cAAI,CAACc,WAAW,yCAACT,KAAK,0CAAoB,EAC9C;OACC,wCAAAA,KAAK,4CAAsB,4CAAI,sBAAUD,kBAAkB,EAAE;;;GAI/DW,IAAI,GACJ;KACC,4CAAI,sBAAUtB,SAAS,CAAC,IAAI,CAACuB,KAAK,EAAE,CAAC;;GAGtCC,KAAK,GACL;KACC,wCAAAZ,KAAK,0CAAoBP,IAAI,CAACoB,UAAU,IAAI;OAC3C,IAAI,CAACA,UAAU,EACf;SACC,KAAK,CAACD,KAAK,EAAE;;MAEd,CAAC;;GAGHE,SAAS,GACT;KACC,4CAAI,IAAI,2CACR;OACC,MAAM,IAAIC,KAAK,CAAC,kEAAkE,CAAC;;KAEpF,IAAI,CAAC,IAAI,CAACC,WAAW,EAAE,EACvB;OACC,MAAM,IAAID,KAAK,CAAC,kDAAkD,CAAC;;KAGpE,OAAOE,OAAO,CAACC,GAAG,CAAC,CAChB,4CAAI,sBAAUxB,gBAAgB,CAAC,IAAI,CAACiB,KAAK,EAAE,CAAC,0CAC5CX,KAAK,0CACL,CACD,CACAP,IAAI,CACJ,CAAC,CAAC;OAAEI;MAAe,EAAEsB,cAAc,CAAC,KAAK;OACxC,IAAI,CAACA,cAAc,IAAIxB,cAAI,CAACyB,MAAM,CAACvB,aAAa,CAAC,EACjD;SACC,IAAI,CAACe,KAAK,EAAE;;MAEb,CACD;;CAEJ;CAAC,sBApEYZ,KAAK;GAAA;GAAA;CAAA;;;;;;;;"}